<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RISKCAST v12 ‚Äî Enterprise Risk Assessment</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web@2.1.1"></script>
    <style>
        /* Ensure Phosphor Icons are visible */
        .ph {
            display: inline-block !important;
            vertical-align: middle !important;
        }
        
        /* Force icons in labels to be visible */
        .form-label .ph,
        label .ph {
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            width: 20px !important;
            height: 20px !important;
            color: #00FFC8 !important;
            opacity: 1 !important;
            visibility: visible !important;
        }
    </style>
   
    <!-- Smart Input Styles -->
    <link rel="stylesheet" href="/static/css/smart_input_styles.css">
    <!-- Note: File is named smart_input_styles.css but can be renamed to smart_input.css if preferred -->
    
    <!-- AI Chat Widget Styles -->
    <link rel="stylesheet" href="/static/css/ai_chat.css">
    
    
    <!-- Packing List Module - Ultra Premium 2026 -->
    <link rel="stylesheet" href="/static/css/packing_list.css">
        
        <!-- Summary CSS -->
        <link rel="stylesheet" href="/static/css/summary.css">
        
        <!-- Summary Overview CSS -->
        <link rel="stylesheet" href="/static/css/overview.css">
   
    <!-- Input Page Inline Styles (Extracted for better organization) -->
    <link rel="stylesheet" href="/static/css/input_inline.css">
    
    <!-- Enterprise Input Layout -->
    <link rel="stylesheet" href="/static/css/enterprise_input_layout.css">
    
    <!-- Transport Setup Refactor -->
    <link rel="stylesheet" href="/static/css/transport_setup_refactor.css">
    
    <!-- RISKCAST v12 Dark Neon Layout -->
    <link rel="stylesheet" href="/static/css/riskcast_v12_layout.css">
    
   
    <!-- Inline styles removed - moved to input_inline.css -->
    <!-- <style>
        :root {
            --bg-primary: #0a0a0b;
            --bg-secondary: #111113;
            --bg-tertiary: #18181b;
            --bg-card: #1a1a1e;
           
            --accent: #00ff88;
            --accent-soft: rgba(0, 255, 136, 0.1);
            --accent-medium: rgba(0, 255, 136, 0.2);
            --accent-hover: #00ffaa;
           
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --text-tertiary: #71717a;
           
            --border-default: rgba(255, 255, 255, 0.08);
            --border-hover: rgba(0, 255, 136, 0.5);
            --border-active: rgba(0, 255, 136, 1);
           
            --error: #ff4444;
            --error-bg: rgba(255, 68, 68, 0.1);
           
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
           
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.5);
            --shadow-glow: 0 0 40px rgba(0, 255, 136, 0.15);
        }
 
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
 
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }
 
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(0, 255, 136, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 136, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(0, 255, 136, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
 
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 11, 0.95);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
 
        .loading-overlay.active {
            display: flex;
        }
 
        .loader-container {
            text-align: center;
        }
 
        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid var(--border-default);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
 
        .loader-text {
            color: var(--text-secondary);
            font-size: 14px;
            letter-spacing: 0.05em;
        }
 
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
 
        .main-container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            padding: 24px;
        }
 
        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-xl);
            padding: 24px 32px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
 
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            animation: shimmer 3s infinite;
        }
 
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
 
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
 
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
 
        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }
 
        .brand-icon {
            width: 48px;
            height: 48px;
            background: var(--accent-soft);
            border: 1px solid var(--accent);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }
 
        .brand-text h1 {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
 
        .brand-text p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
 
        .lang-switcher {
            display: flex;
            gap: 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: 4px;
        }
 
        .lang-btn {
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }
 
        .lang-btn:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }
 
        .lang-btn.active {
            color: var(--accent);
            background: var(--accent-soft);
            box-shadow: 0 0 16px rgba(0, 255, 136, 0.25);
        }
 
        .header-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            background: var(--accent-soft);
            border: 1px solid var(--accent);
            border-radius: var(--radius-lg);
        }
 
        .status-indicator {
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent);
            animation: pulse 2s infinite;
        }
 
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes pulseComplete {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(16, 185, 129, 0.8); }
            100% { transform: scale(1); box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); }
        }
        
        @keyframes sectionComplete {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .progress-section.completed .progress-section-fill {
            animation: pulseComplete 0.6s ease;
        }
        
        .smart-progress-container {
            position: relative;
        }
        
        .progress-section {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .progress-section:hover .progress-section-indicator {
            color: rgba(255,255,255,0.9) !important;
            transform: translateX(-50%) translateY(-2px);
            transition: all 0.2s ease;
        }
        
        .progress-section.completed {
            animation: sectionComplete 0.5s ease;
        }
        
        /* Sticky Progress Bar */
        .sticky-progress-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 420px;
            max-width: calc(100vw - 40px);
            z-index: 9998;
            background: rgba(15, 25, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(16, 185, 129, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideInFromRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sticky-progress-bar.hidden {
            transform: translateX(calc(100% + 40px));
            opacity: 0;
            pointer-events: none;
        }
        
        @keyframes slideInFromRight {
            from {
                transform: translateX(calc(100% + 40px));
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .sticky-progress-content {
            padding: 16px;
        }
        
        .sticky-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sticky-progress-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 700;
            color: #fff;
        }
        
        .progress-icon {
            font-size: 18px;
        }
        
        .close-progress-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .close-progress-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-color: rgba(16, 185, 129, 0.5);
        }
        
        .sticky-progress-body {
            padding: 0;
        }
        
        /* Notification Toast */
        .progress-notification-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }
        
        .progress-notification {
            background: rgba(15, 25, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(16, 185, 129, 0.4);
            border-radius: 12px;
            padding: 16px 20px;
            min-width: 320px;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(16, 185, 129, 0.2);
            animation: notificationSlideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
        }
        
        .progress-notification.completed {
            border-color: rgba(16, 185, 129, 0.6);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(16, 185, 129, 0.3), 0 0 30px rgba(16, 185, 129, 0.3);
        }
        
        .progress-notification.ready {
            border-color: rgba(16, 185, 129, 0.8);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(16, 185, 129, 0.4), 0 0 40px rgba(16, 185, 129, 0.4);
            animation: notificationPulse 0.6s ease;
        }
        
        .progress-notification.warning {
            border-color: rgba(251, 191, 36, 0.6);
            background: rgba(30, 25, 15, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(251, 191, 36, 0.3), 0 0 30px rgba(251, 191, 36, 0.3);
        }
        
        .progress-notification.warning .notification-icon {
            background: rgba(251, 191, 36, 0.2);
        }
        
        .progress-notification.warning .notification-title {
            color: #FBBF24;
        }
        
        @keyframes notificationSlideDown {
            from {
                transform: translateY(-100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes notificationPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(16, 185, 129, 0.2);
            border-radius: 10px;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .notification-text {
            flex: 1;
        }
        
        .notification-title {
            font-size: 14px;
            font-weight: 700;
            color: #10B981;
            margin-bottom: 4px;
        }
        
        .notification-message {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            .sticky-progress-bar {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
                max-width: none;
            }
            
            .progress-notification {
                min-width: calc(100vw - 40px);
                max-width: calc(100vw - 40px);
            }
        }
 
        .status-text {
            font-size: 13px;
            font-weight: 500;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
 
        .form-container {
            max-width: 1200px;
            margin: 0 auto;
        }
 
        .form-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-xl);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            position: relative;
        }
 
        .form-section::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 1px;
            background: var(--accent);
            box-shadow: 0 0 20px var(--accent);
        }
 
        .section-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-default);
        }
 
        .section-number {
            width: 48px;
            height: 48px;
            background: var(--accent-soft);
            border: 1px solid var(--accent);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
        }
 
        .section-title h2 {
            font-size: 20px;
            font-weight: 600;
            color: #10B981;
            letter-spacing: -0.02em;
        }
 
        .section-title p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
 
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }
 
        .form-group {
            position: relative;
        }
 
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 8px;
        }
 
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
 
        .form-input {
            width: 100%;
            height: 44px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: 0 16px;
            font-size: 14px;
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: inherit;
        }
 
        .form-input:hover {
            border-color: var(--border-hover);
            background: rgba(0, 255, 136, 0.02);
        }
 
        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--accent-soft);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1), var(--shadow-glow);
        }
 
        .form-input::placeholder {
            color: var(--text-tertiary);
        }
 
        .form-input.with-prefix {
            padding-left: 40px;
        }
 
        .date-input {
            padding-right: 40px;
        }
 
        .date-input::-webkit-calendar-picker-indicator {
            opacity: 0;
            cursor: pointer;
        }
 
        /* Input icon inside input wrapper (for calendar, etc.) */
        .input-wrapper .input-icon,
        .input-wrapper > .input-icon {
            position: absolute;
            right: 12px;
            color: var(--text-tertiary);
            pointer-events: none;
            transition: color 0.3s ease;
        }

        .input-wrapper:hover .input-icon {
            color: var(--text-secondary);
        }

        .input-wrapper:focus-within .input-icon {
            color: var(--accent);
        }
        
        /* Label icons should NOT use absolute positioning */
        .form-label .input-icon,
        label .input-icon {
            position: static !important;
            right: auto !important;
        }
 
        .calendar-icon {
            cursor: pointer;
            pointer-events: all;
        }
 
        .input-prefix,
        .input-suffix {
            position: absolute;
            color: var(--text-tertiary);
            font-size: 14px;
            pointer-events: none;
        }
 
        .input-prefix {
            left: 16px;
        }
 
        .input-suffix {
            right: 16px;
        }
 
        .custom-dropdown {
            position: relative;
            width: 100%;
        }
 
        .dropdown-trigger {
            width: 100%;
            height: 44px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: 0 40px 0 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }
 
        .dropdown-trigger:hover {
            border-color: var(--border-hover);
            background: rgba(0, 255, 136, 0.02);
        }
 
        .dropdown-trigger:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--accent-soft);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1), 0 0 14px rgba(0, 255, 136, 0.3);
        }
 
        .dropdown-trigger.error {
            border-color: var(--error);
            background: var(--error-bg);
        }
 
        .dropdown-value {
            font-size: 14px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
 
        .dropdown-value.placeholder {
            color: var(--text-tertiary);
        }
 
        .dropdown-arrow {
            position: absolute;
            right: 12px;
            color: var(--text-tertiary);
            transition: all 0.3s ease;
            pointer-events: none;
        }
 
        .custom-dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
            color: var(--accent);
        }
 
        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            width: 100%;
            max-height: 280px;
            overflow-y: auto;
            background: var(--bg-card);
            border: 1px solid var(--border-hover);
            border-radius: var(--radius-md);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.6), 0 0 24px rgba(0, 255, 136, 0.15);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transform-origin: top;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
        }
 
        .custom-dropdown.active .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
 
        .dropdown-menu::-webkit-scrollbar {
            width: 8px;
        }
 
        .dropdown-menu::-webkit-scrollbar-track {
            background: transparent;
        }
 
        .dropdown-menu::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
 
        .dropdown-menu::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }
 
        .dropdown-option {
            padding: 12px 16px;
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            padding-right: 40px;
        }
 
        .dropdown-option:hover {
            background: rgba(0, 255, 136, 0.08);
            color: var(--accent);
        }
 
        .dropdown-option.selected {
            background: var(--accent-soft);
            color: var(--accent);
            font-weight: 500;
        }
 
        .dropdown-option.selected::after {
            content: '‚úì';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: var(--accent);
            animation: checkmarkPop 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
 
        @keyframes checkmarkPop {
            0% {
                transform: translateY(-50%) scale(0);
            }
            50% {
                transform: translateY(-50%) scale(1.2);
            }
            100% {
                transform: translateY(-50%) scale(1);
            }
        }
 
        .dropdown-option.focused {
            background: rgba(0, 255, 136, 0.05);
            outline: 2px solid rgba(0, 255, 136, 0.3);
            outline-offset: -2px;
        }
 
        .error-message {
            display: none;
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            font-size: 12px;
            color: var(--error);
            background: var(--error-bg);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            white-space: nowrap;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(255, 68, 68, 0.2);
        }
 
        .error-message.active {
            display: block;
        }
 
        .form-input.error {
            border-color: var(--error);
            background: var(--error-bg);
        }
 
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
 
        .module-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
 
        .module-card:hover {
            border-color: var(--border-hover);
            background: rgba(0, 255, 136, 0.02);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
 
        .module-header {
            display: flex;
            align-items: center;
            gap: 16px;
        }
 
        .module-icon {
            width: 44px;
            height: 44px;
            background: var(--accent-soft);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
        }
 
        .module-info h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
 
        .module-info p {
            font-size: 12px;
            color: var(--text-tertiary);
        }
 
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            cursor: pointer;
        }
 
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
 
        .toggle-slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-default);
            border-radius: 24px;
            transition: all 0.3s ease;
        }
 
        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            left: 2px;
            top: 2px;
            background: var(--text-tertiary);
            border-radius: 50%;
            transition: all 0.3s ease;
                z-index: 1;
                box-shadow: none;
        }
 
        /* Hide toggle switches when unchecked (off state) - Remove red indicators */
        .toggle-switch input:not(:checked) + .toggle-slider {
            opacity: 0 !important;
            visibility: hidden !important;
            display: none !important;
        }

        .toggle-switch input:not(:checked) + .toggle-slider::before {
            display: none !important;
            opacity: 0 !important;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--accent-soft);
            border-color: var(--accent);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
            opacity: 1 !important;
            visibility: visible !important;
            display: block !important;
        }
 
        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(24px);
            background: var(--accent);
            box-shadow: 0 0 8px rgba(0, 255, 136, 0.5);
            display: block !important;
            opacity: 1 !important;
        }
            
            /* Remove any duplicate dots or pseudo-elements */
            .toggle-slider::after {
                display: none !important;
                content: none !important;
            }
            
            .toggle-switch::before,
            .toggle-switch::after {
                display: none !important;
                content: none !important;
            }
            
            /* Ensure only one dot is visible */
            .toggle-switch *::after {
                display: none !important;
                content: none !important;
        }
 
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 16px;
            margin-top: 32px;
            padding-top: 32px;
            border-top: 1px solid var(--border-default);
        }
 
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: inherit;
        }
 
        .btn-primary {
            background: var(--accent);
            color: var(--bg-primary);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
        }
 
        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
        }
 
        .btn-secondary {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-default);
        }
 
        .btn-secondary:hover {
            border-color: var(--text-secondary);
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }
 
        @media (max-width: 768px) {
            .main-container {
                padding: 16px;
            }
 
            .header {
                padding: 20px;
            }
 
            .header-content {
                flex-direction: column;
                gap: 16px;
            }
 
            .header-right {
                width: 100%;
                justify-content: space-between;
            }
 
            .form-section {
                padding: 24px 20px;
            }
 
            .form-grid {
                grid-template-columns: 1fr;
            }
 
            .modules-grid {
                grid-template-columns: 1fr;
            }
 
            .form-actions {
                flex-direction: column;
            }
 
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
 
        @media (max-width: 480px) {
            .brand-text h1 {
                font-size: 20px;
            }
 
            .section-title h2 {
                font-size: 18px;
            }
        }
        /* ==================== SLIDER DISPLAYS ==================== */
        .rating-display,
        .score-display {
            display: inline-block;
            margin-left: 10px;
            padding: 4px 10px;
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }

        .auto-badge {
            display: inline-block;
            margin-left: 8px;
            padding: 2px 8px;
            background: rgba(0, 255, 136, 0.15);
            color: #00ffc3;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .badge-recommended {
            display: inline-block;
            margin-left: 8px;
            padding: 2px 8px;
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
        }

        .field-hint {
            display: block;
            margin-top: 4px;
            font-size: 11px;
            color: var(--text-tertiary);
        }

        /* Collapsible section animations */
        .section-content.collapsed {
            display: none !important;
        }

        .collapse-toggle {
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
        }

        .collapse-toggle:hover {
            color: #00ffc3;
        }

        .collapse-icon {
            transition: transform 0.3s ease;
        }

        .form-section.expanded .collapse-icon {
            transform: rotate(180deg);
        }

        /* Range slider styling */
        .range-slider {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #00ffc3;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 255, 195, 0.4);
            transition: all 0.2s ease;
        }

        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(0, 255, 195, 0.6);
        }

        .range-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #00ffc3;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 255, 195, 0.4);
            transition: all 0.2s ease;
        }

        .range-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(0, 255, 195, 0.6);
        }
    </style> -->
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay" style="display: none !important; pointer-events: none !important; visibility: hidden !important; opacity: 0 !important; z-index: -1 !important;">
        <div class="loader-container">
            <div class="loader-spinner"></div>
            <div class="loader-text" data-i18n="loading_text">Initializing Risk Engine...</div>
        </div>
    </div>
 
    <div class="main-container">
        <header class="header">
            <div class="header-content">
                <div class="brand">
                    <div class="brand-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="brand-text">
                        <h1 data-i18n="brand_title" style="font-size: 20px; margin: 0; line-height: 1.2;">RISKCAST v12</h1>
                        <p data-i18n="brand_subtitle" style="font-size: 11px; margin: 2px 0 0 0; opacity: 0.7;">Enterprise Risk Assessment</p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="lang-switcher">
                        <button class="lang-btn active" data-lang="en">EN</button>
                        <button class="lang-btn" data-lang="vi">VI</button>
                    </div>
                    <div class="header-status">
                        <span class="status-indicator"></span>
                        <span class="status-text" data-i18n="status_ready">System Ready</span>
                    </div>
                </div>
            </div>
            <div class="header-progress" style="margin-top: 12px; padding: 0 60px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 12px; color: rgba(255,255,255,0.6); font-weight: 500;" data-i18n="progress_label">Ti·∫øn ƒê·ªô:</span>
                    <div class="smart-progress-container" style="flex: 1; position: relative;">
                        <div class="smart-progress-track" style="height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; position: relative; display: flex;">
                            <div class="progress-section" data-section="shipping-info" style="flex: 1; height: 100%; background: rgba(255,255,255,0.05); border-right: 1px solid rgba(255,255,255,0.1);">
                                <div class="progress-section-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #10B981, #34D399); transition: width 0.5s ease;"></div>
                            </div>
                            <div class="progress-section" data-section="cargo-details" style="flex: 1; height: 100%; background: rgba(255,255,255,0.05); border-right: 1px solid rgba(255,255,255,0.1);">
                                <div class="progress-section-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #10B981, #34D399); transition: width 0.5s ease;"></div>
                            </div>
                            <div class="progress-section" data-section="seller-info" style="flex: 1; height: 100%; background: rgba(255,255,255,0.05); border-right: 1px solid rgba(255,255,255,0.1);">
                                <div class="progress-section-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #10B981, #34D399); transition: width 0.5s ease;"></div>
                            </div>
                            <div class="progress-section" data-section="buyer-info" style="flex: 1; height: 100%; background: rgba(255,255,255,0.05); border-right: 1px solid rgba(255,255,255,0.1);">
                                <div class="progress-section-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #10B981, #34D399); transition: width 0.5s ease;"></div>
                            </div>
                            <div class="progress-section" data-section="algorithm-modules" style="flex: 1; height: 100%; background: rgba(255,255,255,0.05);">
                                <div class="progress-section-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #10B981, #34D399); transition: width 0.5s ease;"></div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 6px;">
                            <span id="progress-sections-text" style="font-size: 10px; color: rgba(255,255,255,0.5);">0/5 ph·∫ßn ƒë√£ ho√†n th√†nh</span>
                            <span id="header_progress_text" style="font-size: 12px; font-weight: 600; color: #10B981; min-width: 40px; text-align: right;">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Sticky Smart Progress Bar (Follows scroll) -->
        <div id="sticky-progress-bar" class="sticky-progress-bar" style="display: none;">
            <div class="sticky-progress-content">
                <div class="sticky-progress-header">
                    <div class="sticky-progress-title">
                        <span class="progress-icon">üìä</span>
                        <span>Ti·∫øn ƒê·ªô Ho√†n Th√†nh</span>
                    </div>
                    <button id="close-progress-bar" class="close-progress-btn" title="ƒê√≥ng thanh ti·∫øn ƒë·ªô">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor">
                            <path d="M12 4L4 12M4 4l8 8" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                </div>
                
                <div class="sticky-progress-body">
                    <!-- Smart Progress Bar with 5 Sections -->
                    <div class="smart-progress-container" style="flex: 1; position: relative;">
                        <div class="smart-progress-track" style="height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; overflow: hidden; position: relative; display: flex;">
                            <!-- Section 1: Shipping Info -->
                            <div class="progress-section" data-section="shipping-info" style="flex: 1; height: 100%; background: rgba(255,255,255,0.05); border-right: 1px solid rgba(255,255,255,0.1); position: relative;">
                                <div class="progress-section-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #10B981, #34D399); transition: width 0.5s ease; border-radius: 0;"></div>
                                <div class="progress-section-indicator" style="position: absolute; top: -24px; left: 50%; transform: translateX(-50%); font-size: 11px; color: rgba(255,255,255,0.5); white-space: nowrap; font-weight: 600;">01</div>
                            </div>
                            
                            <!-- Section 2: Cargo Details -->
                            <div class="progress-section" data-section="cargo-details" style="flex: 1; height: 100%; background: rgba(255,255,255,0.05); border-right: 1px solid rgba(255,255,255,0.1); position: relative;">
                                <div class="progress-section-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #10B981, #34D399); transition: width 0.5s ease; border-radius: 0;"></div>
                                <div class="progress-section-indicator" style="position: absolute; top: -24px; left: 50%; transform: translateX(-50%); font-size: 11px; color: rgba(255,255,255,0.5); white-space: nowrap; font-weight: 600;">02</div>
                            </div>
                            
                            <!-- Section 3: Seller Info -->
                            <div class="progress-section" data-section="seller-info" style="flex: 1; height: 100%; background: rgba(255,255,255,0.05); border-right: 1px solid rgba(255,255,255,0.1); position: relative;">
                                <div class="progress-section-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #10B981, #34D399); transition: width 0.5s ease; border-radius: 0;"></div>
                                <div class="progress-section-indicator" style="position: absolute; top: -24px; left: 50%; transform: translateX(-50%); font-size: 11px; color: rgba(255,255,255,0.5); white-space: nowrap; font-weight: 600;">03</div>
                            </div>
                            
                            <!-- Section 4: Buyer Info -->
                            <div class="progress-section" data-section="buyer-info" style="flex: 1; height: 100%; background: rgba(255,255,255,0.05); border-right: 1px solid rgba(255,255,255,0.1); position: relative;">
                                <div class="progress-section-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #10B981, #34D399); transition: width 0.5s ease; border-radius: 0;"></div>
                                <div class="progress-section-indicator" style="position: absolute; top: -24px; left: 50%; transform: translateX(-50%); font-size: 11px; color: rgba(255,255,255,0.5); white-space: nowrap; font-weight: 600;">04</div>
                            </div>
                            
                            <!-- Section 5: Algorithm Modules -->
                            <div class="progress-section" data-section="algorithm-modules" style="flex: 1; height: 100%; background: rgba(255,255,255,0.05); position: relative;">
                                <div class="progress-section-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #10B981, #34D399); transition: width 0.5s ease; border-radius: 0;"></div>
                                <div class="progress-section-indicator" style="position: absolute; top: -24px; left: 50%; transform: translateX(-50%); font-size: 11px; color: rgba(255,255,255,0.5); white-space: nowrap; font-weight: 600;">05</div>
                            </div>
                        </div>
                        
                        <!-- Progress Text -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px;">
                            <span id="sticky-progress-sections-text" style="font-size: 12px; color: rgba(255,255,255,0.7); font-weight: 500;">0/5 ph·∫ßn ƒë√£ ho√†n th√†nh</span>
                            <span id="sticky-progress-text" style="font-size: 14px; font-weight: 700; color: #10B981; min-width: 55px; text-align: right;">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notification Toast Container -->
        <div id="progress-notification-container" class="progress-notification-container"></div>
 
        <!-- Enterprise Layout Container -->
        <div class="enterprise-input-container">
            <!-- Left Sidebar Navigation -->
            <aside class="enterprise-sidebar glass">
                <div class="sidebar-header">
                    <div class="sidebar-title">Navigation</div>
                    <div class="sidebar-subtitle">RISKCAST v12</div>
                </div>
                <nav class="sidebar-nav">
                    <a href="#shipping-info" class="sidebar-nav-item" data-section="shipping-info">
                        <span class="nav-item-number">01</span>
                        <span class="nav-item-label">Transport Setup</span>
                        <span class="nav-item-check">‚úì</span>
                    </a>
                    <a href="#cargo-details" class="sidebar-nav-item" data-section="cargo-details">
                        <span class="nav-item-number">02</span>
                        <span class="nav-item-label">Cargo & Packing</span>
                        <span class="nav-item-check">‚úì</span>
                    </a>
                    <a href="#seller-info" class="sidebar-nav-item" data-section="seller-info">
                        <span class="nav-item-number">03</span>
                        <span class="nav-item-label">Seller Information</span>
                        <span class="nav-item-check">‚úì</span>
                    </a>
                    <a href="#buyer-info" class="sidebar-nav-item" data-section="buyer-info">
                        <span class="nav-item-number">04</span>
                        <span class="nav-item-label">Buyer Information</span>
                        <span class="nav-item-check">‚úì</span>
                    </a>
                    <a href="#algorithm-modules" class="sidebar-nav-item" data-section="algorithm-modules">
                        <span class="nav-item-number">05</span>
                        <span class="nav-item-label">Algorithm Modules</span>
                        <span class="nav-item-check">‚úì</span>
                    </a>
                    <a href="#summaryOverviewSection" class="sidebar-nav-item" data-section="summaryOverviewSection">
                        <span class="nav-item-number">06</span>
                        <span class="nav-item-label">Summary Overview</span>
                        <span class="nav-item-check">‚úì</span>
                    </a>
                </nav>
            </aside>

            <!-- Layout Wrapper for Main Content + AI Panel -->
            <div class="layout-wrapper">
                <!-- Main Content Area -->
                <main class="enterprise-content main-content">
                <div class="form-container">
                    <form id="risk_form" class="risk-form" novalidate>
               
                <!-- Hidden inputs map from dropdowns to real form fields for Flask -->
                <div style="display:none;">
                    <input type="hidden" name="transport_mode" id="transport_mode_input">
                    <input type="hidden" name="cargo_type" id="cargo_type_input">
                    <input type="hidden" name="route" id="route_input">
                    <input type="hidden" name="incoterm" id="incoterm_input">
                    <input type="hidden" name="container" id="container_input">
                    <input type="hidden" name="packaging" id="packaging_input">
                    <input type="hidden" name="priority" id="priority_input">
                </div>
               
                <!-- M·ª§C 01 ‚Äî TH√îNG TIN V·∫¨N CHUY·ªÇN (SHIPPING INFORMATION) -->
                <section id="shipping-info" class="form-section">
                    <div class="enterprise-section-card" id="section-transport">
                        <h2 class="section-title">01. Transport Setup</h2>
                        <p class="section-subtitle">D·ªØ li·ªáu n·ªÅn ƒë·ªÉ AI t√≠nh to√°n r·ªßi ro l·ªô tr√¨nh, kh√≠ h·∫≠u, v√† th·ªùi gian.</p>

                        <div class="grid grid-cols-2 gap-x-8 gap-y-6 w-full">
                            <!-- Commercial Route -->
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label class="form-label" for="route_dropdown" data-i18n="label_route">
                                    <i class="ph ph-globe input-icon"></i>
                                    Tuy·∫øn ƒê∆∞·ªùng V·∫≠n Chuy·ªÉn
                                    <span class="required-indicator">*</span>
                                </label>
                                <div class="custom-dropdown" id="route_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder" data-i18n="placeholder_select">Ch·ªçn tuy·∫øn ƒë∆∞·ªùng</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox">
                                        <div class="dropdown-option" data-value="vn_cn" role="option">üáªüá≥ Vi·ªát Nam ‚Üí üá®üá≥ Trung Qu·ªëc</div>
                                        <div class="dropdown-option" data-value="vn_us" role="option">üáªüá≥ Vi·ªát Nam ‚Üí üá∫üá∏ M·ªπ (LA/NY)</div>
                                        <div class="dropdown-option" data-value="vn_kr" role="option">üáªüá≥ Vi·ªát Nam ‚Üí üá∞üá∑ H√†n Qu·ªëc</div>
                                        <div class="dropdown-option" data-value="vn_jp" role="option">üáªüá≥ Vi·ªát Nam ‚Üí üáØüáµ Nh·∫≠t B·∫£n</div>
                                        <div class="dropdown-option" data-value="vn_eu" role="option">üáªüá≥ Vi·ªát Nam ‚Üí üá™üá∫ EU (H√† Lan/ƒê·ª©c)</div>
                                        <div class="dropdown-option" data-value="vn_hk" role="option">üáªüá≥ Vi·ªát Nam ‚Üí üá≠üá∞ H·ªìng K√¥ng</div>
                                        <div class="dropdown-option" data-value="vn_in" role="option">üáªüá≥ Vi·ªát Nam ‚Üí üáÆüá≥ ·∫§n ƒê·ªô</div>
                                        <div class="dropdown-option" data-value="vn_th" role="option">üáªüá≥ Vi·ªát Nam ‚Üí üáπüá≠ Th√°i Lan</div>
                                        <div class="dropdown-option" data-value="vn_tw" role="option">üáªüá≥ Vi·ªát Nam ‚Üí üáπüáº ƒê√†i Loan</div>
                                        <div class="dropdown-option" data-value="domestic" role="option">üáªüá≥ N·ªôi ƒê·ªãa Vi·ªát Nam</div>
                                    </div>
                                </div>
                                <span class="error-message" id="route_error"></span>
                            </div>

                            <!-- Transport Mode -->
                            <div class="form-group" id="transport_mode_group" style="display: none; grid-column: 1 / -1;">
                                <label class="form-label" for="transport_mode_dropdown" data-i18n="label_transport_mode">
                                    <i class="ph ph-truck input-icon"></i>
                                    Ph∆∞∆°ng Th·ª©c V·∫≠n T·∫£i
                                    <span class="required-indicator">*</span>
                                    <span class="badge-recommended" id="transport_recommended_badge" style="display:none; margin-left: 8px; padding: 2px 8px; background: rgba(0,255,136,0.2); color: #00ff88; border-radius: 4px; font-size: 10px;">ƒê∆∞·ª£c ƒë·ªÅ xu·∫•t</span>
                                </label>
                                <div class="custom-dropdown" id="transport_mode_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder">Ch·ªçn tuy·∫øn ƒë∆∞·ªùng th∆∞∆°ng m·∫°i tr∆∞·ªõc</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox" id="transport_mode_menu">
                                        <!-- Options s·∫Ω ƒë∆∞·ª£c populate dynamically -->
                                    </div>
                                </div>
                                <span class="error-message" id="transport_mode_error"></span>
                                <span class="field-hint" id="transport_mode_hint"></span>
                            </div>

                            <!-- Detailed Route -->
                            <div class="form-group" id="detailed_route_group" style="display: none; grid-column: 1 / -1;">
                                <label class="form-label" for="detailed_route_dropdown">
                                    <i class="ph ph-navigation-arrow input-icon"></i>
                                    Tuy·∫øn (Route)
                                    <span class="help-icon" title="Ch·ªçn tuy·∫øn v·∫≠n chuy·ªÉn c·ª• th·ªÉ cho tuy·∫øn ƒë∆∞·ªùng ƒë√£ ch·ªçn" style="margin-left: 8px; cursor: help;">üí°</span>
                                </label>
                                <div class="custom-dropdown" id="detailed_route_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder">Ch·ªçn ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn tr∆∞·ªõc</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" id="detailed_route_menu" role="listbox">
                                        <!-- Routes will be populated dynamically -->
                                    </div>
                                </div>
                                <input type="hidden" name="detailed_route" id="detailed_route_input" value="">
                                <span class="error-message" id="detailed_route_error"></span>
                                
                                <!-- Route Details Panel -->
                                <div id="route_details_panel" class="route-details-panel" style="display: none; margin-top: 12px;">
                                    <div class="route-details-header">
                                        <span class="route-details-icon">üìã</span>
                                        <span class="route-details-title">Th√¥ng Tin Chi Ti·∫øt Tuy·∫øn</span>
                                    </div>
                                    <div class="route-details-grid">
                                        <div class="route-detail-item">
                                            <span class="detail-label">‚è±Ô∏è Transit Time:</span>
                                            <span class="detail-value" id="route_detail_transit">--</span>
                                        </div>
                                        <div class="route-detail-item">
                                            <span class="detail-label">üí∞ Ph·ª• Ph√≠ (11/2025):</span>
                                            <span class="detail-value" id="route_detail_surcharge">--</span>
                                        </div>
                                        <div class="route-detail-item">
                                            <span class="detail-label">üå°Ô∏è R·ªßi Ro Kh√≠ H·∫≠u:</span>
                                            <span class="detail-value" id="route_detail_climate">--</span>
                                        </div>
                                        <div class="route-detail-item">
                                            <span class="detail-label">‚öîÔ∏è R·ªßi Ro Chi·∫øn S·ª±:</span>
                                            <span class="detail-value" id="route_detail_conflict">--</span>
                                        </div>
                                        <div class="route-detail-item">
                                            <span class="detail-label">üìä % T√†u ƒêang ƒêi:</span>
                                            <span class="detail-value" id="route_detail_usage">--</span>
                                        </div>
                                    </div>
                                    <div class="route-details-note">
                                        <span class="note-icon">üí¨</span>
                                        <span class="note-text" id="route_detail_note">--</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Carrier -->
                            <div class="form-group" id="carrier_group" style="display: none; grid-column: 1 / -1;">
                                <label class="form-label" for="carrier_dropdown" data-i18n="label_carrier">
                                    <i class="ph ph-anchor input-icon"></i>
                                    H√£ng T√†u / Carrier
                                    <span class="required-indicator">*</span>
                                    <span class="carrier-rating-display" id="carrier_rating_info" style="display: none; margin-left: 12px; font-size: 13px; color: var(--text-secondary);">
                                        <span id="carrier_rating_stars_display"></span>
                                        <span id="carrier_rating_votes" style="margin-left: 8px;"></span>
                                    </span>
                                </label>
                                <div class="custom-dropdown" id="carrier_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder">Ch·ªçn tuy·∫øn c·ª• th·ªÉ tr∆∞·ªõc ƒë·ªÉ xem h√£ng t√†u</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" id="carrier_dropdown_menu" role="listbox">
                                        <!-- Carriers will be populated dynamically by smart_input.js -->
                                    </div>
                                </div>
                                <div id="carrier_note" class="field-hint" style="display: none;"></div>
                                <input type="hidden" name="carrier" id="carrier_input" value="">
                                <span class="error-message" id="carrier_error"></span>
                                <div id="carrier-suggestion" class="suggestion-panel" style="display: none;"></div>
                            </div>

                            <!-- POL -->
                            <div class="form-group">
                                <label class="form-label" for="pol_dropdown">
                                    <i class="ph ph-map-pin input-icon"></i>
                                    C·∫£ng B·ªëc H√†ng (POL)
                                    <span class="required-indicator">*</span>
                                </label>
                                <div class="custom-dropdown" id="pol_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button">
                                        <span class="dropdown-value placeholder">Ch·ªçn ph∆∞∆°ng th·ª©c tr∆∞·ªõc</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox" id="pol_menu">
                                        <!-- Options dynamically populated -->
                                    </div>
                                </div>
                                <input type="hidden" name="pol" id="pol_input">
                                <span class="error-message" id="pol_error"></span>
                            </div>

                            <!-- POD -->
                            <div class="form-group">
                                <label class="form-label" for="pod_dropdown">
                                    <i class="ph ph-flag-checkered input-icon"></i>
                                    C·∫£ng D·ª° H√†ng (POD)
                                    <span class="required-indicator">*</span>
                                </label>
                                <div class="custom-dropdown" id="pod_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button">
                                        <span class="dropdown-value placeholder">Ch·ªçn ph∆∞∆°ng th·ª©c tr∆∞·ªõc</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox" id="pod_menu">
                                        <!-- Options dynamically populated -->
                                    </div>
                                </div>
                                <input type="hidden" name="pod" id="pod_input">
                                <span class="error-message" id="pod_error"></span>
                            </div>

                            <!-- ETD / Departure Time -->
                            <div class="form-group">
                                <label class="form-label" for="shipment-month">
                                    <i class="ph ph-calendar-blank input-icon"></i>
                                    Th·ªùi Gian D·ª± Ki·∫øn ƒêi H√†ng
                                    <span class="required-indicator">*</span>
                                </label>
                                <div class="input-wrapper">
                                    <input type="month" id="shipment-month" name="shipment_month" value="2025-11" required class="form-input date-input" style="display: none;">
                                    <input type="text" id="shipment-month-display" class="form-input date-input" readonly placeholder="Ch·ªçn th√°ng" style="width: 100%; cursor: pointer;" onclick="try { const m = document.getElementById('shipment-month'); if (m && m.showPicker && event.isTrusted) { m.showPicker(); } else if (m) { m.focus(); m.click(); } } catch(e) { const m = document.getElementById('shipment-month'); if (m) { m.focus(); m.click(); } }">
                                    <span class="input-icon calendar-icon" onclick="try { const m = document.getElementById('shipment-month'); if (m && m.showPicker && event.isTrusted) { m.showPicker(); } else if (m) { m.focus(); m.click(); } } catch(e) { const m = document.getElementById('shipment-month'); if (m) { m.focus(); m.click(); } }">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <rect x="3" y="4" width="14" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M7 2V6M13 2V6M3 8H17" stroke="currentColor" stroke-width="1.5"/>
                                        </svg>
                                    </span>
                                </div>
                            </div>

                            <!-- Distance -->
                            <div class="form-group">
                                <label class="form-label" for="distance">
                                    <i class="ph ph-ruler input-icon"></i>
                                    Kho·∫£ng C√°ch V·∫≠n Chuy·ªÉn
                                    <span class="auto-badge">T·ª± ƒë·ªông</span>
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" id="distance" name="distance" class="form-input" placeholder="S·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn" style="background: rgba(0,255,136,0.05); border-color: rgba(0,255,136,0.3);">
                                    <span class="input-suffix">km</span>
                                </div>
                            </div>

                            <!-- Transit Days -->
                            <div class="form-group">
                                <label class="form-label" for="transit_time_display">
                                    <i class="ph ph-timer input-icon"></i>
                                    Th·ªùi Gian V·∫≠n Chuy·ªÉn D·ª± Ki·∫øn
                                    <span class="auto-badge">T·ª± ƒë·ªông</span>
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" id="transit_time_display" class="form-input" placeholder="--" readonly style="background: rgba(0,255,136,0.05); border-color: rgba(0,255,136,0.3); font-weight: 700; font-size: 20px; color: #00ff9d; text-align: center; padding: 12px 16px;">
                                    <span class="input-suffix">ng√†y</span>
                                </div>
                                <input type="hidden" name="transit_time" id="transit_time">
                            </div>

                            <!-- Cargo Type -->
                            <div class="form-group">
                                <label class="form-label" for="cargo_type_dropdown" data-i18n="label_cargo_type">
                                    <i class="ph ph-cube input-icon"></i>
                                    Lo·∫°i H√†ng H√≥a
                                </label>
                                <div class="custom-dropdown" id="cargo_type_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder" data-i18n="placeholder_select">Select cargo type</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox">
                                        <div class="dropdown-option" data-value="general" role="option" data-i18n="opt_ct_general">General Cargo</div>
                                        <div class="dropdown-option" data-value="electronics" role="option" data-i18n="opt_ct_electronics">Electronics</div>
                                        <div class="dropdown-option" data-value="food_bev" role="option" data-i18n="opt_ct_food_bev">Food & Beverage</div>
                                        <div class="dropdown-option" data-value="garments" role="option" data-i18n="opt_ct_garments">Garments / Textile</div>
                                        <div class="dropdown-option" data-value="agriculture" role="option" data-i18n="opt_ct_agriculture">Agriculture</div>
                                        <div class="dropdown-option" data-value="refrigerated" role="option" data-i18n="opt_ct_refrigerated">Refrigerated / Frozen</div>
                                        <div class="dropdown-option" data-value="chemicals" role="option" data-i18n="opt_ct_chemicals">Chemicals</div>
                                        <div class="dropdown-option" data-value="machinery" role="option" data-i18n="opt_ct_machinery">Machinery</div>
                                        <div class="dropdown-option" data-value="fragile" role="option" data-i18n="opt_ct_fragile">Fragile Goods</div>
                                        <div class="dropdown-option" data-value="auto_parts" role="option" data-i18n="opt_ct_auto_parts">Automotive Parts</div>
                                        <div class="dropdown-option" data-value="dg" role="option" data-i18n="opt_ct_dg">Dangerous Goods (DG)</div>
                                        <div class="dropdown-option" data-value="pharma" role="option" data-i18n="opt_ct_pharma">Pharmaceutical</div>
                                    </div>
                                </div>
                                <span class="error-message" id="cargo_type_error"></span>
                            </div>

                            <!-- Incoterm -->
                            <div class="form-group">
                                <label class="form-label" for="incoterm_dropdown" data-i18n="label_incoterm">
                                    <i class="ph ph-file-text input-icon"></i>
                                    Incoterms
                                </label>
                                <div class="custom-dropdown" id="incoterm_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder" data-i18n="placeholder_select">Select incoterm</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox">
                                        <div class="dropdown-option" data-value="exw" role="option" data-i18n="opt_ic_exw">EXW</div>
                                        <div class="dropdown-option" data-value="fca" role="option" data-i18n="opt_ic_fca">FCA</div>
                                        <div class="dropdown-option" data-value="fas" role="option" data-i18n="opt_ic_fas">FAS</div>
                                        <div class="dropdown-option" data-value="fob" role="option" data-i18n="opt_ic_fob">FOB</div>
                                        <div class="dropdown-option" data-value="cfr" role="option" data-i18n="opt_ic_cfr">CFR</div>
                                        <div class="dropdown-option" data-value="cif" role="option" data-i18n="opt_ic_cif">CIF</div>
                                        <div class="dropdown-option" data-value="cpt" role="option" data-i18n="opt_ic_cpt">CPT</div>
                                        <div class="dropdown-option" data-value="cip" role="option" data-i18n="opt_ic_cip">CIP</div>
                                        <div class="dropdown-option" data-value="dap" role="option" data-i18n="opt_ic_dap">DAP</div>
                                        <div class="dropdown-option" data-value="dpu" role="option" data-i18n="opt_ic_dpu">DPU</div>
                                        <div class="dropdown-option" data-value="ddp" role="option" data-i18n="opt_ic_ddp">DDP</div>
                                    </div>
                                </div>
                                <span class="error-message" id="incoterm_error"></span>
                            </div>

                            <!-- Container Type -->
                            <div class="form-group">
                                <label class="form-label" for="container_dropdown" data-i18n="label_container">
                                    <i class="ph ph-package input-icon"></i>
                                    Lo·∫°i Container
                                </label>
                                <div class="custom-dropdown" id="container_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder" data-i18n="placeholder_select">Select container</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox">
                                        <div class="dropdown-option container-item" id="container-20ft_standard" data-value="20ft_standard" data-container-type="20ft_standard" role="option" data-i18n="opt_cn_20ft">
                                            <span>20ft Standard</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-40ft_standard" data-value="40ft_standard" data-container-type="40ft_standard" role="option" data-i18n="opt_cn_40ft">
                                            <span>40ft Standard</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-40ft_highcube" data-value="40ft_highcube" data-container-type="40ft_highcube" role="option" data-i18n="opt_cn_40hc">
                                            <span>40ft High Cube</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-45ft_highcube" data-value="45ft_highcube" data-container-type="45ft_highcube" role="option" data-i18n="opt_cn_45hc">
                                            <span>45ft High Cube</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-reefer" data-value="reefer" data-container-type="reefer" role="option" data-i18n="opt_cn_reefer">
                                            <span>Reefer Container</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-open_top" data-value="open_top" data-container-type="open_top" role="option" data-i18n="opt_cn_opentop">
                                            <span>Open-top</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-flat_rack" data-value="flat_rack" data-container-type="flat_rack" role="option" data-i18n="opt_cn_flatrack">
                                            <span>Flat-rack</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-iso_tank" data-value="iso_tank" data-container-type="iso_tank" role="option" data-i18n="opt_cn_isotank">
                                            <span>ISO Tank</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-bulk_container" data-value="bulk_container" data-container-type="bulk_container" role="option" data-i18n="opt_cn_bulk">
                                            <span>Bulk Container</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-palletized" data-value="palletized" data-container-type="palletized" role="option" data-i18n="opt_cn_pallet">
                                            <span>Palletized</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-wooden_crates" data-value="wooden_crates" data-container-type="wooden_crates" role="option" data-i18n="opt_cn_wooden">
                                            <span>Wooden Crates</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                        <div class="dropdown-option container-item" id="container-polybags_cartons" data-value="polybags_cartons" data-container-type="polybags_cartons" role="option" data-i18n="opt_cn_poly">
                                            <span>Polybags / Cartons</span>
                                            <span class="compatibility-badge" style="display: none;">--</span>
                                        </div>
                                    </div>
                                </div>
                                <span class="error-message" id="container_error"></span>
                                <div id="container-suggestion" class="suggestion-panel" style="display: none;"></div>
                            </div>

                            <!-- Packing Quality -->
                            <div class="form-group">
                                <label class="form-label" for="packaging_dropdown" data-i18n="label_packaging">
                                    <i class="ph ph-gift input-icon"></i>
                                    Ch·∫•t L∆∞·ª£ng ƒê√≥ng G√≥i
                                </label>
                                <div class="custom-dropdown" id="packaging_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder" data-i18n="placeholder_select">Select quality</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox">
                                        <div class="dropdown-option" data-value="poor" role="option" data-i18n="opt_pk_poor">Poor</div>
                                        <div class="dropdown-option" data-value="medium" role="option" data-i18n="opt_pk_medium">Medium</div>
                                        <div class="dropdown-option" data-value="good" role="option" data-i18n="opt_pk_good">Good</div>
                                        <div class="dropdown-option" data-value="excellent" role="option" data-i18n="opt_pk_excellent">Excellent</div>
                                    </div>
                                </div>
                                <span class="error-message" id="packaging_error"></span>
                            </div>

                        </div>


                        <!-- Climate Risk Panel (Collapsible) -->
                        <div id="climate-panel" class="climate-card" style="display: none;">
                            <div class="climate-header" onclick="toggleClimate()">
                                <div class="climate-header-title">
                                    <i class="ph ph-cloud-lightning" style="font-size: 18px; color: #00FFC8; margin-right: 8px; filter: drop-shadow(0 0 4px rgba(0, 255, 200, 0.5));"></i>
                                    <span>Climate Risk Overview</span>
                                    <span class="climate-header-score" id="climate-header-score">
                                        <span id="climate-stress-value-header">--</span>
                                        <span id="climate-stress-badge-header" class="badge">--</span>
                                    </span>
                                </div>
                                <span id="climate-arrow" class="climate-toggle-icon">‚ñº</span>
                            </div>
                            <div id="climate-body" class="climate-body hidden">
                                <div class="climate-body-content">
                                    <h3>
                                        ENSO INDEX: <span id="enso-value" style="color: #10B981; font-weight: 700;">La Ni√±a Phase (ONI: -0.6¬∞C)</span>
                                    </h3>
                                    <h3>
                                        T·∫¶N SU·∫§T B√ÉO: <span id="storm-value" style="color: #10B981; font-weight: 700;">3 c∆°n b√£o d·ª± ki·∫øn</span>
                                    </h3>
                                    <h3>
                                        NHI·ªÜT ƒê·ªò BI·ªÇN (SST): <span id="sst-value" style="color: #10B981; font-weight: 700;">-0.5¬∞C</span>
                                    </h3>
                                    <h3>
                                        <span style="color: #ffffff; font-weight: 700;">ƒêI·ªÇM √ÅP L·ª∞C KH√ç H·∫¨U:</span> 
                                        <span id="climate-stress-badge" class="badge critical" style="margin-left: 8px;">Critical</span>
                                        <span id="climate-stress-value" style="color: #10B981; font-weight: 700; margin-left: 8px;">8.7</span>
                                    </h3>
                                    <div style="position: relative; margin-top: 12px;">
                                        <input type="range" id="climate-stress-slider" min="1" max="10" value="8.7" step="0.1" disabled style="width: 100%; height: 8px; border-radius: 4px; background: var(--bg-tertiary); outline: none; opacity: 0.7;">
                                        <div class="slider-labels" style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 12px; font-weight: 700;">
                                            <span style="color: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px;">1</span>
                                            <span style="color: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px;">2</span>
                                            <span style="color: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px;">3</span>
                                            <span style="color: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px;">4</span>
                                            <span style="color: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px;">5</span>
                                            <span style="color: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px;">6</span>
                                            <span style="color: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px;">7</span>
                                            <span style="color: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px;">8</span>
                                            <span style="color: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px;">9</span>
                                            <span style="color: rgba(255, 255, 255, 0.8); padding: 2px 4px; border-radius: 3px;">10</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Priority Profile - Moved to end -->
                        <div class="form-group" style="grid-column: 1 / -1; margin-top: 24px;">
                            <label class="form-label" for="priority_dropdown" data-i18n="label_priority">
                                <i class="ph ph-star input-icon"></i>
                                H·ªì S∆° ∆Øu Ti√™n
                            </label>
                            <div class="custom-dropdown" id="priority_dropdown">
                                <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                    <span class="dropdown-value placeholder" data-i18n="placeholder_select">Ch·ªçn t√πy ch·ªçn</span>
                                    <span class="dropdown-arrow">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                        </svg>
                                    </span>
                                </div>
                                <div class="dropdown-menu" role="listbox">
                                    <div class="dropdown-option" data-value="economy" role="option" data-i18n="opt_pr_economy">Economy</div>
                                    <div class="dropdown-option" data-value="standard" role="option" data-i18n="opt_pr_standard">Standard</div>
                                    <div class="dropdown-option" data-value="express" role="option" data-i18n="opt_pr_express">Express</div>
                                    <div class="dropdown-option" data-value="critical" role="option" data-i18n="opt_pr_critical">Critical</div>
                                </div>
                            </div>
                            <span class="error-message" id="priority_error"></span>
                        </div>

                        <!-- Priority Weights Preview - Moved to end -->
                        <div id="priority-preview" class="priority-box" style="display: none; grid-column: 1 / -1;">
                            <div class="priority-weights-preview" id="priority_preview_box">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                                    <i class="ph ph-chart-bar" style="color: #00FFC8; font-size: 20px; filter: drop-shadow(0 0 4px rgba(0, 255, 200, 0.5));"></i>
                                    <h4 style="color: #00FFC8; font-size: 15px; font-weight: 600; margin: 0; text-shadow: 0 0 8px rgba(0, 255, 200, 0.3);">Priority Weights Preview</h4>
                                    <span id="priority_selected_badge" style="display: none; margin-left: auto; padding: 4px 10px; background: rgba(0, 255, 200, 0.2); color: #00FFC8; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; border: 1px solid rgba(0, 255, 200, 0.3);"></span>
                                </div>
                                <div class="grid-3" style="gap: 16px; margin-bottom: 16px;">
                                    <div style="text-align: center; padding: 12px; background: rgba(0, 255, 200, 0.08); border-radius: 8px; border: 1px solid rgba(0, 255, 200, 0.3); transition: all 0.3s ease;">
                                        <div style="display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 12px; color: #00FFC8; margin-bottom: 6px; font-weight: 500;">
                                            <i class="ph ph-timer" style="color: #00FFC8; font-size: 16px; filter: drop-shadow(0 0 4px rgba(0, 255, 200, 0.5));"></i>
                                            Speed
                                        </div>
                                        <div id="priority_speed_display" style="font-size: 24px; font-weight: 700; color: #00FFC8; transition: all 0.3s ease; text-shadow: 0 0 8px rgba(0, 255, 200, 0.4);">--</div>
                                    </div>
                                    <div style="text-align: center; padding: 12px; background: rgba(0, 255, 200, 0.08); border-radius: 8px; border: 1px solid rgba(0, 255, 200, 0.3); transition: all 0.3s ease;">
                                        <div style="display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 12px; color: #00FFC8; margin-bottom: 6px; font-weight: 500;">
                                            <i class="ph ph-currency-dollar" style="color: #00FFC8; font-size: 16px; filter: drop-shadow(0 0 4px rgba(0, 255, 200, 0.5));"></i>
                                            Cost
                                        </div>
                                        <div id="priority_cost_display" style="font-size: 24px; font-weight: 700; color: #00FFC8; transition: all 0.3s ease; text-shadow: 0 0 8px rgba(0, 255, 200, 0.4);">--</div>
                                    </div>
                                    <div style="text-align: center; padding: 12px; background: rgba(0, 255, 200, 0.08); border-radius: 8px; border: 1px solid rgba(0, 255, 200, 0.3); transition: all 0.3s ease;">
                                        <div style="display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 12px; color: #00FFC8; margin-bottom: 6px; font-weight: 500;">
                                            <i class="ph ph-warning" style="color: #00FFC8; font-size: 16px; filter: drop-shadow(0 0 4px rgba(0, 255, 200, 0.5));"></i>
                                            Risk
                                        </div>
                                        <div id="priority_risk_display" style="font-size: 24px; font-weight: 700; color: #00FFC8; transition: all 0.3s ease; text-shadow: 0 0 8px rgba(0, 255, 200, 0.4);">--</div>
                                    </div>
                                </div>
                                <p id="priority_description" style="margin-top: 0; font-size: 13px; color: rgba(0, 255, 200, 0.7); text-align: center; font-style: italic; padding: 12px; background: rgba(0, 255, 200, 0.05); border-radius: 8px; border: 1px solid rgba(0, 255, 200, 0.1);">Ch·ªçn ch·∫ø ƒë·ªô ∆∞u ti√™n ƒë·ªÉ xem ph√¢n b·ªï tr·ªçng s·ªë</p>
                            </div>
                        </div>

                        <div id="climate-section" style="display: none;"></div>
                    </div>
                </section>
 
                <!-- M·ª§C 02 ‚Äî CHI TI·∫æT L√î H√ÄNG & PACKING LIST (ULTRA PREMIUM 2026) -->
                <section id="cargo-details" class="form-section packing-list-section">
                    <div class="enterprise-section-card" id="section-cargo">
                        <h2 class="section-title">02. Cargo & Packing</h2>
                        <p class="section-subtitle">Specify quantity, timing, and cargo value</p>

                        <!-- Basic Shipment Info (ETD/ETA/Cargo Value) -->
                        <div class="grid grid-cols-2 gap-x-8 gap-y-6 w-full" style="margin-bottom: 32px;">
                            <!-- ETD -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_etd" for="etd">
                                    <i class="ph ph-calendar-blank input-icon"></i>
                                    ETD ‚Äì Ng√†y Kh·ªüi H√†nh
                                </label>
                                <div class="input-wrapper">
                                    <input type="date" id="etd" name="etd" class="form-input date-input" required />
                                    <span class="input-icon calendar-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <rect x="3" y="4" width="14" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M7 2V6M13 2V6M3 8H17" stroke="currentColor" stroke-width="1.5"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="etd_error"></span>
                            </div>

                            <!-- ETA -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_eta" for="eta">
                                    <i class="ph ph-calendar input-icon"></i>
                                    ETA ‚Äì Ng√†y ƒê·∫øn
                                </label>
                                <div class="input-wrapper">
                                    <input type="date" id="eta" name="eta" class="form-input date-input" required />
                                    <span class="input-icon calendar-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <rect x="3" y="4" width="14" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M7 2V6M13 2V6M3 8H17" stroke="currentColor" stroke-width="1.5"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="eta_error"></span>
                            </div>

                            <!-- Cargo Value -->
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label class="form-label" data-i18n="label_cargo_value" for="cargo_value">
                                    <i class="ph ph-currency-dollar input-icon"></i>
                                    Gi√° Tr·ªã H√†ng H√≥a
                                </label>
                                <div class="input-wrapper" style="position: relative;">
                                    <span class="input-prefix" style="left: 16px; top: 50%; transform: translateY(-50%); position: absolute; color: #00ff88; font-weight: 700; font-size: 16px; z-index: 2; text-shadow: 0 0 8px rgba(0, 255, 136, 0.5);">$</span>
                                    <input type="text" id="cargo_value" name="cargo_value" class="form-input with-prefix" placeholder="0" min="0" step="1" required style="padding-left: 36px; padding-right: 100px; font-size: 16px; font-weight: 600; letter-spacing: 0.5px;" />
                                    <div class="currency-selector" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); display: flex; align-items: center; gap: 6px; z-index: 2;">
                                        <span class="currency-text" style="color: rgba(255, 255, 255, 0.8); font-size: 13px; font-weight: 600;">USD</span>
                                        <button type="button" class="currency-toggle" style="background: rgba(0, 255, 136, 0.1); border: 1px solid rgba(0, 255, 136, 0.3); border-radius: 4px; padding: 2px 6px; cursor: pointer; color: #00ff88; font-size: 10px; transition: all 0.2s ease;" title="Change currency">
                                            <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                                                <path d="M3 4.5L6 1.5L9 4.5M3 7.5L6 10.5L9 7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <span class="error-message" id="cargo_value_error"></span>
                            </div>
                        </div>

                        <!-- Dynamic Packing List Table -->
                        <div class="packing-list-table-wrapper" style="margin-bottom: 32px;">
                            <table class="packing-list-table" id="packing-list-table">
                                <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>M√¥ T·∫£ H√†ng H√≥a</th>
                                        <th>S·ªë Ki·ªán</th>
                                        <th>Lo·∫°i ƒê√≥ng G√≥i</th>
                                        <th>D√†i x R·ªông x Cao (cm)</th>
                                        <th>Tr·ªçng L∆∞·ª£ng Ki·ªán (kg)</th>
                                        <th>Stackable</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="packing-list-tbody">
                                    <!-- Rows will be added dynamically -->
                                    <!-- Debug: Check if this tbody is visible -->
                                </tbody>
                            </table>
                            <button type="button" class="add-row-btn" id="add-packing-row">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 5V19M5 12H19" stroke-linecap="round"/>
                                </svg>
                                Th√™m H√†ng H√≥a
                            </button>
                        </div>

                        <!-- Auto-Calculation Panel -->
                        <div class="packing-calc-panel" id="packing-calc-panel">
                            <div class="calc-card">
                                <div class="calc-card-header">
                                    <div class="calc-card-label">
                                        Total Packages
                                        <svg class="tooltip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M12 16V12M12 8H12.01"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="calc-card-value highlight" id="calc-total-packages">0</div>
                                <div class="calc-card-unit">ki·ªán</div>
                            </div>

                            <div class="calc-card">
                                <div class="calc-card-header">
                                    <div class="calc-card-label">
                                        Total Gross Weight
                                        <svg class="tooltip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M12 16V12M12 8H12.01"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="calc-card-value highlight" id="calc-total-weight">0</div>
                                <div class="calc-card-unit">kg</div>
                            </div>

                            <div class="calc-card">
                                <div class="calc-card-header">
                                    <div class="calc-card-label">
                                        Total Volume
                                        <svg class="tooltip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M12 16V12M12 8H12.01"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="calc-card-value highlight" id="calc-total-volume">0</div>
                                <div class="calc-card-unit">m¬≥</div>
                            </div>

                            <div class="calc-card">
                                <div class="calc-card-header">
                                    <div class="calc-card-label">
                                        Chargeable Weight
                                        <svg class="tooltip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M12 16V12M12 8H12.01"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="calc-card-value highlight" id="calc-chargeable-weight">0</div>
                                <div class="calc-card-unit">kg (volumetric 1:167)</div>
                            </div>

                            <div class="calc-card">
                                <div class="calc-card-header">
                                    <div class="calc-card-label">
                                        Container Utilization
                                        <svg class="tooltip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M12 16V12M12 8H12.01"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="calc-card-value highlight" id="calc-container-util">0%</div>
                                <div class="progress-bar-wrapper">
                                    <div class="progress-bar">
                                        <div class="progress-bar-fill" id="util-progress-bar" style="width: 0%"></div>
                                    </div>
                                    <div class="progress-bar-text" id="util-progress-text">40HQ</div>
                                </div>
                            </div>

                            <div class="calc-card score-card">
                                <div class="calc-card-header">
                                    <div class="calc-card-label">
                                        Packing Quality Score
                                        <svg class="tooltip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M12 16V12M12 8H12.01"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="score-value" id="calc-packing-score">0.0</div>
                                <div class="calc-card-unit">/ 10 (affects insurance rate & risk)</div>
                            </div>
                        </div>

                        <!-- Hidden input for total packages (for form submission) -->
                        <input type="hidden" id="packages" name="packages" value="0">
                    </div>
                </section>

                <!-- SECTION 03: TH√îNG TIN NG∆Ø·ªúI B√ÅN (SELLER INFORMATION) -->
                <section id="seller-info" class="form-section">
                    <div class="enterprise-section-card" id="section-seller">
                        <h2 class="section-title">03. Seller Information</h2>
                        <p class="section-subtitle">Company details and contact information</p>

                        <div class="grid grid-cols-2 gap-x-8 gap-y-6 w-full">
                            <!-- 1. T√™n c√¥ng ty -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_seller_name" for="seller_name">
                                    <i class="ph ph-buildings input-icon"></i>
                                    T√™n C√¥ng Ty
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" id="seller_name" name="seller_name" class="form-input" data-i18n-placeholder="placeholder_seller_name" placeholder="Nh·∫≠p t√™n c√¥ng ty" />
                                    <span class="input-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path d="M3 6C3 4.89543 3.89543 4 5 4H15C16.1046 4 17 4.89543 17 6V14C17 15.1046 16.1046 16 15 16H5C3.89543 16 3 15.1046 3 14V6Z" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M7 8H13M7 12H11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="seller_name_error"></span>
                            </div>

                            <!-- 2. Qu·ªëc gia -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_seller_country" for="seller_country_dropdown">
                                    <i class="ph ph-flag input-icon"></i>
                                    Qu·ªëc Gia
                                </label>
                                <div class="custom-dropdown" id="seller_country_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder" data-i18n="placeholder_select">Ch·ªçn qu·ªëc gia</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox">
                                        <div class="dropdown-option" data-value="vn" role="option" data-i18n="opt_country_vn">Vi·ªát Nam</div>
                                        <div class="dropdown-option" data-value="us" role="option" data-i18n="opt_country_us">United States</div>
                                        <div class="dropdown-option" data-value="cn" role="option" data-i18n="opt_country_cn">China</div>
                                        <div class="dropdown-option" data-value="sg" role="option" data-i18n="opt_country_sg">Singapore</div>
                                        <div class="dropdown-option" data-value="jp" role="option" data-i18n="opt_country_jp">Japan</div>
                                        <div class="dropdown-option" data-value="kr" role="option" data-i18n="opt_country_kr">South Korea</div>
                                        <div class="dropdown-option" data-value="th" role="option" data-i18n="opt_country_th">Thailand</div>
                                        <div class="dropdown-option" data-value="my" role="option" data-i18n="opt_country_my">Malaysia</div>
                                        <div class="dropdown-option" data-value="id" role="option" data-i18n="opt_country_id">Indonesia</div>
                                        <div class="dropdown-option" data-value="ph" role="option" data-i18n="opt_country_ph">Philippines</div>
                                        <div class="dropdown-option" data-value="gb" role="option" data-i18n="opt_country_gb">United Kingdom</div>
                                        <div class="dropdown-option" data-value="de" role="option" data-i18n="opt_country_de">Germany</div>
                                        <div class="dropdown-option" data-value="fr" role="option" data-i18n="opt_country_fr">France</div>
                                        <div class="dropdown-option" data-value="au" role="option" data-i18n="opt_country_au">Australia</div>
                                        <div class="dropdown-option" data-value="other" role="option" data-i18n="opt_country_other">Other</div>
                                    </div>
                                </div>
                                <input type="hidden" name="seller_country" id="seller_country_input" value="">
                                <span class="error-message" id="seller_country_error"></span>
                            </div>

                            <!-- 3. Quy M√¥ C√¥ng Ty -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_seller_size" for="seller_size_dropdown">
                                    <i class="ph ph-users input-icon"></i>
                                    Quy M√¥ C√¥ng Ty
                                </label>
                                <div class="custom-dropdown" id="seller_size_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder">Ch·ªçn t√πy ch·ªçn</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox">
                                        <div class="dropdown-option" data-value="SME" role="option">SME (Small/Medium)</div>
                                        <div class="dropdown-option" data-value="Medium" role="option">Medium Enterprise</div>
                                        <div class="dropdown-option" data-value="Large" role="option">Large Corporation</div>
                                    </div>
                                </div>
                                <input type="hidden" name="seller_size" id="seller_size_input" value="">
                                <span class="error-message" id="seller_size_error"></span>
                            </div>

                            <!-- 4. Email -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_seller_email" for="seller_email">
                                    <i class="ph ph-envelope input-icon"></i>
                                    Email
                                </label>
                                <div class="input-wrapper">
                                    <input type="email" id="seller_email" name="seller_email" class="form-input" data-i18n-placeholder="placeholder_seller_email" placeholder="email@example.com" />
                                    <span class="input-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path d="M3 5C3 3.89543 3.89543 3 5 3H15C16.1046 3 17 3.89543 17 5V15C17 16.1046 16.1046 17 15 17H5C3.89543 17 3 16.1046 3 15V5Z" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M3 6L10 11L17 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="seller_email_error"></span>
                            </div>

                            <!-- 5. S·ªë ƒëi·ªán tho·∫°i -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_seller_phone" for="seller_phone">
                                    <i class="ph ph-phone input-icon"></i>
                                    S·ªë ƒêi·ªán Tho·∫°i
                                </label>
                                <div class="input-wrapper">
                                    <input type="tel" id="seller_phone" name="seller_phone" class="form-input" data-i18n-placeholder="placeholder_seller_phone" placeholder="+84 123 456 789" />
                                    <span class="input-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path d="M4 3C3.44772 3 3 3.44772 3 4V16C3 16.5523 3.44772 17 4 17H16C16.5523 17 17 16.5523 17 16V4C17 3.44772 16.5523 3 16 3H4Z" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M8 5H12M8 9H12M8 13H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="seller_phone_error"></span>
                            </div>

                            <!-- 6. Ng∆∞·ªùi ph·ª• tr√°ch -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_seller_pic" for="seller_pic">
                                    <i class="ph ph-user input-icon"></i>
                                    Ng∆∞·ªùi Ph·ª• Tr√°ch
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" id="seller_pic" name="seller_pic" class="form-input" data-i18n-placeholder="placeholder_seller_pic" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi ph·ª• tr√°ch" />
                                    <span class="input-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <circle cx="10" cy="7" r="3" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M5 17C5 13.6863 7.68629 11 10 11C12.3137 11 15 13.6863 15 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="seller_pic_error"></span>
                            </div>

                            <!-- 7. ƒê·ªãa ch·ªâ -->
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label class="form-label" data-i18n="label_seller_address" for="seller_address">
                                    <i class="ph ph-map-pin input-icon"></i>
                                    ƒê·ªãa Ch·ªâ
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" id="seller_address" name="seller_address" class="form-input" data-i18n-placeholder="placeholder_seller_address" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ" />
                                    <span class="input-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path d="M10 10.5C11.3807 10.5 12.5 9.38071 12.5 8C12.5 6.61929 11.3807 5.5 10 5.5C8.61929 5.5 7.5 6.61929 7.5 8C7.5 9.38071 8.61929 10.5 10 10.5Z" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M10 18C13 14.5 16 11.5 16 8C16 4.68629 13.3137 2 10 2C6.68629 2 4 4.68629 4 8C4 11.5 7 14.5 10 18Z" stroke="currentColor" stroke-width="1.5"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="seller_address_error"></span>
                            </div>

                            <!-- 8. ESG Score -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_seller_esg" for="seller_esg">
                                    <i class="ph ph-leaf input-icon"></i>
                                    ESG Score (0-100)
                                </label>
                                <input type="number" id="seller_esg" name="seller_esg" class="form-input" placeholder="50" min="0" max="100" step="1" />
                                <span class="field-hint">Higher = better ESG performance</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION 04: TH√îNG TIN NG∆Ø·ªúI MUA (BUYER INFORMATION) -->
                <section id="buyer-info" class="form-section">
                    <div class="enterprise-section-card" id="section-buyer">
                        <h2 class="section-title">04. Buyer Information</h2>
                        <p class="section-subtitle">Company details and contact information</p>

                        <div class="grid grid-cols-2 gap-x-8 gap-y-6 w-full">
                            <!-- 1. T√™n c√¥ng ty -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_buyer_name" for="buyer_name">
                                    <i class="ph ph-buildings input-icon"></i>
                                    T√™n C√¥ng Ty
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" id="buyer_name" name="buyer_name" class="form-input" data-i18n-placeholder="placeholder_buyer_name" placeholder="Nh·∫≠p t√™n c√¥ng ty" />
                                    <span class="input-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path d="M3 6C3 4.89543 3.89543 4 5 4H15C16.1046 4 17 4.89543 17 6V14C17 15.1046 16.1046 16 15 16H5C3.89543 16 3 15.1046 3 14V6Z" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M7 8H13M7 12H11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="buyer_name_error"></span>
                            </div>

                            <!-- 2. Qu·ªëc gia -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_buyer_country" for="buyer_country_dropdown">
                                    <i class="ph ph-flag input-icon"></i>
                                    Qu·ªëc Gia
                                </label>
                                <div class="custom-dropdown" id="buyer_country_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder" data-i18n="placeholder_select">Ch·ªçn qu·ªëc gia</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox">
                                        <div class="dropdown-option" data-value="vn" role="option" data-i18n="opt_country_vn">Vi·ªát Nam</div>
                                        <div class="dropdown-option" data-value="us" role="option" data-i18n="opt_country_us">United States</div>
                                        <div class="dropdown-option" data-value="cn" role="option" data-i18n="opt_country_cn">China</div>
                                        <div class="dropdown-option" data-value="sg" role="option" data-i18n="opt_country_sg">Singapore</div>
                                        <div class="dropdown-option" data-value="jp" role="option" data-i18n="opt_country_jp">Japan</div>
                                        <div class="dropdown-option" data-value="kr" role="option" data-i18n="opt_country_kr">South Korea</div>
                                        <div class="dropdown-option" data-value="th" role="option" data-i18n="opt_country_th">Thailand</div>
                                        <div class="dropdown-option" data-value="my" role="option" data-i18n="opt_country_my">Malaysia</div>
                                        <div class="dropdown-option" data-value="id" role="option" data-i18n="opt_country_id">Indonesia</div>
                                        <div class="dropdown-option" data-value="ph" role="option" data-i18n="opt_country_ph">Philippines</div>
                                        <div class="dropdown-option" data-value="gb" role="option" data-i18n="opt_country_gb">United Kingdom</div>
                                        <div class="dropdown-option" data-value="de" role="option" data-i18n="opt_country_de">Germany</div>
                                        <div class="dropdown-option" data-value="fr" role="option" data-i18n="opt_country_fr">France</div>
                                        <div class="dropdown-option" data-value="au" role="option" data-i18n="opt_country_au">Australia</div>
                                        <div class="dropdown-option" data-value="other" role="option" data-i18n="opt_country_other">Other</div>
                                    </div>
                                </div>
                                <input type="hidden" name="buyer_country" id="buyer_country_input" value="">
                                <span class="error-message" id="buyer_country_error"></span>
                            </div>

                            <!-- 3. Quy M√¥ C√¥ng Ty -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_buyer_size" for="buyer_size_dropdown">
                                    <i class="ph ph-users input-icon"></i>
                                    Quy M√¥ C√¥ng Ty
                                </label>
                                <div class="custom-dropdown" id="buyer_size_dropdown">
                                    <div class="dropdown-trigger" tabindex="0" role="button" aria-haspopup="listbox">
                                        <span class="dropdown-value placeholder">Ch·ªçn t√πy ch·ªçn</span>
                                        <span class="dropdown-arrow">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                                <path d="M5 8L10 13L15 8" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="dropdown-menu" role="listbox">
                                        <div class="dropdown-option" data-value="SME" role="option">SME (Small/Medium)</div>
                                        <div class="dropdown-option" data-value="Medium" role="option">Medium Enterprise</div>
                                        <div class="dropdown-option" data-value="Large" role="option">Large Corporation</div>
                                    </div>
                                </div>
                                <input type="hidden" name="buyer_size" id="buyer_size_input" value="">
                                <span class="error-message" id="buyer_size_error"></span>
                            </div>

                            <!-- 4. Email -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_buyer_email" for="buyer_email">
                                    <i class="ph ph-envelope input-icon"></i>
                                    Email
                                </label>
                                <div class="input-wrapper">
                                    <input type="email" id="buyer_email" name="buyer_email" class="form-input" data-i18n-placeholder="placeholder_buyer_email" placeholder="email@example.com" />
                                    <span class="input-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path d="M3 5C3 3.89543 3.89543 3 5 3H15C16.1046 3 17 3.89543 17 5V15C17 16.1046 16.1046 17 15 17H5C3.89543 17 3 16.1046 3 15V5Z" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M3 6L10 11L17 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="buyer_email_error"></span>
                            </div>

                            <!-- 5. S·ªë ƒëi·ªán tho·∫°i -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_buyer_phone" for="buyer_phone">
                                    <i class="ph ph-phone input-icon"></i>
                                    S·ªë ƒêi·ªán Tho·∫°i
                                </label>
                                <div class="input-wrapper">
                                    <input type="tel" id="buyer_phone" name="buyer_phone" class="form-input" data-i18n-placeholder="placeholder_buyer_phone" placeholder="+84 123 456 789" />
                                    <span class="input-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path d="M4 3C3.44772 3 3 3.44772 3 4V16C3 16.5523 3.44772 17 4 17H16C16.5523 17 17 16.5523 17 16V4C17 3.44772 16.5523 3 16 3H4Z" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M8 5H12M8 9H12M8 13H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="buyer_phone_error"></span>
                            </div>

                            <!-- 6. Ng∆∞·ªùi ph·ª• tr√°ch -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_buyer_pic" for="buyer_pic">
                                    <i class="ph ph-user input-icon"></i>
                                    Ng∆∞·ªùi Ph·ª• Tr√°ch
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" id="buyer_pic" name="buyer_pic" class="form-input" data-i18n-placeholder="placeholder_buyer_pic" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi ph·ª• tr√°ch" />
                                    <span class="input-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <circle cx="10" cy="7" r="3" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M5 17C5 13.6863 7.68629 11 10 11C12.3137 11 15 13.6863 15 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="buyer_pic_error"></span>
                            </div>

                            <!-- 7. ƒê·ªãa ch·ªâ -->
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label class="form-label" data-i18n="label_buyer_address" for="buyer_address">
                                    <i class="ph ph-map-pin input-icon"></i>
                                    ƒê·ªãa Ch·ªâ
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" id="buyer_address" name="buyer_address" class="form-input" data-i18n-placeholder="placeholder_buyer_address" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ" />
                                    <span class="input-icon">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                            <path d="M10 10.5C11.3807 10.5 12.5 9.38071 12.5 8C12.5 6.61929 11.3807 5.5 10 5.5C8.61929 5.5 7.5 6.61929 7.5 8C7.5 9.38071 8.61929 10.5 10 10.5Z" stroke="currentColor" stroke-width="1.5"/>
                                            <path d="M10 18C13 14.5 16 11.5 16 8C16 4.68629 13.3137 2 10 2C6.68629 2 4 4.68629 4 8C4 11.5 7 14.5 10 18Z" stroke="currentColor" stroke-width="1.5"/>
                                        </svg>
                                    </span>
                                </div>
                                <span class="error-message" id="buyer_address_error"></span>
                            </div>

                            <!-- 8. ESG Score -->
                            <div class="form-group">
                                <label class="form-label" data-i18n="label_buyer_esg" for="buyer_esg">
                                    <i class="ph ph-leaf input-icon"></i>
                                    ESG Score (0-100)
                                </label>
                                <input type="number" id="buyer_esg" name="buyer_esg" class="form-input" placeholder="50" min="0" max="100" step="1" />
                                <span class="field-hint">Higher = better ESG performance</span>
                            </div>
                        </div>
                    </div>
                </section>



                <!-- SECTION 05: M√î-ƒêUN THU·∫¨T TO√ÅN (RISK ENGINE MODULES) -->
                <section id="algorithm-modules" class="form-section">
                    <div class="enterprise-section-card" id="section-algorithms">
                        <h2 class="section-title">05. Algorithm Modules</h2>
                        <p class="section-subtitle">Configure risk calculation algorithms</p>

                        <div class="grid grid-cols-2 gap-6">
                            <div class="algorithm-module-card" data-module="fuzzy">
                                <div class="module-icon-wrapper">
                                    <i class="ph ph-brain" style="font-size: 24px; color: #00FFC8; filter: drop-shadow(0 0 4px rgba(0, 255, 200, 0.5));"></i>
                                </div>
                                <div class="module-title" data-i18n="module_fuzzy_title">Fuzzy AHP</div>
                                <div class="module-desc" data-i18n="module_fuzzy_desc">Multi-criteria decision analysis</div>
                                <div class="module-toggle">
                                    <div class="toggle-switch-enterprise active">
                                        <input type="checkbox" id="use_fuzzy" name="use_fuzzy" checked style="display: none;">
                                    </div>
                                </div>
                            </div>

                            <div class="algorithm-module-card" data-module="arima">
                                <div class="module-icon-wrapper">
                                    <i class="ph ph-chart-line-up" style="font-size: 24px; color: #00FFC8; filter: drop-shadow(0 0 4px rgba(0, 255, 200, 0.5));"></i>
                                </div>
                                <div class="module-title" data-i18n="module_arima_title">ARIMA Forecasting</div>
                                <div class="module-desc" data-i18n="module_arima_desc">Time series prediction model</div>
                                <div class="module-toggle">
                                    <div class="toggle-switch-enterprise active">
                                        <input type="checkbox" id="use_forecast" name="use_forecast" checked style="display: none;">
                                    </div>
                                </div>
                            </div>

                            <div class="algorithm-module-card" data-module="monte-carlo">
                                <div class="module-icon-wrapper">
                                    <i class="ph ph-dice-five" style="font-size: 24px; color: #00FFC8; filter: drop-shadow(0 0 4px rgba(0, 255, 200, 0.5));"></i>
                                </div>
                                <div class="module-title" data-i18n="module_mc_title">Monte Carlo</div>
                                <div class="module-desc" data-i18n="module_mc_desc">Stochastic simulation engine</div>
                                <div class="module-toggle">
                                    <div class="toggle-switch-enterprise active">
                                        <input type="checkbox" id="use_mc" name="use_mc" checked style="display: none;">
                                    </div>
                                </div>
                            </div>

                            <div class="algorithm-module-card" data-module="var">
                                <div class="module-icon-wrapper">
                                    <i class="ph ph-shield-warning" style="font-size: 24px; color: #00FFC8; filter: drop-shadow(0 0 4px rgba(0, 255, 200, 0.5));"></i>
                                </div>
                                <div class="module-title" data-i18n="module_var_title">VaR / CVaR</div>
                                <div class="module-desc" data-i18n="module_var_desc">Extreme risk quantification</div>
                                <div class="module-toggle">
                                    <div class="toggle-switch-enterprise active">
                                        <input type="checkbox" id="use_var" name="use_var" checked style="display: none;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>


                        <!-- Hidden inputs for backend -->
                        <input type="hidden" name="route_type" id="route_type_input" value="standard">
                        <input type="hidden" name="carrier_rating" id="carrier_rating" value="3.0">
                        <input type="hidden" name="container_match" id="container_match" value="8.0">
                    </section>

                <!-- SECTION 06: SUMMARY OVERVIEW -->
                <section id="summaryOverviewSection" class="form-section" style="margin-top: 32px;">
                    <div class="summary-section-header" style="margin-bottom: 24px;">
                        <h2 style="font-size: 24px; font-weight: 700; color: #e6fff8; margin-bottom: 4px;">06. Summary Overview</h2>
                        <p style="font-size: 13px; color: rgba(255, 255, 255, 0.6); margin-bottom: 24px;">T·ªïng h·ª£p to√†n b·ªô d·ªØ li·ªáu t·ª´ c√°c m·ª•c ƒë√£ nh·∫≠p</p>
                    </div>
                    
                    <!-- Summary Grid Container -->
                    <div class="overview-summary-grid" id="inputSummaryGrid">
                        <!-- Cards will be dynamically generated here by overview.js -->
                    </div>
                </section>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M3 10C3 13.866 6.134 17 10 17C12.389 17 14.531 15.955 16 14.292M17 10C17 6.134 13.866 3 10 3C7.611 3 5.469 4.045 4 5.708" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M3 5V10H8M17 15V10H12" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                        <span data-i18n="btn_reset">Reset Form</span>
                    </button>
                    <button type="submit" id="run_risk" class="btn btn-primary">
                        RUN RISK ANALYSIS
                    </button>
                </div>
                    </form>
                </div>
                </main>
            </div>
        </div>
    </div>
 
    <!-- Enterprise Input Layout JS -->
    <script src="/static/js/enterprise_input.js"></script>
    
    <!-- Smart Progress Tracker - NEW VERSION with improved logic -->
    <script src="/static/js/smart_progress_tracker.js"></script>
    
    <!-- Main Form JavaScript - Extracted to input_form.js for better organization -->
    <script src="/static/js/input_form.js"></script>
    
    <!-- Climate Data 2025 -->
    <script src="/static/js/climate_data_2025.js"></script>
    
    <!-- Logistics Data -->
    <script src="/static/js/logistics_data.js"></script>
    <script src="/static/js/booking_summary.js"></script>
    
    <!-- Packing List Module -->
    <script src="/static/js/packing_list.js"></script>
    <script>
        // Force initialize packing list and add first row
        (function() {
            function forceInitPackingList() {
                const tbody = document.getElementById('packing-list-tbody');
                const addBtn = document.getElementById('add-packing-row');
                
                if (tbody && tbody.children.length === 0) {
                    // If no rows, try to add one using the exported function
                    if (window.PackingList && typeof window.PackingList.addRow === 'function') {
                        window.PackingList.addRow();
                    } else if (addBtn) {
                        // Fallback: trigger click on add button
                        addBtn.click();
                    } else {
                        // Last resort: manually create a row
                        setTimeout(function() {
                            if (tbody.children.length === 0 && addBtn) {
                                addBtn.click();
                            }
                        }, 500);
                    }
                }
            }
            
            // Try multiple times to ensure it runs
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(forceInitPackingList, 100);
                    setTimeout(forceInitPackingList, 500);
                    setTimeout(forceInitPackingList, 1000);
                });
            } else {
                setTimeout(forceInitPackingList, 100);
                setTimeout(forceInitPackingList, 500);
                setTimeout(forceInitPackingList, 1000);
            }
        })();
    </script>
    
    <!-- RISKCAST v12/v13 ‚Äì UNLOCK ALL INPUTS & FIX CURSOR (Auto-run) -->
    <script>
        // ===== RISKCAST v12/v13 ‚Äì UNLOCK ALL INPUTS & FIX CURSOR (Ultra Force) =====
        (() => {
            function unlockForm() {
                console.log('üîì Unlocking RiskCast form...');

                // 1. M·ªü kh√≥a m·ªçi input, dropdown, textarea v·ªõi FORCE
                const allElements = document.querySelectorAll('input, select, textarea, .custom-dropdown, .dropdown-trigger, .dropdown-menu, .dropdown-option, .dropdown-value, button, [role="button"]');
                allElements.forEach(el => {
                    el.disabled = false;
                    el.readOnly = false;
                    el.removeAttribute('disabled');
                    el.removeAttribute('readonly');
                    el.classList.remove('disabled', 'locked', 'readonly', 'blocked');
                    el.style.setProperty('pointer-events', 'auto', 'important');
                    el.style.setProperty('opacity', '1', 'important');
                    el.style.setProperty('cursor', el.tagName === 'INPUT' || el.tagName === 'TEXTAREA' ? 'text' : 'pointer', 'important');
                    el.style.setProperty('z-index', '10000', 'important');
                    el.style.setProperty('position', 'relative', 'important');
                });

                // 2. Force unlock dropdowns ƒë·∫∑c bi·ªát
                document.querySelectorAll('.custom-dropdown').forEach(dropdown => {
                    dropdown.classList.remove('disabled', 'locked', 'blocked');
                    dropdown.style.setProperty('pointer-events', 'auto', 'important');
                    dropdown.style.setProperty('z-index', '10000', 'important');
                    
                    const trigger = dropdown.querySelector('.dropdown-trigger');
                    if (trigger) {
                        trigger.style.setProperty('pointer-events', 'auto', 'important');
                        trigger.style.setProperty('cursor', 'pointer', 'important');
                        trigger.style.setProperty('z-index', '10001', 'important');
                        trigger.removeAttribute('disabled');
                        trigger.classList.remove('disabled', 'locked');
                    }
                    
                    const menu = dropdown.querySelector('.dropdown-menu');
                    if (menu) {
                        menu.style.setProperty('pointer-events', 'auto', 'important');
                        menu.style.setProperty('z-index', '10002', 'important');
                    }
                    
                    dropdown.querySelectorAll('.dropdown-option').forEach(option => {
                        option.style.setProperty('pointer-events', 'auto', 'important');
                        option.style.setProperty('cursor', 'pointer', 'important');
                        option.style.setProperty('z-index', '10003', 'important');
                    });
                });

                // 3. Fix cursor kh√¥ng hi·ªán (do CSS !important ch·∫∑n) - ULTRA FORCE
                const styleId = 'riskcast-unlock-styles';
                let style = document.getElementById(styleId);
                if (!style) {
                    style = document.createElement('style');
                    style.id = styleId;
                    document.head.appendChild(style);
                }
                style.innerHTML = `
                    input, textarea, select, [contenteditable], .dropdown-trigger, .dropdown-value, .custom-dropdown {
                        pointer-events: auto !important;
                        cursor: text !important;
                        opacity: 1 !important;
                        caret-color: #00ffc3 !important;
                        z-index: 10000 !important;
                        position: relative !important;
                    }
                    .dropdown-trigger, .custom-dropdown, .dropdown-menu, .dropdown-option {
                        pointer-events: auto !important;
                        cursor: pointer !important;
                        opacity: 1 !important;
                        z-index: 10000 !important;
                        position: relative !important;
                    }
                    .custom-dropdown.disabled,
                    .custom-dropdown.locked,
                    .custom-dropdown.blocked,
                    input.disabled,
                    input[readonly],
                    .dropdown-trigger.disabled,
                    .dropdown-trigger.locked {
                        pointer-events: auto !important;
                        cursor: pointer !important;
                        opacity: 1 !important;
                        background: rgba(0, 255, 136, 0.08) !important;
                        z-index: 10000 !important;
                    }
                    /* Remove all overlays blocking clicks */
                    .form-section::before,
                    .form-section::after,
                    .enterprise-section-card::before,
                    .enterprise-section-card::after,
                    .panel::before,
                    .panel::after {
                        display: none !important;
                        pointer-events: none !important;
                        z-index: -1 !important;
                    }
                `;

                // 4. B·ªè backdrop/blocker che form (n·∫øu c√≥) - ULTRA FORCE
                document.querySelectorAll('.loading-overlay, .form-blocker, .backdrop, [id*="overlay"], [class*="overlay"], [class*="blocker"]').forEach(el => {
                    if (el.id !== 'ai-chat-popup' && !el.closest('#ai-chat-popup') && !el.closest('.dropdown-menu')) {
                        el.style.setProperty('display', 'none', 'important');
                        el.style.setProperty('pointer-events', 'none', 'important');
                        el.style.setProperty('opacity', '0', 'important');
                        el.style.setProperty('z-index', '-1', 'important');
                        el.style.setProperty('visibility', 'hidden', 'important');
                    }
                });
                document.body.style.overflow = 'auto';

                // 5. Force enable click events cho dropdowns
                document.querySelectorAll('.dropdown-trigger').forEach(trigger => {
                    // Remove all event listeners blocking
                    const newTrigger = trigger.cloneNode(true);
                    trigger.parentNode.replaceChild(newTrigger, trigger);
                    
                    // Add click handler directly
                    newTrigger.addEventListener('click', function(e) {
                        e.stopPropagation();
                        e.preventDefault();
                        const dropdown = this.closest('.custom-dropdown');
                        if (dropdown) {
                            dropdown.classList.toggle('active');
                            const menu = dropdown.querySelector('.dropdown-menu');
                            if (menu) {
                                menu.style.setProperty('display', menu.style.display === 'block' ? 'none' : 'block', 'important');
                                menu.style.setProperty('visibility', menu.style.display === 'block' ? 'visible' : 'hidden', 'important');
                                menu.style.setProperty('opacity', menu.style.display === 'block' ? '1' : '0', 'important');
                                menu.style.setProperty('z-index', '10003', 'important');
                            }
                        }
                    }, true);
                });

                // 6. Force ch·ªçn 1 route ph·ªï bi·∫øn ƒë·ªÉ h·ªá th·ªëng "nghƒ©" l√† ƒë√£ ch·ªçn (t·ª± ƒë·ªông m·ªü POL/POD/Carrier)
                const commonRoutes = ['vn_us', 'vn_cn', 'vn_eu', 'vn_kr', 'vn_jp', 'domestic'];
                const routeDropdown = document.getElementById('route_dropdown');
                if (routeDropdown) {
                    const currentValue = routeDropdown.querySelector('.dropdown-value')?.textContent?.trim();
                    if (!currentValue || currentValue === 'Ch·ªçn tuy·∫øn...' || currentValue === 'Select route...' || currentValue === 'Ch·ªçn t√πy ch·ªçn') {
                        setTimeout(() => {
                            for (const route of commonRoutes) {
                                const option = routeDropdown.querySelector(`.dropdown-option[data-value="${route}"]`);
                                if (option) {
                                    option.click();
                                    console.log(`‚úÖ Auto-selected route: ${route}`);
                                    break;
                                }
                            }
                        }, 500);
                    }
                }

                // 7. Re-run Smart Input n·∫øu c√≥
                if (window.SmartInputSystem?.init) {
                    setTimeout(() => {
                        try {
                            SmartInputSystem.init();
                        } catch (e) {
                            console.warn('SmartInputSystem.init() error:', e);
                        }
                    }, 500);
                }

                console.log('‚úÖ Form ƒë√£ ƒë∆∞·ª£c m·ªü kh√≥a 100%! B√¢y gi·ªù b·∫°n c√≥ th·ªÉ ch·ªânh m·ªçi th·ª© tho·∫£i m√°i.');
            }

            // Run immediately if DOM is ready, otherwise wait - MULTIPLE TIMES
            function runUnlock() {
                unlockForm();
                setTimeout(unlockForm, 100);
                setTimeout(unlockForm, 300);
                setTimeout(unlockForm, 500);
                setTimeout(unlockForm, 1000);
                setTimeout(unlockForm, 2000);
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', runUnlock);
            } else {
                runUnlock();
            }

            // Also run on window load
            window.addEventListener('load', () => {
                setTimeout(unlockForm, 500);
                setTimeout(unlockForm, 1000);
            });
        })();
    </script>
    
    <!-- Premium Input Tracker -->
    <script src="/static/js/premium_input_tracker.js"></script>
    
    <!-- Smart Input System -->
    <script src="/static/js/smart_input.js"></script>
    
    <!-- AI Adviser (includes climate data updater) -->
    <script src="/static/js/streaming.js"></script>
    <script src="/static/js/ai_adviser.js"></script>
    
    <!-- Existing scripts -->
    <script src="/static/js/input.js"></script>
    
    <!-- AI Chat Toggle Button (Small Round Button - Always Visible) -->
    <div class="ai-chat-toggle" id="ai-toggle" style="display: flex !important; visibility: visible !important; opacity: 1 !important; position: fixed !important; bottom: 20px !important; right: 20px !important; z-index: 99999 !important;">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        <span>Ask AI</span>
        <div class="online-dot"></div>
    </div>

    <!-- AI Chat Panel (Hidden by default, slides up on click) -->
    <div class="ai-chat-panel" id="ai-panel" style="display: none !important; position: fixed !important; bottom: 20px !important; right: 20px !important; z-index: 99998 !important;">
        <div class="ai-header">
            <div class="ai-info">
                <div class="ai-avatar">ü§ñ</div>
                <div>
                    <div class="ai-name">RISKCAST AI Assistant</div>
                    <div class="ai-status">Online ‚Ä¢ 24/7</div>
                </div>
            </div>
            <button class="ai-minimize" id="ai-minimize" aria-label="Minimize chat">_</button>
        </div>
        <div class="ai-messages" id="ai-messages">
            <div class="ai-bubble">Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p b·∫°n ƒëi·ªÅn form, gi·∫£i th√≠ch d·ªØ li·ªáu ho·∫∑c ƒë·ªÅ xu·∫•t gi√° tr·ªã ph√π h·ª£p cho ph√¢n t√≠ch r·ªßi ro.</div>
        </div>
        <div class="ai-input-area">
            <input type="text" placeholder="H·ªèi t√¥i v·ªÅ form nh·∫≠p li·ªáu..." id="ai-input" autocomplete="off">
            <button id="ai-send">Send</button>
        </div>
    </div>

    <!-- Legacy AI Chat Widget (Keep for backward compatibility, hidden) -->
    <div class="ai-widget-container" id="aiWidgetContainer" style="display: none;">
        <!-- 3D Bot Character -->
        <div class="ai-bot-3d" id="aiBot">
            <div class="bot-head">
                <div class="bot-antenna"></div>
                <div class="bot-eyes">
                    <div class="bot-eye"></div>
                    <div class="bot-eye"></div>
                </div>
                <div class="bot-mouth"></div>
            </div>
            <div class="bot-body">
                <div class="bot-arm left"></div>
                <div class="bot-arm right"></div>
            </div>
            <div class="bot-legs">
                <div class="bot-leg"></div>
                <div class="bot-leg"></div>
            </div>
        </div>
    </div>

    <!-- AI Chat Popup -->
    <div class="ai-chat-popup" id="chatPopup" aria-live="polite">
        <div class="chat-header">
            <div class="chat-header-info">
                <div class="chat-avatar">ü§ñ</div>
                <div class="chat-title">
                    <h3>RISKCAST AI Assistant</h3>
                    <div class="chat-status">
                        <span class="status-dot"></span>
                        <span>Online ‚Ä¢ 24/7</span>
                    </div>
                </div>
            </div>
            <button class="chat-close" id="chatClose" aria-label="ƒê√≥ng tr·ª£ l√Ω">‚úï</button>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message ai">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-bubble">
                    Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p b·∫°n ƒëi·ªÅn form, gi·∫£i th√≠ch c√°c tr∆∞·ªùng d·ªØ li·ªáu, ho·∫∑c ƒë·ªÅ xu·∫•t gi√° tr·ªã ph√π h·ª£p cho ph√¢n t√≠ch r·ªßi ro. üëã
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <input 
                    type="text" 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="H·ªèi t√¥i v·ªÅ form nh·∫≠p li·ªáu..."
                    autocomplete="off"
                >
                <button class="chat-send-btn" id="sendButton" aria-label="G·ª≠i c√¢u h·ªèi">‚û§</button>
            </div>
        </div>
    </div>

    <!-- AI Chat JavaScript -->
    <script src="/static/js/ai_chat.js"></script>
        
        <!-- Summary JavaScript for real-time updates -->
        <script src="/static/js/summary.js"></script>
        
        <!-- Summary initialization - Extracted to input_summary_init.js -->
        <script src="/static/js/input_summary_init.js"></script>
        
        <!-- RiskCast Data Store -->
        <script src="/static/js/riskcast_data_store.js"></script>

    <!-- Premium Neon Border Effects for All Input Fields -->
    <style>
        /* ============================================================
           PREMIUM NEON BORDER EFFECTS - All Input/Select/Textarea
           ============================================================ */
        
        /* Base styles for all form inputs */
        #risk_form input[type="text"],
        #risk_form input[type="number"],
        #risk_form input[type="email"],
        #risk_form input[type="tel"],
        #risk_form input[type="date"],
        #risk_form input[type="month"],
        #risk_form input[type="time"],
        #risk_form input[type="url"],
        #risk_form input[type="search"],
        #risk_form select,
        #risk_form textarea,
        .form-input:not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="checkbox"]):not([type="radio"]):not([type="hidden"]),
        input.form-input:not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="checkbox"]):not([type="radio"]):not([type="hidden"]) {
            transition: all 0.3s ease;
            border-radius: 12px !important;
        }
        
        /* Exclude buttons, checkboxes, radio, hidden inputs - kh√¥ng c·∫ßn ruleset v√¨ ƒë√£ lo·∫°i tr·ª´ trong selectors ·ªü tr√™n */
        
        /* FOCUS STATE - Vi·ªÅn s√°ng xanh ng·ªçc khi focus */
        #risk_form input[type="text"]:focus:not([disabled]):not([readonly]),
        #risk_form input[type="number"]:focus:not([disabled]):not([readonly]),
        #risk_form input[type="email"]:focus:not([disabled]):not([readonly]),
        #risk_form input[type="tel"]:focus:not([disabled]):not([readonly]),
        #risk_form input[type="date"]:focus:not([disabled]):not([readonly]),
        #risk_form input[type="month"]:focus:not([disabled]):not([readonly]),
        #risk_form input[type="time"]:focus:not([disabled]):not([readonly]),
        #risk_form input[type="url"]:focus:not([disabled]):not([readonly]),
        #risk_form input[type="search"]:focus:not([disabled]):not([readonly]),
        #risk_form select:focus:not([disabled]):not([readonly]),
        #risk_form textarea:focus:not([disabled]):not([readonly]),
        .form-input:focus:not([disabled]):not([readonly]):not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="checkbox"]):not([type="radio"]):not([type="hidden"]) {
            outline: none !important;
            border: 2px solid #00ff9d !important;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.5) !important;
            border-radius: 12px !important;
            transition: all 0.3s ease !important;
        }
        
        /* FILLED STATE - Vi·ªÅn s√°ng nh·∫π h∆°n khi c√≥ n·ªôi dung nh∆∞ng kh√¥ng focus */
        #risk_form input[type="text"]:not(:focus):not(:placeholder-shown):not([disabled]):not([readonly]):not([value=""]),
        #risk_form input[type="number"]:not(:focus):not(:placeholder-shown):not([disabled]):not([readonly]):not([value=""]),
        #risk_form input[type="email"]:not(:focus):not(:placeholder-shown):not([disabled]):not([readonly]):not([value=""]),
        #risk_form input[type="tel"]:not(:focus):not(:placeholder-shown):not([disabled]):not([readonly]):not([value=""]),
        #risk_form input[type="date"]:not(:focus):not([disabled]):not([readonly]):not([value=""]),
        #risk_form input[type="month"]:not(:focus):not([disabled]):not([readonly]):not([value=""]),
        #risk_form input[type="time"]:not(:focus):not([disabled]):not([readonly]):not([value=""]),
        #risk_form input[type="url"]:not(:focus):not(:placeholder-shown):not([disabled]):not([readonly]):not([value=""]),
        #risk_form input[type="search"]:not(:focus):not(:placeholder-shown):not([disabled]):not([readonly]):not([value=""]),
        #risk_form select:not(:focus):not([disabled]):not([readonly])[value]:not([value=""]),
        #risk_form textarea:not(:focus):not(:placeholder-shown):not([disabled]):not([readonly]) {
            border: 2px solid #00ff9d !important;
            box-shadow: 0 0 12px rgba(0, 255, 157, 0.3) !important;
            border-radius: 12px !important;
        }
        
        /* JavaScript helper ƒë·ªÉ detect filled state cho select v√† inputs kh√¥ng h·ªó tr·ª£ :placeholder-shown */
        /* S·∫Ω d√πng class "has-value" ƒë·ªÉ mark c√°c √¥ ƒë√£ c√≥ gi√° tr·ªã */
        #risk_form input.has-value:not(:focus):not([disabled]):not([readonly]),
        #risk_form select.has-value:not(:focus):not([disabled]):not([readonly]),
        #risk_form textarea.has-value:not(:focus):not([disabled]):not([readonly]) {
            border: 2px solid #00ff9d !important;
            box-shadow: 0 0 12px rgba(0, 255, 157, 0.3) !important;
            border-radius: 12px !important;
        }
        
        /* ƒê·∫£m b·∫£o border-radius cho t·∫•t c·∫£ inputs */
        #risk_form input:not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="checkbox"]):not([type="radio"]),
        #risk_form select,
        #risk_form textarea {
            border-radius: 12px !important;
        }
    </style>
    
    <!-- JavaScript to add "has-value" class for filled inputs -->
    <script>
        (function() {
            'use strict';
            
            // Function to check if input has value
            function checkValue(element) {
                const value = element.value;
                const hasValue = value && value.trim() !== '' && value !== '0';
                
                if (hasValue) {
                    element.classList.add('has-value');
                } else {
                    element.classList.remove('has-value');
                }
            }
            
            // Apply to all form inputs on page load
            document.addEventListener('DOMContentLoaded', function() {
                const form = document.getElementById('risk_form');
                if (!form) return;
                
                // Get all inputs, selects, textareas
                const inputs = form.querySelectorAll('input[type="text"], input[type="number"], input[type="email"], input[type="tel"], input[type="date"], input[type="month"], input[type="time"], input[type="url"], input[type="search"], select, textarea');
                
                // Check initial values
                inputs.forEach(function(input) {
                    if (input.disabled || input.readonly) return;
                    checkValue(input);
                    
                    // Add event listeners
                    input.addEventListener('input', function() {
                        checkValue(this);
                    });
                    input.addEventListener('change', function() {
                        checkValue(this);
                    });
                    input.addEventListener('blur', function() {
                        checkValue(this);
                    });
                });
                
                // Also handle dropdown selects (custom dropdowns)
                const customSelects = form.querySelectorAll('.custom-dropdown');
                customSelects.forEach(function(select) {
                    const hiddenInput = select.querySelector('input[type="hidden"]') || 
                                      document.getElementById(select.id.replace('_dropdown', '_input'));
                    if (hiddenInput) {
                        const observer = new MutationObserver(function() {
                            checkValue(hiddenInput);
                        });
                        observer.observe(hiddenInput, { attributes: true, attributeFilter: ['value'] });
                        
                        // Also check on change
                        select.addEventListener('change', function() {
                            setTimeout(function() {
                                checkValue(hiddenInput);
                            }, 100);
                        });
                    }
                });
            });
        })();
    </script>
    
    <!-- JavaScript to update month display in neon format -->
    <script>
        (function() {
            'use strict';
            
            function updateMonthDisplay() {
                const monthInput = document.getElementById('shipment-month');
                const monthDisplay = document.getElementById('shipment-month-display');
                
                if (!monthInput || !monthDisplay) {
                    // Retry if elements not loaded yet
                    setTimeout(updateMonthDisplay, 100);
                    return;
                }
                
                const value = monthInput.value; // Format: "2025-11"
                if (!value) {
                    monthDisplay.value = 'Ch·ªçn th√°ng';
                    return;
                }
                
                // Parse month from "2025-11" format
                const parts = value.split('-');
                if (parts.length < 2) {
                    monthDisplay.value = 'Ch·ªçn th√°ng';
                    return;
                }
                
                const year = parts[0];
                const month = parts[1];
                const monthNum = parseInt(month, 10);
                
                // Display format: "26/11/2025" (day 26 of the selected month) INSIDE the input
                if (!isNaN(monthNum) && monthNum >= 1 && monthNum <= 12) {
                    // Format: DD/MM/YYYY (using day 26 as requested)
                    const day = '26';
                    const formattedDate = `${day}/${month}/${year}`;
                    monthDisplay.value = formattedDate;
                    // Apply neon styling
                    monthDisplay.style.color = '#00ff9d';
                    monthDisplay.style.fontWeight = '700';
                    monthDisplay.style.textShadow = '0 0 10px rgba(0, 255, 157, 0.6)';
                } else {
                    monthDisplay.value = 'Ch·ªçn th√°ng';
                    monthDisplay.style.color = '';
                    monthDisplay.style.fontWeight = '';
                    monthDisplay.style.textShadow = '';
                }
            }
            
            // Initialize on DOM ready and add event listeners
            function initMonthDisplay() {
                const monthInput = document.getElementById('shipment-month');
                const monthDisplay = document.getElementById('shipment-month-display');
                
                if (!monthInput || !monthDisplay) {
                    setTimeout(initMonthDisplay, 100);
                    return;
                }
                
                // Initial update
                updateMonthDisplay();
                
                // Show Priority Weights Preview if month is already selected
                const priorityPreview = document.getElementById('priority-preview');
                if (priorityPreview && monthInput.value) {
                    priorityPreview.style.display = 'block';
                    // Update priority display if already selected
                    if (typeof window.updatePriorityWeightsDisplay === 'function') {
                        setTimeout(() => window.updatePriorityWeightsDisplay(), 200);
                    }
                }
                
                // Sync display input with month input
                monthInput.addEventListener('change', function() {
                    updateMonthDisplay();
                    // Show Priority Weights Preview when month is selected
                    const priorityPreview = document.getElementById('priority-preview');
                    if (priorityPreview && this.value) {
                        priorityPreview.style.display = 'block';
                        // Update priority display if already selected
                        if (typeof window.updatePriorityWeightsDisplay === 'function') {
                            window.updatePriorityWeightsDisplay();
                        }
                    } else if (priorityPreview && !this.value) {
                        priorityPreview.style.display = 'none';
                    }
                    // Also trigger any climate data updates
                    if (typeof window.updateClimateData === 'function') {
                        window.updateClimateData();
                    }
                });
                monthInput.addEventListener('input', function() {
                    updateMonthDisplay();
                    // Show Priority Weights Preview when month is selected
                    const priorityPreview = document.getElementById('priority-preview');
                    if (priorityPreview && this.value) {
                        priorityPreview.style.display = 'block';
                    } else if (priorityPreview && !this.value) {
                        priorityPreview.style.display = 'none';
                    }
                });
                
                // Make the display input trigger the hidden month input
                monthDisplay.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    try {
                        // Only call showPicker if it's available and from user gesture
                        if (monthInput.showPicker && e.isTrusted) {
                            monthInput.showPicker();
                        } else {
                            monthInput.focus();
                            monthInput.click();
                        }
                    } catch (err) {
                        // Fallback to click if showPicker fails
                        console.warn('showPicker failed, using click fallback:', err);
                        monthInput.focus();
                        monthInput.click();
                    }
                });
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initMonthDisplay);
            } else {
                initMonthDisplay();
            }
        })();
        
        // Cargo Value Formatting
        (function() {
            function formatCurrency(value) {
                // Remove all non-digit characters
                const numValue = value.replace(/\D/g, '');
                if (!numValue) return '';
                // Format with commas
                return numValue.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            }
            
            function initCargoValue() {
                const cargoInput = document.getElementById('cargo_value');
                if (!cargoInput) {
                    setTimeout(initCargoValue, 100);
                    return;
                }
                
                // Store raw value (without commas) in a hidden field for form submission
                let hiddenInput = document.getElementById('cargo_value_raw');
                if (!hiddenInput) {
                    hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = 'cargo_value_raw';
                    hiddenInput.id = 'cargo_value_raw';
                    cargoInput.parentNode.appendChild(hiddenInput);
                }
                
                // Allow typing numbers freely - only remove non-digits, no formatting while typing
                cargoInput.addEventListener('input', function(e) {
                    const input = e.target;
                    const cursorPos = input.selectionStart;
                    const oldValue = input.value;
                    
                    // Get raw numeric value (remove all non-digits)
                    const rawValue = oldValue.replace(/\D/g, '');
                    
                    // Update hidden field with raw value
                    hiddenInput.value = rawValue;
                    
                    // Only update if value changed (to avoid cursor jumping)
                    if (input.value !== rawValue) {
                        // Count digits before cursor to restore position
                        const digitsBeforeCursor = oldValue.substring(0, cursorPos).replace(/\D/g, '').length;
                        
                        // Set raw value (no commas while typing)
                        input.value = rawValue;
                        
                        // Restore cursor position after digits
                        setTimeout(() => {
                            const newPos = Math.min(digitsBeforeCursor, rawValue.length);
                            input.setSelectionRange(newPos, newPos);
                        }, 0);
                    }
                });
                
                // Format on blur if needed
                cargoInput.addEventListener('blur', function(e) {
                    const value = e.target.value.replace(/\D/g, '');
                    if (value) {
                        e.target.value = formatCurrency(value);
                    } else {
                        e.target.value = '';
                    }
                });
                
                // Update the original input's value before form submit (remove commas)
                const form = cargoInput.closest('form');
                if (form) {
                    form.addEventListener('submit', function(e) {
                        const rawValue = cargoInput.value.replace(/\D/g, '');
                        cargoInput.value = rawValue;
                    });
                }
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initCargoValue);
            } else {
                initCargoValue();
            }
        })();
    </script>
    
    <!-- Premium Transit Time Display Styling -->
    <style>
        /* Climate Section Styling - Premium Border */
        #climate-section h3 {
            border-bottom: none !important;
            text-decoration: none !important;
            padding-bottom: 0 !important;
        }
        
        #climate-section {
            transition: all 0.3s ease;
        }
        
        #climate-section:hover {
            box-shadow: 0 0 30px rgba(0, 255, 157, 0.5);
            border-color: #00ff9d;
        }
        
        /* Shipment Month Display Input Styling */
        #shipment-month-display {
            transition: all 0.3s ease;
        }
        
        #shipment-month-display:not([value=""]) {
            border-color: #00ff9d !important;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
            background: rgba(0, 255, 157, 0.05);
        }
        
        #shipment-month-display:focus {
            border-color: #00ff9d !important;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
            outline: none;
        }
        
        /* Transit Time Display - Balanced Styling */
        #transit_time_display {
            font-size: 24px !important;
            font-weight: 700 !important;
            color: #00ff9d !important;
            text-shadow: 0 0 12px rgba(0, 255, 157, 0.6), 0 0 20px rgba(0, 255, 157, 0.4) !important;
            text-align: center !important;
            line-height: 1.2 !important;
        }
        
        #transit_time_display[value=""] {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: rgba(255, 255, 255, 0.4) !important;
            text-shadow: none !important;
        }
        
        .input-wrapper .input-suffix {
            font-size: 14px !important;
            font-weight: 600 !important;
            color: rgba(255, 255, 255, 0.7) !important;
        }
        
        /* Cargo Value Input - Premium Styling */
        #cargo_value {
            background: rgba(0, 255, 136, 0.05) !important;
            border-color: rgba(0, 255, 136, 0.3) !important;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1) !important;
        }
        
        #cargo_value:focus {
            background: rgba(0, 255, 136, 0.08) !important;
            border-color: #00ff88 !important;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4), inset 0 0 10px rgba(0, 255, 136, 0.1) !important;
        }
        
        #cargo_value:not(:placeholder-shown) {
            color: #00ff88 !important;
            font-weight: 700 !important;
        }
        
        .currency-toggle:hover {
            background: rgba(0, 255, 136, 0.2) !important;
            border-color: #00ff88 !important;
            box-shadow: 0 0 8px rgba(0, 255, 136, 0.4) !important;
            transform: translateY(-50%) scale(1.05) !important;
        }
        
        .currency-toggle:active {
            transform: translateY(-50%) scale(0.95) !important;
        }
        
        /* Ensure input wrapper for transit time has proper padding */
        #transit_time_display:not([value=""]) ~ .input-suffix {
            color: rgba(255, 255, 255, 0.8) !important;
        }
    </style>
    
    <script>
        // URGENT FIX: Force enable form inputs and remove all blocking overlays
        (function() {
            console.log('üîß [FORM FIX] Initializing form input fix...');
            
            function forceEnableForm() {
                console.log('üîß [FORM FIX] Running force enable...');
                
                // 1. Remove ALL loading overlays
                const loadingOverlays = document.querySelectorAll('.loading-overlay, #loadingOverlay');
                loadingOverlays.forEach(overlay => {
                    overlay.classList.remove('active');
                    overlay.style.display = 'none';
                    overlay.style.pointerEvents = 'none';
                    overlay.style.visibility = 'hidden';
                    overlay.style.opacity = '0';
                    overlay.style.zIndex = '-1';
                    console.log('‚úÖ Removed loading overlay');
                });
                
                // 2. FORCE REMOVE body locks (overflow, position fixed) - CRITICAL FIX
                // This fixes the issue where AI Chat or other modals lock the body
                if (document.body.style.position === 'fixed' || document.body.style.overflow === 'hidden') {
                    const scrollY = document.body.style.top ? parseInt(document.body.style.top.replace('-', '')) : window.scrollY;
                    document.body.style.overflow = '';
                    document.body.style.position = '';
                    document.body.style.top = '';
                    document.body.style.width = '';
                    document.documentElement.style.scrollBehavior = '';
                    
                    // Restore scroll position after unlock (but prevent scroll if user is interacting)
                    const currentScrollY = window.scrollY;
                    setTimeout(() => {
                        // Only restore if we're not in the middle of a user interaction
                        if (scrollY && Math.abs(currentScrollY - window.scrollY) < 100) {
                            // Use smooth scroll only if not actively scrolling
                            requestAnimationFrame(() => {
                                if (!document.hasFocus() || document.activeElement === document.body) {
                                    window.scrollTo({ top: scrollY, behavior: 'auto' });
                                }
                            });
                        }
                    }, 10);
                    console.log('‚úÖ Removed body locks (was locked!)');
                } else {
                    // Ensure body is unlocked even if not locked
                    document.body.style.overflow = '';
                    document.body.style.position = '';
                    document.body.style.top = '';
                    document.body.style.width = '';
                    document.documentElement.style.scrollBehavior = '';
                    console.log('‚úÖ Body is unlocked');
                }
                
                // 3. Force enable form and all inputs
                const form = document.getElementById('risk_form');
                if (form) {
                    form.style.pointerEvents = 'auto';
                    form.style.zIndex = '999999';
                    form.style.position = 'relative';
                    
                    // Enable ALL inputs and dropdowns (but preserve readonly on display fields)
                    const allInputs = form.querySelectorAll('input, select, textarea');
                    const allDropdowns = form.querySelectorAll('.custom-dropdown, .dropdown-trigger, .dropdown-menu');
                    const allElements = [...allInputs, ...allDropdowns];
                    
                    allElements.forEach(element => {
                        // Don't remove readonly from display fields
                        const isDisplayField = element.id && (element.id.includes('display') || element.id.includes('transit_time_display'));
                        
                        // Remove blocking attributes (but keep readonly on display fields)
                        if (!isDisplayField && element.hasAttribute('readonly')) {
                            element.removeAttribute('readonly');
                        }
                        if (element.hasAttribute('disabled')) {
                            element.removeAttribute('disabled');
                        }
                        
                        // Force enable pointer events
                        element.style.pointerEvents = 'auto';
                        if (element.classList.contains('dropdown-trigger') || element.classList.contains('dropdown-menu')) {
                            element.style.cursor = 'pointer';
                        } else if (element.type === 'range') {
                            element.style.cursor = 'pointer';
                        } else if (!isDisplayField) {
                            element.style.cursor = 'text';
                        }
                        element.style.zIndex = '1000';
                        
                        // Remove blocking classes
                        element.classList.remove('disabled', 'blocked');
                        
                        // Enable tabindex (but skip display fields and dropdown menus)
                        if (!isDisplayField && !element.classList.contains('dropdown-menu') && element.tabIndex < 0) {
                            element.tabIndex = 0;
                        }
                    });
                    console.log('‚úÖ Enabled', allInputs.length, 'inputs and', allDropdowns.length, 'dropdowns');
                }
                
                // 4. Remove any backdrop overlays that might block
                const backdrops = document.querySelectorAll('.backdrop, .overlay, .modal-backdrop, [class*="backdrop"], [class*="overlay"]');
                backdrops.forEach(backdrop => {
                    if (!backdrop.closest('#ai-panel') && !backdrop.closest('.ai-chat-popup')) {
                        backdrop.style.pointerEvents = 'none';
                        backdrop.style.zIndex = '-1';
                        console.log('‚úÖ Removed blocking backdrop');
                    }
                });
                
                // 5. Ensure main container and form sections are accessible
                const mainContainer = document.querySelector('.main-container');
                if (mainContainer) {
                    mainContainer.style.pointerEvents = 'auto';
                    mainContainer.style.zIndex = '1';
                    mainContainer.style.position = 'relative';
                }
                
                // 6. CRITICAL: Force enable all inputs with maximum priority
                const allFormInputs = form.querySelectorAll('input, select, textarea, button, .dropdown-trigger');
                allFormInputs.forEach(input => {
                    // Skip display fields
                    if (input.id && (input.id.includes('display') || input.id.includes('transit_time_display'))) {
                        return;
                    }
                    
                    // Force enable with maximum priority
                    input.style.setProperty('pointer-events', 'auto', 'important');
                    input.style.setProperty('z-index', '99999', 'important');
                    input.style.setProperty('position', 'relative', 'important');
                    input.disabled = false;
                    input.readOnly = false;
                    input.removeAttribute('readonly');
                    input.removeAttribute('disabled');
                    input.classList.remove('disabled', 'readonly', 'locked');
                    
                    // Add click listener to force enable on interaction
                    input.addEventListener('click', function(e) {
                        e.stopPropagation();
                        this.style.setProperty('pointer-events', 'auto', 'important');
                        this.style.setProperty('z-index', '999999', 'important');
                    }, true);
                    
                    input.addEventListener('focus', function(e) {
                        e.stopPropagation();
                        this.style.setProperty('pointer-events', 'auto', 'important');
                        this.style.setProperty('z-index', '999999', 'important');
                    }, true);
                });
                console.log('‚úÖ [FORM FIX]', allFormInputs.length, 'inputs are enabled and ready for input');
                
                // 7. Ensure all form sections are clickable
                const formSections = form.querySelectorAll('.form-section, .step-content, .collapsible-section');
                formSections.forEach(section => {
                    section.style.pointerEvents = 'auto';
                    section.style.zIndex = '1';
                });
                
                console.log('‚úÖ [FORM FIX] Form should now be fully interactive!');
                
                // Verify inputs are enabled (silent check, no auto-focus)
                const enabledInputs = form.querySelectorAll('input:not([readonly]):not([disabled]), select:not([disabled]), textarea:not([readonly]):not([disabled])');
                console.log(`‚úÖ [FORM FIX] ${enabledInputs.length} inputs are enabled and ready for input`);
                
                // CRITICAL: Force enable Section 01 (Transport Setup) inputs
                const sectionTransport = document.getElementById('section-transport');
                if (sectionTransport) {
                    const transportInputs = sectionTransport.querySelectorAll('input:not([type="hidden"]), select, textarea, .dropdown-trigger, .custom-dropdown');
                    transportInputs.forEach(el => {
                        el.style.setProperty('pointer-events', 'auto', 'important');
                        el.style.setProperty('z-index', '99999', 'important');
                        el.style.setProperty('position', 'relative', 'important');
                        el.style.setProperty('opacity', '1', 'important');
                        el.style.setProperty('cursor', 'pointer', 'important');
                        if (el.hasAttribute('disabled')) {
                            el.removeAttribute('disabled');
                        }
                        if (el.hasAttribute('readonly') && !el.id.includes('display') && !el.id.includes('transit_time_display')) {
                            el.removeAttribute('readonly');
                        }
                    });
                    console.log(`‚úÖ [FORM FIX] Force enabled ${transportInputs.length} inputs in Section 01`);
                }
            }
            
            // Run once on DOM ready
            let formEnabled = false;
            function enableFormOnce() {
                if (formEnabled) return;
                formEnabled = true;
                forceEnableForm();
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', enableFormOnce);
            } else {
                enableFormOnce();
            }
            
            // Run once more after a short delay to catch late-loading issues
            setTimeout(enableFormOnce, 100);
            
            // Remove the click listener that was causing issues
            // Form should stay enabled after initial setup
            
            // Lightweight fix: Only enable disabled/readonly inputs when user tries to interact
            document.addEventListener('focusin', function(e) {
                if (e.target.closest('#risk_form') && (e.target.hasAttribute('disabled') || e.target.hasAttribute('readonly'))) {
                    // Only fix readonly if it's not a display field
                    if (!e.target.id.includes('display') && !e.target.id.includes('transit_time_display')) {
                        e.target.removeAttribute('disabled');
                        e.target.removeAttribute('readonly');
                        e.target.style.pointerEvents = 'auto';
                    }
                }
            }, false); // Use false instead of true to avoid capture phase conflicts
            
            // Lightweight observer: Only re-enable disabled inputs (preserve readonly on display fields)
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes') {
                        const target = mutation.target;
                        if (target.closest('#risk_form')) {
                            const isDisplayField = target.id && (target.id.includes('display') || target.id.includes('transit_time_display'));
                            
                            // Only fix disabled (not readonly - let display fields keep readonly)
                            if (target.hasAttribute('disabled') && !isDisplayField) {
                                target.removeAttribute('disabled');
                                target.style.pointerEvents = 'auto';
                            }
                        }
                    }
                });
            });
            
            // Start observing form for disabled changes only
            const formForObserver = document.getElementById('risk_form');
            if (formForObserver) {
                observer.observe(formForObserver, {
                    attributes: true,
                    attributeFilter: ['disabled'],
                    subtree: true
                });
            }
            
            // CRITICAL FIX: Also monitor body for lock styles
            const bodyObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes') {
                        const target = mutation.target;
                        if (target === document.body) {
                            if (target.style.position === 'fixed' || target.style.overflow === 'hidden') {
                                // Don't unlock if AI chat is open
                                const chatPopup = document.querySelector('.ai-chat-popup.active');
                                if (!chatPopup) {
                                    console.warn('‚ö†Ô∏è Body locked detected, unlocking...');
                                    // Don't auto-scroll when unlocking - preserve user's current scroll position
                                    target.style.overflow = '';
                                    target.style.position = '';
                                    target.style.top = '';
                                    target.style.width = '';
                                    // Skip scroll restoration to prevent unwanted jumps
                                }
                            }
                        }
                    }
                });
            });
            
            // Observe body for lock changes
            bodyObserver.observe(document.body, {
                attributes: true,
                attributeFilter: ['style'],
                attributeOldValue: true
            });
        })();
    </script>

    <!-- Summary Overview Script -->
    <script src="/static/js/overview.js"></script>
    
    <!-- Initialize Summary Overview for Input Page -->
    <script>
    (function() {
        function initInputPageOverview() {
            const inputGrid = document.getElementById('inputSummaryGrid');
            if (!inputGrid) {
                setTimeout(initInputPageOverview, 200);
                return;
            }
            
            // Wait for overview.js to load
            if (typeof window.RiskCastOverview === 'undefined') {
                setTimeout(initInputPageOverview, 200);
                return;
            }
            
            // Temporarily rename grid ID to match overview.js expectation
            const originalId = inputGrid.id;
            inputGrid.id = 'summaryGrid';
            
            // Force refresh
            if (window.RiskCastOverview.refresh) {
                window.RiskCastOverview.refresh();
            }
            
            // Restore original ID
            inputGrid.id = originalId;
            
            console.log('‚úÖ Summary Overview initialized for Input Page');
        }
        
        // Try multiple times
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(initInputPageOverview, 300);
            });
        } else {
            setTimeout(initInputPageOverview, 300);
        }
        
        // Also try on window load
        window.addEventListener('load', function() {
            setTimeout(initInputPageOverview, 500);
        });
    })();
    </script>

</body>
</html>

