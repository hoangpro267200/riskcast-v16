<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RISKCAST v12.5 ‚Äî SUPER MODE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- External CSS files -->
    <link rel="stylesheet" href="/static/css/results.css">
    <link rel="stylesheet" href="/static/css/neon_icons.css">
    <link rel="stylesheet" href="/static/css/ai_panel.css">
    <link rel="stylesheet" href="/static/css/neon.css">
    
    <!-- External JS libraries -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="/static/js/translations_en.js"></script>
    <script src="/static/js/translations_vi.js"></script>
    <script src="/static/js/common_lang.js"></script>
    <script src="/static/js/results_core.js"></script>
    <script src="/static/js/streaming.js"></script>
    <script src="/static/js/ai_adviser.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="brand">
                    <div class="logo">R</div>
                    <div class="brand-text">
                        <h1>RISKCAST v12.5</h1>
                        <p id="brand-subtitle" data-lang="brand_subtitle">N·ªÅn T·∫£ng Th√¥ng Minh Ph√¢n T√≠ch R·ªßi Ro Logistics ƒê∆∞·ª£c H·ªó Tr·ª£ B·ªüi AI</p>
                    </div>
                </div>
                <div class="header-meta">
                    <div class="lang-switcher">
                        <button class="lang-btn active" data-lang="vi" id="lang-btn-vi">VI</button>
                        <button class="lang-btn" data-lang="en" id="lang-btn-en">EN</button>
                    </div>
                    <div class="chip status">
                        <span class="pulse"></span>
                        <span id="statusText" data-lang="status_ready">Ph√¢n T√≠ch Ho√†n T·∫•t</span>
                    </div>
                    <div class="chip" id="routeChip" data-lang="loading">ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶</div>
                    <div class="chip" id="dateChip" data-lang="loading">ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶</div>
                    <button id="ai-chat-toggle" class="neon-button" style="display: none;">
                        <span>ü§ñ</span> AI Chat
                    </button>
                </div>
            </div>
        </header>

        <div class="view-mode-tabs">
            <button class="view-tab active" data-mode="enterprise">Ch·∫ø ƒê·ªô Doanh Nghi·ªáp</button>
            <button class="view-tab" data-mode="nckh">Ch·∫ø ƒê·ªô Ph√¢n T√≠ch NCKH</button>
            <button class="view-tab" data-mode="investor">Ch·∫ø ƒê·ªô Tr√¨nh B√†y Nh√† ƒê·∫ßu T∆∞</button>
        </div>

        <!-- RESULTS LAYOUT: Dashboard -->
        <div class="results-main">
                <!-- ENTERPRISE MODE -->
                <div id="mode-enterprise" class="mode-section">
                    <div id="enterprise" class="panel">
                        <div class="dashboard-container">
                            <!-- Executive Overview Section -->
                            <section id="executive_overview" class="card-section section-block overview-risk">
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="section-title card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 21L12 3L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 17L12 11L17 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div> <span data-lang="section_executive">T·ªïng Quan ƒêi·ªÅu H√†nh</span></h2>
                                        <span class="card-badge" data-lang="tab_enterprise">Ch·∫ø ƒê·ªô Doanh Nghi·ªáp</span>
                                    </div>
                                    <div class="section-content">
                                    <div class="grid-4">
                                        <div class="kpi-card">
                                            <div class="kpi-label" id="label-overall-risk" data-lang="label_overall_risk">Ch·ªâ s·ªë r·ªßi ro t·ªïng h·ª£p</div>
                                            <div class="kpi-value" id="overall-risk-index">--</div>
                                            <div class="kpi-subtitle" id="risk-level-label">--</div>
                                        </div>
                                        <div class="kpi-card">
                                            <div class="kpi-label" id="label-expected-loss" data-lang="label_expected_loss">T·ªïn th·∫•t k·ª≥ v·ªçng</div>
                                            <div class="kpi-value" id="expected-loss">--</div>
                                            <div class="kpi-subtitle" data-lang="subtitle_per_shipment">M·ªói l√¥ h√†ng</div>
                                        </div>
                                        <div class="kpi-card">
                                            <div class="kpi-label" id="label-reliability" data-lang="label_reliability">ƒê·ªô tin c·∫≠y giao h√†ng</div>
                                            <div class="kpi-value" id="reliability-score">--</div>
                                            <div class="kpi-subtitle" data-lang="subtitle_on_time_prob">X√°c su·∫•t ƒë√∫ng h·∫°n</div>
                                        </div>
                                        <div class="kpi-card">
                                            <div class="kpi-label" id="label-esg" data-lang="label_esg">ƒêi·ªÉm ESG (M√¥i tr∆∞·ªùng ‚Äì X√£ h·ªôi ‚Äì Qu·∫£n tr·ªã)</div>
                                            <div class="kpi-value" id="esg-score">--</div>
                                            <div class="kpi-subtitle" data-lang="subtitle_climate_political">Kh√≠ h·∫≠u + Ch√≠nh tr·ªã</div>
                                        </div>
                                    </div>
                                    
                                    <ul class="insight-list" style="margin-top: 24px;">
                                        <li><strong id="label-top-route" data-lang="label_top_route">R·ªßi ro tuy·∫øn v·∫≠n t·∫£i l·ªõn nh·∫•t:</strong> <span id="top-route-risk">--</span></li>
                                        <li><strong id="label-main-driver" data-lang="label_main_driver">Nguy√™n nh√¢n ch√≠nh:</strong> <span id="main-driver">--</span></li>
                                        <li><strong id="label-recommendation" data-lang="label_recommendation">Khuy·∫øn ngh·ªã c·ªßa h·ªá th·ªëng:</strong> <span id="recommendation">--</span></li>
                                    </ul>
                                    </div>
                                </div>
                            </section>

                            <!-- Risk Gauges Overview -->
                            <section class="section-block">
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M12 6V12L16 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M12 2L14 8L20 8L15 12L17 18L12 15L7 18L9 12L4 8L10 8Z" stroke="currentColor" stroke-width="1.5" fill="none"/></svg></div> <span data-lang="section_risk_gauges">T·ªïng Quan ƒê·ªìng H·ªì R·ªßi Ro</span></h2>
                                    </div>
                                    <div class="gauge-grid">
                                        <div id="risk_overview_overall" class="chart-container gauge-container">
                                            <div id="gaugeRisk"></div>
                                            <div class="gauge-description">
                                                <p class="desc-title">Ch·ªâ s·ªë r·ªßi ro t·ªïng (Risk Score)</p>
                                                <p class="desc-text">Th·ªÉ hi·ªán m·ª©c ƒë·ªô r·ªßi ro chung c·ªßa l√¥ h√†ng d·ª±a tr√™n tuy·∫øn ƒë∆∞·ªùng, kh√≠ h·∫≠u, lo·∫°i h√†ng v√† ƒë·ªô tin c·∫≠y. ƒêi·ªÉm cao (>70) nghƒ©a l√† r·ªßi ro l·ªõn v√† c·∫ßn c√≥ bi·ªán ph√°p gi·∫£m thi·ªÉu.</p>
                                                <p class="desc-text" style="margin-top: 8px; font-size: 12px; opacity: 0.7;"><strong>Ng∆∞·ª°ng ƒë√°nh gi√°:</strong> &lt;40 Low, 40-70 Moderate, &gt;70 High</p>
                                            </div>
                                        </div>
                                        <div id="risk_overview_reliability" class="chart-container gauge-container">
                                            <div id="gaugeReliability"></div>
                                            <div class="gauge-description">
                                                <p class="desc-title">ƒê·ªô tin c·∫≠y giao h√†ng (Reliability)</p>
                                                <p class="desc-text">Bi·ªÉu th·ªã x√°c su·∫•t giao ƒë√∫ng h·∫°n. ƒêi·ªÉm cao (>80) nghƒ©a l√† tuy·∫øn ƒë∆∞·ªùng ·ªïn ƒë·ªãnh v√† √≠t gi√°n ƒëo·∫°n.</p>
                                                <p class="desc-text" style="margin-top: 8px; font-size: 12px; opacity: 0.7;"><strong>Ng∆∞·ª°ng ƒë√°nh gi√°:</strong> &lt;60 Low, 60-80 Moderate, &gt;80 High</p>
                                            </div>
                                        </div>
                                        <div id="risk_overview_esg" class="chart-container gauge-container">
                                            <div id="gaugeEsg"></div>
                                            <div class="gauge-description">
                                                <p class="desc-title">ƒêi·ªÉm ESG</p>
                                                <p class="desc-text">Ph·∫£n √°nh m·ª©c ƒë·ªô b·ªÅn v·ªØng v√† t√°c ƒë·ªông m√¥i tr∆∞·ªùng ‚Äì x√£ h·ªôi c·ªßa qu√° tr√¨nh v·∫≠n chuy·ªÉn. ƒêi·ªÉm th·∫•p (&lt;40) c√≥ th·ªÉ d·∫´n ƒë·∫øn r·ªßi ro ch√≠nh tr·ªã ho·∫∑c kh√≠ h·∫≠u.</p>
                                                <p class="desc-text" style="margin-top: 8px; font-size: 12px; opacity: 0.7;"><strong>Ng∆∞·ª°ng ƒë√°nh gi√°:</strong> &lt;40 Low, 40-70 Moderate, &gt;70 High</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Priority Profile Section -->
                            <section class="priority-profile-section">
                                <h2 class="pp-title">H·ªì s∆° ∆∞u ti√™n ‚Äî Priority Profile</h2>
                                <p class="pp-sub">Tr·ªçng s·ªë Speed ‚Äì Cost ‚Äì Risk theo l·ª±a ch·ªçn c·ªßa doanh nghi·ªáp</p>

                                <div class="pp-gauge-row">
                                    <div class="pp-gauge-box">
                                        <div id="gaugeSpeed"></div>
                                        <p class="gauge-label">T·ªëc ƒë·ªô (Speed)</p>
                                        <p class="gauge-explanation">M·ª©c ƒë·ªô ∆∞u ti√™n giao h√†ng nhanh. ƒêi·ªÉm cao nghƒ©a l√† doanh nghi·ªáp ƒë·ªÅ cao t·ªëc ƒë·ªô h∆°n chi ph√≠.</p>
                                    </div>

                                    <div class="pp-gauge-box">
                                        <div id="gaugeCost"></div>
                                        <p class="gauge-label">Chi ph√≠ (Cost)</p>
                                        <p class="gauge-explanation">M·ª©c ƒë·ªô ∆∞u ti√™n ti·∫øt ki·ªám chi ph√≠. ƒêi·ªÉm cao nghƒ©a l√† c·∫ßn t·ªëi ∆∞u chi ph√≠ v·∫≠n chuy·ªÉn.</p>
                                    </div>

                                    <div class="pp-gauge-box">
                                        <div id="gaugeRiskTolerance"></div>
                                        <p class="gauge-label">R·ªßi ro (Risk Tolerance)</p>
                                        <p class="gauge-explanation">M·ª©c ch·∫•p nh·∫≠n r·ªßi ro. ƒêi·ªÉm th·∫•p nghƒ©a l√† doanh nghi·ªáp c·∫ßn an to√†n cao.</p>
                                    </div>
                                </div>
                            </section>

                            <!-- Buyer-Seller Analysis -->
                            <section class="section-block">
                                <div class="card" id="buyer-seller-card" style="display: none;">
                                    <div class="card-header">
                                        <h2 class="card-title">
                                            <div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89317 18.7122 8.75608 18.1676 9.45768C17.623 10.1593 16.8604 10.6597 16 10.88M13 7C13 9.20914 11.2091 11 9 11C6.79086 11 5 9.20914 5 7C5 4.79086 6.79086 3 9 3C11.2091 3 13 4.79086 13 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                                            <span>R·ªßi ro Ng∆∞·ªùi Mua & Ng∆∞·ªùi B√°n</span>
                                        </h2>
                                    </div>
                                    <div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                                        <div class="kpi-card">
                                            <div class="kpi-label">ƒêi·ªÉm R·ªßi Ro Ng∆∞·ªùi Mua</div>
                                            <div class="kpi-value" id="buyer_score">--</div>
                                            <div class="kpi-subtitle">Buyer Risk Score</div>
                                        </div>
                                        <div class="kpi-card">
                                            <div class="kpi-label">ƒêi·ªÉm R·ªßi Ro Ng∆∞·ªùi B√°n</div>
                                            <div class="kpi-value" id="seller_score">--</div>
                                            <div class="kpi-subtitle">Seller Risk Score</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Additional Charts -->
                                <div class="grid-2">
                                    <div class="card">
                                        <div class="card-header">
                                            <h2 class="card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="6" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/><path d="M12 3L12 12L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div> Bi·ªÉu ƒê·ªì Radar H·ªì S∆° R·ªßi Ro</h2>
                                        </div>
                                        <div class="chart-container">
                                            <div id="radarChart" style="height: 400px;"></div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">
                                            <h2 class="card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="7" width="18" height="3" stroke="currentColor" stroke-width="2" rx="1"/><rect x="3" y="11" width="18" height="3" stroke="currentColor" stroke-width="2" rx="1"/><rect x="3" y="15" width="18" height="3" stroke="currentColor" stroke-width="2" rx="1"/></svg></div> <span data-lang="section_layers">Ph√¢n T√≠ch Ph√¢n L·ªõp R·ªßi Ro</span></h2>
                                        </div>
                                        <div class="chart-container">
                                            <div id="layerChart" style="height: 400px;"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Monte Carlo & Timeline -->
                                <div class="grid-2">
                                    <div class="card">
                                        <div class="card-header">
                                            <h2 class="card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="6" height="6" stroke="currentColor" stroke-width="2"/><rect x="15" y="15" width="6" height="6" stroke="currentColor" stroke-width="2"/><rect x="9" y="9" width="6" height="6" stroke="currentColor" stroke-width="2"/><path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="6" cy="6" r="1.5" fill="currentColor"/><circle cx="18" cy="18" r="1.5" fill="currentColor"/></svg></div> <span data-lang="section_montecarlo">Ph√¢n Ph·ªëi Monte Carlo</span></h2>
                                        </div>
                                        <div class="chart-container">
                                            <div id="mcChart" style="height: 350px;"></div>
                                        </div>
                                        <div class="alert-box">
                                            <strong>VaR (95%):</strong> <span id="mcVar">28.000 USD</span> | 
                                            <strong>CVaR (95%):</strong> <span id="mcCVar">35.000 USD</span> | 
                                            D·ª±a tr√™n <span id="mcRuns">10.000</span> m√¥ ph·ªèng
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">
                                            <h2 class="card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="6" cy="6" r="2" fill="currentColor"/><circle cx="12" cy="12" r="2" fill="currentColor"/><circle cx="18" cy="18" r="2" fill="currentColor"/></svg></div> <span data-lang="section_timeline">D√≤ng Th·ªùi Gian R·ªßi Ro</span></h2>
                                        </div>
                                        <div class="chart-container">
                                            <div id="timelineChart" style="height: 350px;"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Risk Matrix -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="18" height="18" stroke="currentColor" stroke-width="2" rx="1"/><path d="M3 9H21M3 15H21M9 3V21M15 3V21" stroke="currentColor" stroke-width="2"/></svg></div> <span data-lang="section_matrix">Ma Tr·∫≠n R·ªßi Ro X√°c Su·∫•t √ó T√°c ƒê·ªông</span></h2>
                                    </div>
                                    <div class="chart-container">
                                        <div id="riskMatrixChart" style="height: 400px;"></div>
                                    </div>
                                    <p style="margin-top: 16px; color: var(--text-secondary); font-size: 14px;">
                                        Ma tr·∫≠n n√†y x√°c ƒë·ªãnh c√°c r·ªßi ro ∆∞u ti√™n cao b·∫±ng c√°ch v·∫Ω x√°c su·∫•t so v·ªõi t√°c ƒë·ªông ti·ªÅm nƒÉng. 
                                        T·∫≠p trung n·ªó l·ª±c gi·∫£m thi·ªÉu v√†o c√°c r·ªßi ro trong v√πng <strong>ƒë·ªè (g√≥c tr√™n b√™n ph·∫£i)</strong> v√† <strong>v√†ng (gi·ªØa)</strong>.
                                    </p>
                                </div>

                                <!-- Scenario Testing -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2L3 7V12C3 16.5 6 20.16 12 21C18 20.16 21 16.5 21 12V7L12 2Z" stroke="currentColor" stroke-width="2"/><path d="M12 8V12L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 12H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div> <span data-lang="section_scenario">Ki·ªÉm Tra √Åp L·ª±c K·ªãch B·∫£n (What-if)</span></h2>
                                    </div>
                                    <div class="grid-scenario">
                                        <div>
                                            <h3 class="chart-title">Ch·ªçn K·ªãch B·∫£n</h3>
                                            <div class="scenario-pills" id="scenarioPills">
                                                <!-- Buttons will be generated by JS -->
                                            </div>
                                        </div>
                                        <div>
                                            <div class="scenario-summary" id="scenarioSummary">
                                                <h4 style="color: var(--text-primary); margin-bottom: 8px;">Tr∆∞·ªùng H·ª£p C∆° B·∫£n</h4>
                                                <p style="color: var(--text-secondary); font-size: 14px;" id="scenario-description">ƒêang t·∫£i m√¥ t·∫£...</p>
                                            </div>
                                            <div class="chart-container" style="margin-top: 20px;">
                                                <div id="scenarioChart" style="height: 350px;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Trade-off Analysis -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="8" cy="8" r="3" stroke="currentColor" stroke-width="2"/><circle cx="16" cy="16" r="3" stroke="currentColor" stroke-width="2"/><path d="M11 8L13 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 11L16 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div> <span data-lang="section_tradeoff">ƒê√°nh ƒê·ªïi Chi Ph√≠-Th·ªùi Gian-R·ªßi Ro</span></h2>
                                    </div>
                                    <div class="chart-container">
                                        <div id="tradeoffChart" style="height: 300px;"></div>
                                    </div>
                                    <p style="margin-top: 16px; color: var(--text-secondary); font-size: 14px;">
                                        <strong>Th·ªèa hi·ªáp t·ªët nh·∫•t:</strong> Tuy·∫øn ƒë∆∞·ªùng hi·ªán t·∫°i mang l·∫°i hi·ªáu su·∫•t c√¢n b·∫±ng tr√™n chi ph√≠, th·ªùi gian v·∫≠n chuy·ªÉn v√† c√°c y·∫øu t·ªë r·ªßi ro.
                                    </p>
                                </div>

                                <!-- Route Level Analysis -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M5 12L19 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M12 5L19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="5" cy="12" r="2" fill="currentColor"/><circle cx="19" cy="12" r="2" fill="currentColor"/></svg></div> <span data-lang="section_route">Ph√¢n T√≠ch Theo C·∫•p ƒê·ªô Tuy·∫øn ƒê∆∞·ªùng</span></h2>
                                    </div>
                                    <div class="grid-route">
                                        <div class="chart-container">
                                            <div id="routeBreakdownChart" style="height: 400px;"></div>
                                        </div>
                                        <div>
                                            <h3 class="chart-title">Chi Ti·∫øt R·ªßi Ro Theo ƒêo·∫°n</h3>
                                            <div id="routeBreakdownTable">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- AI Recommendations -->
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 8L16 8M8 16L16 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div> <span data-lang="section_recommendations">Khuy·∫øn Ngh·ªã T·ª´ Chuy√™n Gia AI</span></h2>
                                    </div>
                                    <ul class="insight-list" id="recommendations-list">
                                        <li>ƒêang t·∫£i khuy·∫øn ngh·ªã...</li>
                                    </ul>
                                </div>
                        </div>
                    </div>
                </div>

                <!-- RESEARCH MODE -->
                <div id="mode-research" class="mode-section view-hidden">
                    <div id="research" class="panel">
                        <div class="dashboard-container">
                            <section id="research_overview" class="card-section">
                                <div class="card">
                                    <div class="card-header">
                                        <h2 class="section-title card-title"><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg></div> T·ªïng Quan Ph∆∞∆°ng Ph√°p Nghi√™n C·ª©u</h2>
                                        <span class="card-badge">NCKH / Academic</span>
                                    </div>
                                    <div class="section-content">
                                        <p style="color: var(--text-secondary); font-size: 15px; line-height: 1.8; margin-bottom: 20px;">
                                            Ph√¢n t√≠ch n√†y s·ª≠ d·ª•ng khung ƒë√°nh gi√° r·ªßi ro to√†n di·ªán k·∫øt h·ª£p <strong>Fuzzy Analytical Hierarchy Process (AHP)</strong>, 
                                            <strong>Fuzzy-TOPSIS</strong>, v√† <strong>M√¥ ph·ªèng Monte Carlo</strong> ƒë·ªÉ ƒë√°nh gi√° r·ªßi ro logistics cho xu·∫•t kh·∫©u SME Vi·ªát Nam.
                                        </p>
                                        <!-- Research content continues... -->
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>

                <!-- INVESTOR MODE -->
                <div id="mode-investor" class="mode-section view-hidden">
                    <div id="investor" class="panel">
                        <div class="card">
                            <div class="hero-section">
                                <div class="hero-number" id="investorHeroNumber">32%</div>
                                <div class="hero-caption">Gi·∫£m R·ªßi Ro Th√¥ng Qua ƒê·ªãnh Tuy·∫øn Th√¥ng Minh</div>
                                <div class="hero-subtitle">
                                    Bi·∫øn Quy·∫øt ƒê·ªãnh Logistics M·ªù √Åm Th√†nh L·ª£i Th·∫ø C·∫°nh Tranh D·ª±a Tr√™n D·ªØ Li·ªáu
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M12 8V12L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div>
                                    V·∫•n ƒê·ªÅ ‚Üí Gi·∫£i Ph√°p ‚Üí T·∫°i Sao B√¢y Gi·ªù
                                </h2>
                            </div>
                            <div class="ps-grid">
                                <div class="ps-card">
                                    <div class="ps-icon">
                                        <div class="icon-card medium">
                                            <svg class="neon-icon" width="32" height="32" viewBox="0 0 24 24" fill="none">
                                                <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                                                <path d="M9 9L15 15M15 9L9 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="ps-title">V·∫•n ƒê·ªÅ</div>
                                    <div class="ps-text">
                                        C√°c nh√† xu·∫•t kh·∫©u SME ƒë∆∞a ra quy·∫øt ƒë·ªãnh logistics d·ª±a tr√™n d·ªØ li·ªáu ph√¢n m·∫£nh (b√°o gi√° chi ph√≠, th·ªùi gian giao h√†ng) 
                                        m√† kh√¥ng hi·ªÉu <strong>ph∆°i nhi·ªÖm r·ªßi ro th·ª±c s·ª±</strong>. K·∫øt qu·∫£: 15-25% l√¥ h√†ng g·∫∑p 
                                        tr·ªÖ, h∆∞ h·∫°i ho·∫∑c chi ph√≠ b·∫•t ng·ªù.
                                    </div>
                                </div>
                                <div class="ps-card">
                                    <div class="ps-icon">
                                        <div class="icon-card medium">
                                            <svg class="neon-icon" width="32" height="32" viewBox="0 0 24 24" fill="none">
                                                <path d="M12 2L3 7V12C3 16.5 6 20.16 12 21C18 20.16 21 16.5 21 12V7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                                <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="ps-title">Gi·∫£i Ph√°p</div>
                                    <div class="ps-text">
                                        <strong>RISKCAST</strong>: L·ªõp th√¥ng minh r·ªßi ro ƒë∆∞·ª£c h·ªó tr·ª£ b·ªüi AI k·∫øt h·ª£p Fuzzy-AHP, TOPSIS, 
                                        v√† m√¥ ph·ªèng Monte Carlo. M·ªôt ƒë·∫ßu v√†o (tuy·∫øn ƒë∆∞·ªùng, h√†ng h√≥a, incoterm) ‚Üí ƒëi·ªÉm r·ªßi ro to√†n di·ªán + 
                                        ph√¢n ph·ªëi r·ªßi ro ƒëu√¥i + ph∆∞∆°ng √°n t·ªëi ∆∞u.
                                    </div>
                                </div>
                                <div class="ps-card">
                                    <div class="ps-icon">
                                        <div class="icon-card medium">
                                            <svg class="neon-icon" width="32" height="32" viewBox="0 0 24 24" fill="none">
                                                <path d="M3 21L12 3L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M7 17L12 11L17 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="ps-title">T·∫°i Sao B√¢y Gi·ªù</div>
                                    <div class="ps-text">
                                        Bi·∫øn ƒë·ªông h·∫≠u ƒë·∫°i d·ªãch + √°p l·ª±c tu√¢n th·ªß ESG + s·ªë h√≥a t√†i ch√≠nh th∆∞∆°ng m·∫°i. 
                                        C√°c nh√† b·∫£o hi·ªÉm logistics, ng√¢n h√†ng v√† forwarder c·∫ßn <strong>m√¥ h√¨nh r·ªßi ro c√≥ th·ªÉ gi·∫£i th√≠ch</strong> 
                                        ƒë·ªÉ b·∫£o l√£nh SME th·ªã tr∆∞·ªùng m·ªõi n·ªïi.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2L15 9L22 10L17 15L18 22L12 18L6 22L7 15L2 10L9 9L12 2Z" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.5"/></svg></div>
                                    T√≥m T·∫Øt T√°c ƒê·ªông Kinh T·∫ø
                                </h2>
                            </div>
                            <div class="grid-2">
                                <div class="chart-container">
                                    <div id="savingsChart" style="height: 300px;"></div>
                                </div>
                                <div>
                                    <h3 style="color: var(--accent-green); margin-bottom: 16px;">Ph√¢n T√≠ch T√°c ƒê·ªông Chi Ph√≠</h3>
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Ch·ªâ S·ªë</th>
                                                <th>C∆° S·ªü</th>
                                                <th>T·ªëi ∆Øu</th>
                                                <th>C·∫£i Thi·ªán</th>
                                            </tr>
                                        </thead>
                                        <tbody id="economicsTable">
                                        </tbody>
                                    </table>
                                    <div class="alert-box green" style="margin-top: 16px;">
                                        <strong>L·ª£i √çch R√≤ng:</strong> <span id="netBenefit">$1.850</span> ti·∫øt ki·ªám m·ªói l√¥ h√†ng th√¥ng qua ƒë·ªãnh tuy·∫øn t·ªëi ∆∞u + gi·∫£m ph∆°i nhi·ªÖm r·ªßi ro.
                                        ƒê·ªëi v·ªõi nh√† xu·∫•t kh·∫©u th·ªã tr∆∞·ªùng trung b√¨nh (1.200 l√¥ h√†ng/nƒÉm) ‚Üí <strong>t√°c ƒë·ªông h√†ng nƒÉm $2.2M</strong>.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 21L12 3L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 17L12 11L17 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                                    ARR / Ti·ªÅm NƒÉng Doanh Thu
                                </h2>
                            </div>
                            <div class="grid-3">
                                <div class="kpi-card">
                                    <div class="kpi-label">Kh√°ch H√†ng M·ª•c Ti√™u</div>
                                    <div class="kpi-value" style="font-size: 24px;">Nh√† Xu·∫•t Kh·∫©u SME</div>
                                    <div class="kpi-subtitle">Doanh thu h√†ng nƒÉm $5M-50M</div>
                                </div>
                                <div class="kpi-card">
                                    <div class="kpi-label">M√¥ H√¨nh Gi√°</div>
                                    <div class="kpi-value" style="font-size: 24px;">$499/th√°ng</div>
                                    <div class="kpi-subtitle">Ph√¢n t√≠ch kh√¥ng gi·ªõi h·∫°n + API</div>
                                </div>
                                <div class="kpi-card">
                                    <div class="kpi-label">ARR t·∫°i 500 Kh√°ch H√†ng</div>
                                    <div class="kpi-value" style="font-size: 24px;" id="arrTarget">$3M</div>
                                    <div class="kpi-subtitle">M·ª•c ti√™u NƒÉm 3</div>
                                </div>
                            </div>
                            <h3 style="color: var(--accent-green); margin: 24px 0 12px;">Chi·∫øn L∆∞·ª£c Go-to-Market:</h3>
                            <ul class="insight-list">
                                <li><strong>Giai ƒêo·∫°n 1 (NƒÉm 1):</strong> SaaS B2B tr·ª±c ti·∫øp cho nh√† xu·∫•t kh·∫©u d·ªát may/ƒëi·ªán t·ª≠ Vi·ªát Nam (50 kh√°ch h√†ng, $300K ARR)</li>
                                <li><strong>Giai ƒêo·∫°n 2 (NƒÉm 2):</strong> API white-label cho forwarder v√† 3PL (150 kh√°ch h√†ng, $900K ARR)</li>
                                <li><strong>Giai ƒêo·∫°n 3 (NƒÉm 3):</strong> T√≠ch h·ª£p b·∫£o hi·ªÉm + m·ªü r·ªông khu v·ª±c sang Th√°i Lan, Indonesia (500 kh√°ch h√†ng, $3M ARR)</li>
                                <li><strong>H·∫°ng Doanh Nghi·ªáp:</strong> M√¥ h√¨nh r·ªßi ro t√πy ch·ªânh cho t·∫≠p ƒëo√†n l·ªõn ($2K-5K/th√°ng) ‚Üí 20-30% h·ªón h·ª£p doanh thu</li>
                            </ul>
                            <div class="chart-container" style="margin-top: 24px;">
                                <div id="arrChart" style="height: 300px;"></div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="8" width="18" height="10" stroke="currentColor" stroke-width="2" rx="1"/><path d="M7 8L10 4H14L17 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="7" cy="18" r="2" stroke="currentColor" stroke-width="2"/><circle cx="17" cy="18" r="2" stroke="currentColor" stroke-width="2"/></svg></div>
                                    Ki·∫øn Tr√∫c Engine-as-a-Service
                                </h2>
                            </div>
                            <div class="grid-2">
                                <div>
                                    <h3 style="color: var(--accent-green); margin-bottom: 12px;">ƒêi·ªÉm T√≠ch H·ª£p:</h3>
                                    <ul class="insight-list">
                                        <li><strong>H·ªá Th·ªëng TMS/ERP:</strong> Nh√∫ng ƒëi·ªÉm r·ªßi ro v√†o quy tr√¨nh logistics hi·ªán c√≥</li>
                                        <li><strong>N·ªÅn T·∫£ng B·∫£o Hi·ªÉm:</strong> T√≠nh to√°n ph√≠ b·∫£o hi·ªÉm ƒë·ªông d·ª±a tr√™n r·ªßi ro th·ªùi gian th·ª±c</li>
                                        <li><strong>T√†i Ch√≠nh Th∆∞∆°ng M·∫°i:</strong> H·∫°n m·ª©c t√≠n d·ª•ng ƒëi·ªÅu ch·ªânh r·ªßi ro cho LC/collections</li>
                                        <li><strong>Th·ªã Tr∆∞·ªùng V·∫≠n Chuy·ªÉn:</strong> Huy hi·ªáu r·ªßi ro cho l·ª±a ch·ªçn h√£ng v·∫≠n chuy·ªÉn/tuy·∫øn ƒë∆∞·ªùng</li>
                                    </ul>
                                </div>
                                <div>
                                    <h3 style="color: var(--accent-green); margin-bottom: 12px;">C√¥ng Ngh·ªá Stack:</h3>
                                    <ul class="insight-list">
                                        <li><strong>Core Engine:</strong> Python (NumPy, SciPy) + C++ cho Monte Carlo</li>
                                        <li><strong>L·ªõp API:</strong> FastAPI + Redis caching cho ph·∫£n h·ªìi d∆∞·ªõi gi√¢y</li>
                                        <li><strong>Pipeline D·ªØ Li·ªáu:</strong> Ngu·ªìn c·∫•p th·ªùi gian th·ª±c t·ª´ h√£ng v·∫≠n chuy·ªÉn, h·∫£i quan, API th·ªùi ti·∫øt</li>
                                        <li><strong>ML Ops:</strong> Hu·∫•n luy·ªán l·∫°i m√¥ h√¨nh li√™n t·ª•c tr√™n k·∫øt qu·∫£ l√¥ h√†ng m·ªõi</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="api-dashboard" style="margin-top: 20px;">
                                <h3 style="color: var(--accent-green); margin-bottom: 20px;">V√≠ D·ª• API:</h3>
                                
                                <!-- REQUEST DASHBOARD -->
                                <div class="api-dashboard-card request-card">
                                    <div class="api-card-header">
                                        <span class="api-method-badge post">POST</span>
                                        <span class="api-endpoint">/api/v1/analyze</span>
                                    </div>
                                    <div class="api-dashboard-grid">
                                        <div class="api-field-item">
                                            <div class="api-field-label">Route</div>
                                            <div class="api-field-value">VN-SGN ‚Üí US-LAX</div>
                                        </div>
                                        <div class="api-field-item">
                                            <div class="api-field-label">Cargo Value</div>
                                            <div class="api-field-value number">$100,000</div>
                                        </div>
                                        <div class="api-field-item">
                                            <div class="api-field-label">Cargo Type</div>
                                            <div class="api-field-value chip">electronics</div>
                                        </div>
                                        <div class="api-field-item">
                                            <div class="api-field-label">Incoterm</div>
                                            <div class="api-field-value chip">CIF</div>
                                        </div>
                                        <div class="api-field-item">
                                            <div class="api-field-label">Priority</div>
                                            <div class="api-field-value chip">balanced</div>
                                        </div>
                                    </div>
                                </div>
                                <!-- RESPONSE DASHBOARD -->
                                <div class="api-dashboard-card response-card">
                                    <div class="api-card-header">
                                        <span class="api-response-label">RESPONSE</span>
                                        <span class="api-time-badge">&lt; 800ms</span>
                                    </div>
                                    <div class="api-dashboard-grid">
                                        <div class="api-field-item highlight">
                                            <div class="api-field-label">Risk Score</div>
                                            <div class="api-field-value large number">76</div>
                                        </div>
                                        <div class="api-field-item">
                                            <div class="api-field-label">Risk Level</div>
                                            <div class="api-field-value chip medium">medium</div>
                                        </div>
                                        <div class="api-field-item">
                                            <div class="api-field-label">Expected Loss</div>
                                            <div class="api-field-value number">$12,500</div>
                                        </div>
                                        <div class="api-field-item">
                                            <div class="api-field-label">VaR 95%</div>
                                            <div class="api-field-value number">$28,000</div>
                                        </div>
                                        <div class="api-field-item full-width">
                                            <div class="api-field-label">Recommendations</div>
                                            <div class="api-field-value array">[...]</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="5" width="18" height="14" stroke="currentColor" stroke-width="2" rx="1"/><path d="M7 9H17M7 12H17M7 15H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div>
                                    C√¢u Chuy·ªán M·ªôt Trang Cho Nh√† ƒê·∫ßu T∆∞
                                </h2>
                            </div>
                            <div class="grid-2">
                                <div>
                                    <h3 style="color: var(--accent-green); margin-bottom: 16px;">C√¢u Chuy·ªán:</h3>
                                    <ul class="insight-list" style="font-size: 15px;">
                                        <li><strong>$2.7T</strong> chi ti√™u logistics to√†n c·∫ßu ‚Äî nh∆∞ng SME v·∫´n ra quy·∫øt ƒë·ªãnh trong b√≥ng t·ªëi</li>
                                        <li>Ch√∫ng t√¥i x√¢y d·ª±ng <strong>"Bloomberg Terminal cho R·ªßi Ro Logistics"</strong> ‚Äî ƒë·ªãnh l∆∞·ª£ng nh·ªØng g√¨ tr∆∞·ªõc ƒë√¢y ch·ªâ l√† c·∫£m t√≠nh</li>
                                        <li>Engine c·ªßa ch√∫ng t√¥i x·ª≠ l√Ω <strong>7 chi·ªÅu r·ªßi ro</strong> th·ªùi gian th·ª±c: tr·ªÖ, h∆∞ h·∫°i, chi ph√≠, ESG, kh√≠ h·∫≠u, ch√≠nh tr·ªã, v·∫≠n h√†nh</li>
                                        <li>Kh√°ch h√†ng ti·∫øt ki·ªám <strong>$1.850 m·ªói l√¥ h√†ng</strong> th√¥ng qua ƒë·ªãnh tuy·∫øn t·ªëi ∆∞u + gi·∫£m chi ph√≠ b·∫£o hi·ªÉm</li>
                                        <li>L·ªô tr√¨nh ƒë·∫øn <strong>$10M ARR</strong>: B·∫Øt ƒë·∫ßu v·ªõi SME Vi·ªát Nam ‚Üí m·ªü r·ªông sang ASEAN ‚Üí white-label cho nh√† b·∫£o hi·ªÉm/ng√¢n h√†ng</li>
                                    </ul>
                                </div>
                                <div class="chart-container">
                                    <div id="pitchChart" style="height: 350px;"></div>
                                </div>
                            </div>
                            <div class="alert-box green" style="margin-top: 20px;">
                                <strong><div class="icon-card"><svg class="neon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M12 8V12L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div> Y√™u C·∫ßu:</strong> V√≤ng seed $1.5M ƒë·ªÉ x√¢y d·ª±ng ƒë·ªôi ng≈© b√°n h√†ng, m·ªü r·ªông t√≠ch h·ª£p API, 
                                v√† ƒë·∫°t 200 kh√°ch h√†ng v√†o cu·ªëi NƒÉm 2. M·ª•c ti√™u tƒÉng tr∆∞·ªüng 40% YoY v·ªõi l·ªô tr√¨nh c√≥ l·ª£i nhu·∫≠n trong NƒÉm 3.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <!-- ========================================
         3D AI CHAT WIDGET
    ======================================== -->
    <style>
        /* ========================================
           FLOATING WIDGET CONTAINER
        ======================================== */
        .ai-widget-container {
            position: fixed;
            bottom: 28px;
            right: 28px;
            z-index: 9999;
            display: flex;
            align-items: flex-end;
            gap: 12px;
            pointer-events: none;
        }
        .ai-widget-container > * {
            pointer-events: auto;
        }

        /* ========================================
           3D BOT CHARACTER
        ======================================== */
        .ai-bot-3d {
            position: relative;
            width: 80px;
            height: 120px;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: botIdle 4s ease-in-out infinite;
            transform-style: preserve-3d;
        }
        .ai-bot-3d:hover {
            transform: scale(1.08) translateY(-4px);
            animation-play-state: paused;
        }

        .bot-head {
            position: absolute;
            bottom: 55px;
            left: 50%;
            transform: translateX(-50%);
            width: 55px;
            height: 55px;
            background: linear-gradient(145deg, #667eea 0%, #764ba2 100%);
            border-radius: 50% 50% 48% 52%;
            box-shadow: 
                0 8px 24px rgba(102, 126, 234, 0.4),
                inset 0 -3px 8px rgba(0, 0, 0, 0.3),
                inset 0 3px 8px rgba(255, 255, 255, 0.2);
            animation: headBob 3s ease-in-out infinite;
        }

        .bot-antenna {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 15px;
            background: linear-gradient(180deg, #667eea, transparent);
        }
        .bot-antenna::after {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: #00f2ff;
            border-radius: 50%;
            box-shadow: 0 0 12px #00f2ff;
            animation: antennaPulse 2s ease-in-out infinite;
        }

        .bot-eyes {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 12px;
        }
        .bot-eye {
            width: 10px;
            height: 10px;
            background: #00f2ff;
            border-radius: 50%;
            box-shadow: 
                0 0 8px #00f2ff,
                0 0 16px rgba(0, 242, 255, 0.5);
            animation: eyeBlink 6s ease-in-out infinite;
        }

        .bot-mouth {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 8px;
            border: 2px solid #00f2ff;
            border-top: none;
            border-radius: 0 0 10px 10px;
            opacity: 0.7;
        }

        .bot-body {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 45px;
            height: 35px;
            background: linear-gradient(145deg, #764ba2 0%, #667eea 100%);
            border-radius: 8px;
            box-shadow: 
                0 6px 16px rgba(102, 126, 234, 0.3),
                inset 0 -2px 6px rgba(0, 0, 0, 0.2);
        }
        .bot-body::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            background: #00f2ff;
            border-radius: 50%;
            box-shadow: 0 0 8px #00f2ff;
        }

        .bot-arm {
            position: absolute;
            top: 5px;
            width: 18px;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
        }
        .bot-arm.left {
            left: -14px;
            transform: rotate(-25deg);
            animation: armWave 3s ease-in-out infinite;
        }
        .bot-arm.right {
            right: -14px;
            transform: rotate(25deg);
            animation: armWave 3s ease-in-out infinite 0.5s;
        }

        .bot-legs {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }
        .bot-leg {
            width: 12px;
            height: 20px;
            background: linear-gradient(180deg, #764ba2, #667eea);
            border-radius: 6px 6px 4px 4px;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .ai-chat-button {
            width: 68px;
            height: 68px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: 
                0 8px 32px rgba(102, 126, 234, 0.5),
                0 0 0 0 rgba(102, 126, 234, 0.7);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        .ai-chat-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.5s ease;
            border-radius: 50%;
        }
        .ai-chat-button:hover {
            transform: scale(1.12) rotate(5deg);
            box-shadow: 
                0 12px 48px rgba(102, 126, 234, 0.6),
                0 0 0 8px rgba(102, 126, 234, 0.2);
        }
        .ai-chat-button:hover::before {
            transform: translate(-50%, -50%) scale(1.5);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            border-radius: 50%;
            border: 3px solid #1a1a2e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: white;
            animation: badgePulse 2s ease-in-out infinite;
        }

        .ai-chat-popup {
            position: fixed;
            bottom: 115px;
            right: 28px;
            width: 380px;
            height: 550px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 22px;
            border: 2px solid;
            border-image: linear-gradient(135deg, #667eea, #764ba2, #f093fb) 1;
            box-shadow: 
                0 24px 64px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            display: none;
            flex-direction: column;
            z-index: 9998;
            opacity: 0;
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .ai-chat-popup.active {
            display: flex;
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .chat-header {
            padding: 20px 24px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border-radius: 20px 20px 0 0;
            border-bottom: 1px solid rgba(102, 126, 234, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .chat-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .chat-title {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .chat-title h3 {
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .chat-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #a0aec0;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            background: #48bb78;
            border-radius: 50%;
            box-shadow: 0 0 8px #48bb78;
            animation: statusPulse 2s ease-in-out infinite;
        }
        .chat-close {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #ffffff;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .chat-close:hover {
            background: rgba(255, 107, 107, 0.2);
            transform: rotate(90deg);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        .message {
            display: flex;
            gap: 10px;
            animation: messageSlide 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .message.user {
            flex-direction: row-reverse;
        }
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        .message.ai .message-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        .message.user .message-avatar {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            box-shadow: 0 4px 12px rgba(240, 147, 251, 0.3);
        }
        .message-bubble {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .message.ai .message-bubble {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #e2e8f0;
            border-radius: 18px 18px 18px 4px;
        }
        
        /* AI Response Formatting Styles */
        /* AI Result Card */
        .message-bubble .ai-result-card {
            margin-bottom: 16px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 217, 255, 0.1));
            border: 1px solid rgba(0, 255, 136, 0.4);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.2);
        }
        .message-bubble .ai-result-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        .message-bubble .ai-result-header strong {
            color: #00ff88;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .message-bubble .result-value {
            font-size: 24px;
            font-weight: 800;
            color: #00ffa7;
            line-height: 1.2;
        }
        
        /* AI Reasoning Card */
        .message-bubble .ai-reasoning-card {
            margin-top: 16px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(255, 170, 0, 0.1), rgba(255, 200, 0, 0.05));
            border: 1px solid rgba(255, 170, 0, 0.3);
            border-radius: 12px;
        }
        .message-bubble .ai-reasoning-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        .message-bubble .ai-reasoning-header strong {
            color: #ffaa00;
            font-size: 14px;
        }
        .message-bubble .reasoning-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .message-bubble .reasoning-list li {
            padding: 10px 14px;
            margin-bottom: 8px;
            background: rgba(255, 170, 0, 0.08);
            border-left: 3px solid rgba(255, 170, 0, 0.5);
            border-radius: 6px;
            color: #e2e8f0;
            line-height: 1.7;
            transition: all 0.2s ease;
        }
        .message-bubble .reasoning-list li:hover {
            background: rgba(255, 170, 0, 0.12);
            transform: translateX(4px);
        }
        .message-bubble .reasoning-list li:last-child {
            margin-bottom: 0;
        }
        
        /* AI Field Cards */
        .message-bubble .ai-field-card {
            margin-top: 16px;
            padding: 14px;
            background: rgba(15, 20, 25, 0.6);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        .message-bubble .ai-field-card:hover {
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }
        .message-bubble .ai-field-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
        }
        .message-bubble .ai-field-header strong {
            color: #9effe0;
            font-size: 14px;
            flex: 1;
        }
        .message-bubble .ai-icon-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 217, 255, 0.2));
            border: 1px solid rgba(0, 255, 136, 0.4);
            border-radius: 8px;
            font-size: 16px;
            flex-shrink: 0;
        }
        .message-bubble .ai-badge-count {
            padding: 4px 10px;
            background: rgba(0, 217, 255, 0.2);
            color: #00d9ff;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        .message-bubble .ai-field-content {
            color: #e2e8f0;
            line-height: 1.6;
            padding: 8px 0;
        }
        
        /* Field Lists */
        .message-bubble .field-list {
            margin-top: 8px;
            padding: 0;
            list-style: none;
        }
        .message-bubble .field-item {
            padding: 10px 12px;
            margin-bottom: 6px;
            background: rgba(0, 255, 180, 0.06);
            border-left: 2px solid rgba(0, 255, 180, 0.4);
            border-radius: 6px;
            color: #cbd5e1;
            line-height: 1.6;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        .message-bubble .field-item:last-child {
            margin-bottom: 0;
        }
        .message-bubble .item-number {
            color: #00ffa7;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        /* Object Container */
        .message-bubble .object-container {
            margin-top: 10px;
            padding: 12px;
            background: rgba(0, 255, 180, 0.05);
            border-left: 3px solid rgba(0, 255, 180, 0.4);
            border-radius: 8px;
        }
        .message-bubble .object-container.nested {
            margin-left: 12px;
            background: rgba(0, 255, 180, 0.03);
        }
        .message-bubble .object-field-item {
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
        }
        .message-bubble .object-field-item:last-child {
            margin-bottom: 0;
        }
        .message-bubble .object-field-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }
        .message-bubble .object-field-label strong {
            color: #00ffa7;
            font-size: 13px;
            flex: 1;
        }
        .message-bubble .mini-icon {
            font-size: 14px;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 136, 0.15);
            border-radius: 4px;
            flex-shrink: 0;
        }
        .message-bubble .mini-badge {
            padding: 2px 8px;
            background: rgba(0, 217, 255, 0.2);
            color: #00d9ff;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }
        .message-bubble .object-field-value {
            color: #e2e8f0;
            padding-left: 28px;
            line-height: 1.6;
        }
        .message-bubble .nested-list {
            margin-top: 8px;
            padding-left: 0;
            list-style: none;
        }
        .message-bubble .nested-item {
            padding: 8px 10px;
            margin-bottom: 4px;
            color: #cbd5e1;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            line-height: 1.6;
        }
        .message-bubble .item-bullet {
            color: #00ffa7;
            font-weight: 700;
            flex-shrink: 0;
        }
        .message-bubble .object-empty,
        .message-bubble .object-nested-too-deep,
        .message-bubble .object-error {
            padding: 8px;
            color: #9fb3c8;
            font-style: italic;
        }
        .message-bubble .ai-error {
            color: #ff6b6b;
            padding: 8px;
            background: rgba(255, 107, 107, 0.1);
            border-left: 3px solid #ff6b6b;
            border-radius: 4px;
        }
        .message-bubble .ai-error a {
            color: #ffd93d;
            text-decoration: underline;
        }
        .message-bubble code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #00ffa7;
        }
        .message-bubble pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 8px 0;
        }
        .message-bubble pre code {
            background: none;
            padding: 0;
            color: #e2e8f0;
        }
        
        /* Text Content Styling */
        .message-bubble .ai-text-content {
            line-height: 1.8;
            color: #e2e8f0;
        }
        .message-bubble .ai-text-header {
            color: #00ff88;
            font-size: 18px;
            font-weight: 700;
            margin: 16px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(0, 255, 136, 0.3);
        }
        .message-bubble .ai-text-subheader {
            color: #00d9ff;
            font-size: 16px;
            font-weight: 600;
            margin: 14px 0 10px 0;
        }
        .message-bubble .ai-text-list {
            margin: 12px 0;
            padding-left: 24px;
            list-style: none;
        }
        .message-bubble .ai-text-list li {
            padding: 6px 0;
            color: #cbd5e1;
            position: relative;
            line-height: 1.7;
        }
        .message-bubble .ai-text-list li:before {
            content: "‚ñ∏ ";
            color: #00ffa7;
            font-weight: bold;
            position: absolute;
            left: -20px;
        }
        .message-bubble .ai-bold {
            color: #9effe0;
            font-weight: 600;
        }
        .message-bubble .ai-italic {
            color: #00d9ff;
            font-style: italic;
        }
        .message-bubble .ai-code-block {
            background: rgba(0, 0, 0, 0.5);
            padding: 14px;
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            overflow-x: auto;
            margin: 12px 0;
        }
        .message-bubble .ai-inline-code {
            background: rgba(0, 255, 136, 0.15);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #00ffa7;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #ffffff;
            border-radius: 18px 18px 4px 18px;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }

        .chat-input-container {
            padding: 16px 20px 20px;
            background: rgba(26, 26, 46, 0.8);
            border-top: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 0 0 20px 20px;
        }
        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 16px;
            padding: 4px 4px 4px 16px;
            transition: all 0.3s ease;
        }
        .chat-input-wrapper:focus-within {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            color: #ffffff;
            font-size: 14px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            outline: none;
            padding: 10px 0;
        }
        .chat-input::placeholder {
            color: #718096;
        }
        .chat-send-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            color: #ffffff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            flex-shrink: 0;
        }
        .chat-send-btn:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            gap: 4px;
            padding: 12px 16px;
        }
        .typing-indicator.active {
            display: flex;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes botIdle {
            0%, 100% { transform: rotate(0deg) translateY(0); }
            25% { transform: rotate(-2deg) translateY(-2px); }
            75% { transform: rotate(2deg) translateY(-2px); }
        }
        @keyframes headBob {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }
        @keyframes eyeBlink {
            0%, 96%, 100% { transform: scaleY(1); }
            98% { transform: scaleY(0.1); }
        }
        @keyframes antennaPulse {
            0%, 100% { opacity: 1; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.6; transform: translateX(-50%) scale(1.3); }
        }
        @keyframes armWave {
            0%, 100% { transform: rotate(-25deg); }
            50% { transform: rotate(-35deg); }
        }
        @keyframes badgePulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(238, 90, 111, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 6px rgba(238, 90, 111, 0); }
        }
        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        @media (max-width: 480px) {
            .ai-chat-popup {
                width: calc(100vw - 32px);
                height: calc(100vh - 140px);
                right: 16px;
                bottom: 100px;
            }
            .ai-widget-container {
                bottom: 20px;
                right: 20px;
            }
            .ai-bot-3d {
                width: 70px;
                height: 100px;
            }
            .ai-chat-button {
                width: 60px;
                height: 60px;
                font-size: 28px;
            }
        }
    </style>

    <!-- HTML STRUCTURE -->
    <div class="ai-widget-container">
        <!-- 3D Bot Character -->
        <div class="ai-bot-3d" id="aiBot">
            <div class="bot-head">
                <div class="bot-antenna"></div>
                <div class="bot-eyes">
                    <div class="bot-eye"></div>
                    <div class="bot-eye"></div>
                </div>
                <div class="bot-mouth"></div>
                <div class="bot-body">
                    <div class="bot-arm left"></div>
                    <div class="bot-arm right"></div>
                </div>
            </div>
            <div class="bot-legs">
                <div class="bot-leg"></div>
                <div class="bot-leg"></div>
            </div>
        </div>

        <!-- Floating Chat Button -->
        <button class="ai-chat-button" id="chatButton">
            ü§ñ
            <span class="notification-badge" id="notificationBadge" style="display: none;">3</span>
        </button>
    </div>

    <!-- Chat Popup -->
    <div class="ai-chat-popup" id="chatPopup">
        <!-- Header -->
        <div class="chat-header">
            <div class="chat-header-info">
                <div class="chat-avatar">ü§ñ</div>
                <div class="chat-title">
                    <h3>RISKCAST AI Assistant</h3>
                    <div class="chat-status">
                        <span class="status-dot"></span>
                        <span>Online</span>
                    </div>
                </div>
            </div>
            <button class="chat-close" id="chatClose">‚úï</button>
        </div>

        <!-- Messages Container -->
        <div class="chat-messages" id="chatMessages">
            <div class="message ai">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-bubble">
                    Xin ch√†o! T√¥i l√† RISKCAST AI Assistant. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n ph√¢n t√≠ch r·ªßi ro logistics. üëã
                </div>
            </div>
            <div class="message ai">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-bubble">
                    B·∫°n c√≥ th·ªÉ h·ªèi t√¥i v·ªÅ b·∫•t k·ª≥ ƒëi·ªÅu g√¨ li√™n quan ƒë·∫øn r·ªßi ro v·∫≠n t·∫£i, b·∫£o hi·ªÉm, ESG, ho·∫∑c khuy·∫øn ngh·ªã tuy·∫øn ƒë∆∞·ªùng!
                </div>
            </div>
        </div>

        <!-- Input Container -->
        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <input 
                    type="text" 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="Nh·∫≠p tin nh·∫Øn..."
                    autocomplete="off"
                >
                <button class="chat-send-btn" id="sendButton">‚û§</button>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // DOM ELEMENTS
        // ========================================
        const chatButton = document.getElementById('chatButton');
        const aiBot = document.getElementById('aiBot');
        const chatPopup = document.getElementById('chatPopup');
        const chatClose = document.getElementById('chatClose');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const chatMessages = document.getElementById('chatMessages');
        const notificationBadge = document.getElementById('notificationBadge');

        // ========================================
        // OPEN/CLOSE CHAT POPUP
        // ========================================
        function openChat() {
            chatPopup.classList.add('active');
            chatInput.focus();
            if (notificationBadge) {
                notificationBadge.style.display = 'none';
            }
        }

        function closeChat() {
            chatPopup.classList.remove('active');
        }

        if (chatButton) chatButton.addEventListener('click', openChat);
        if (aiBot) aiBot.addEventListener('click', openChat);
        if (chatClose) chatClose.addEventListener('click', closeChat);

        // ========================================
        // BOT HOVER EFFECT
        // ========================================
        if (aiBot) {
            aiBot.addEventListener('mousemove', (e) => {
                const rect = aiBot.getBoundingClientRect();
                const botCenterX = rect.left + rect.width / 2;
                const botCenterY = rect.top + rect.height / 2;
                
                const deltaX = e.clientX - botCenterX;
                const deltaY = e.clientY - botCenterY;
                
                const angle = Math.atan2(deltaY, deltaX);
                const rotation = (angle * 180 / Math.PI) / 10;
                
                const head = aiBot.querySelector('.bot-head');
                if (head) {
                    head.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
                }
            });

            aiBot.addEventListener('mouseleave', () => {
                const head = aiBot.querySelector('.bot-head');
                if (head) {
                    head.style.transform = 'translateX(-50%) rotate(0deg)';
                }
            });
        }

        // ========================================
        // FORMAT AI RESPONSE (Parse JSON and format nicely)
        // ========================================
        function formatAIResponse(text) {
            if (!text) return '';
            
            // Try to parse as JSON
            try {
                // First, try to parse the entire text as JSON
                try {
                    const parsed = JSON.parse(text);
                    return formatParsedJSON(parsed);
                } catch (e) {
                    // Not a complete JSON, try to find JSON objects in the text
                    const jsonMatches = text.match(/\{[\s\S]*?\}/g);
                    if (jsonMatches && jsonMatches.length > 0) {
                        // Try to parse the largest JSON match (most likely to be complete)
                        const sortedMatches = jsonMatches.sort((a, b) => b.length - a.length);
                        for (const jsonStr of sortedMatches) {
                            try {
                                const parsed = JSON.parse(jsonStr);
                                if (typeof parsed === 'object' && parsed !== null && !Array.isArray(parsed)) {
                                    return formatParsedJSON(parsed);
                                }
                            } catch (e) {
                                // Not valid JSON, skip
                                continue;
                            }
                        }
                    }
                }
            } catch (e) {
                console.error('Error parsing JSON:', e);
                // Fall through to text formatting
            }
            
            // Format as markdown-like text, but also try to format any [object Object] references
            let formattedText = formatTextResponse(text);
            
            // Replace [object Object] with a note
            formattedText = formattedText.replace(/\[object Object\]/g, '<em style="color: #ffaa00;">[D·ªØ li·ªáu ƒë·ªëi t∆∞·ª£ng - c·∫ßn ƒë·ªãnh d·∫°ng]</em>');
            
            return formattedText;
        }
        
        function formatParsedJSON(parsed) {
            try {
                let html = '';
                
                // Format result if exists
                if (parsed.result !== undefined) {
                    html += `<div class="ai-result-card">
                        <div class="ai-result-header">
                            <span class="ai-icon-badge">‚úì</span>
                            <strong>K·∫øt qu·∫£</strong>
                        </div>
                        <div class="result-value">${escapeHtml(String(parsed.result))}</div>
                    </div>`;
                }
                
                // Format reasoning if exists
                if (parsed.reasoning && Array.isArray(parsed.reasoning)) {
                    html += `<div class="ai-reasoning-card">
                        <div class="ai-reasoning-header">
                            <span class="ai-icon-badge">üí°</span>
                            <strong>Gi·∫£i th√≠ch</strong>
                        </div>
                        <ul class="reasoning-list">`;
                    parsed.reasoning.forEach((item) => {
                        html += `<li>${escapeHtml(String(item))}</li>`;
                    });
                    html += '</ul></div>';
                }
                
                // Format other fields
                for (const [key, value] of Object.entries(parsed)) {
                    if (key !== 'result' && key !== 'reasoning') {
                        html += formatField(key, value);
                    }
                }
                
                return html || formatTextResponse(JSON.stringify(parsed, null, 2));
            } catch (e) {
                console.error('Error formatting parsed JSON:', e);
                return formatTextResponse(JSON.stringify(parsed, null, 2));
            }
        }
        
        function formatTextResponse(text) {
            if (!text) return '';
            
            // Escape HTML first
            let html = escapeHtml(text);
            
            // Format headers (## Header)
            html = html.replace(/^##\s+(.+)$/gm, '<h3 class="ai-text-header">$1</h3>');
            html = html.replace(/^###\s+(.+)$/gm, '<h4 class="ai-text-subheader">$1</h4>');
            
            // Format code blocks
            html = html.replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre class="ai-code-block"><code>$2</code></pre>');
            
            // Format inline code
            html = html.replace(/`([^`]+)`/g, '<code class="ai-inline-code">$1</code>');
            
            // Format bold
            html = html.replace(/\*\*([^*]+)\*\*/g, '<strong class="ai-bold">$1</strong>');
            
            // Format italic
            html = html.replace(/\*([^*]+)\*/g, '<em class="ai-italic">$1</em>');
            
            // Format lists - improved
            const lines = html.split('\n');
            let formattedLines = [];
            let inList = false;
            let listItems = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const listMatch = line.match(/^\s*[-*+]\s+(.+)$/);
                const numMatch = line.match(/^\s*\d+\.\s+(.+)$/);
                
                if (listMatch || numMatch) {
                    if (!inList) {
                        inList = true;
                        listItems = [];
                    }
                    listItems.push(`<li>${listMatch ? listMatch[1] : numMatch[1]}</li>`);
                } else {
                    if (inList && listItems.length > 0) {
                        formattedLines.push(`<ul class="ai-text-list">${listItems.join('')}</ul>`);
                        listItems = [];
                        inList = false;
                    }
                    formattedLines.push(line);
                }
            }
            
            if (inList && listItems.length > 0) {
                formattedLines.push(`<ul class="ai-text-list">${listItems.join('')}</ul>`);
            }
            
            html = formattedLines.join('\n');
            
            // Format line breaks
            html = html.replace(/\n/g, '<br>');
            
            // Wrap in container for better styling
            return `<div class="ai-text-content">${html}</div>`;
        }
        
        function formatField(key, value) {
            try {
                let html = '';
                const fieldName = formatFieldName(key);
                const icon = getFieldIcon(key);
                
                // Handle null/undefined
                if (value === null || value === undefined) {
                    return `<div class="ai-field-card empty">
                        <div class="ai-field-header">
                            <span class="ai-icon-badge">${icon}</span>
                            <strong>${escapeHtml(fieldName)}</strong>
                        </div>
                        <div class="ai-field-content"><em>Kh√¥ng c√≥ d·ªØ li·ªáu</em></div>
                    </div>`;
                }
                
                // Handle arrays
                if (Array.isArray(value)) {
                    html += `<div class="ai-field-card list-field">
                        <div class="ai-field-header">
                            <span class="ai-icon-badge">${icon}</span>
                            <strong>${escapeHtml(fieldName)}</strong>
                            <span class="ai-badge-count">${value.length} m·ª•c</span>
                        </div>
                        <ul class="field-list">`;
                    value.forEach((item, index) => {
                        if (typeof item === 'object' && item !== null) {
                            html += `<li class="field-item"><span class="item-number">${index + 1}.</span>${formatObject(item, true, 0)}</li>`;
                        } else {
                            html += `<li class="field-item"><span class="item-number">${index + 1}.</span>${escapeHtml(String(item))}</li>`;
                        }
                    });
                    html += '</ul></div>';
                    return html;
                }
                
                // Handle objects
                if (typeof value === 'object') {
                    html += `<div class="ai-field-card object-field">
                        <div class="ai-field-header">
                            <span class="ai-icon-badge">${icon}</span>
                            <strong>${escapeHtml(fieldName)}</strong>
                        </div>`;
                    html += formatObject(value, false, 0);
                    html += '</div>';
                    return html;
                }
                
                // Handle primitive values
                html += `<div class="ai-field-card simple-field">
                    <div class="ai-field-header">
                        <span class="ai-icon-badge">${icon}</span>
                        <strong>${escapeHtml(fieldName)}</strong>
                    </div>
                    <div class="ai-field-content">${escapeHtml(String(value))}</div>
                </div>`;
                return html;
            } catch (e) {
                console.error('Error formatting field:', key, e);
                return `<div class="ai-field-card error">
                    <div class="ai-field-header">
                        <span class="ai-icon-badge">‚ö†</span>
                        <strong>${escapeHtml(String(key))}</strong>
                    </div>
                    <div class="ai-field-content"><em>L·ªói khi format</em></div>
                </div>`;
            }
        }
        
        function getFieldIcon(key) {
            const iconMap = {
                'main_risk_drivers': '‚ö†Ô∏è',
                'risk_impact_quantification': 'üìä',
                'route_recommendations': 'üó∫Ô∏è',
                'insurance_guidance': 'üõ°Ô∏è',
                'esg_advisory': 'üå±',
                'delay_probability_prediction': '‚è±Ô∏è',
                'risk_drivers': '‚ö†Ô∏è',
                'impact': 'üí•',
                'recommendations': 'üí°',
                'coverage': 'üìã',
                'limits': 'üìè',
                'opportunities': '‚ú®',
                'probability': 'üìà',
                'mitigation': 'üîß',
                'summary': 'üìù',
                'analysis': 'üîç',
                'conclusion': '‚úÖ'
            };
            return iconMap[key] || 'üìå';
        }
        
        function formatObject(obj, isListItem = false, depth = 0) {
            // Prevent infinite recursion
            if (depth > 5) {
                return '<div class="object-nested-too-deep"><em>[Nested qu√° s√¢u]</em></div>';
            }
            
            if (!obj || typeof obj !== 'object') {
                return escapeHtml(String(obj));
            }
            
            // Handle arrays
            if (Array.isArray(obj)) {
                let html = '<ul class="nested-list">';
                obj.forEach((item, index) => {
                    if (typeof item === 'object' && item !== null) {
                        html += `<li class="nested-item"><span class="item-bullet">${index + 1}.</span>${formatObject(item, true, depth + 1)}</li>`;
                    } else {
                        html += `<li class="nested-item"><span class="item-bullet">${index + 1}.</span>${escapeHtml(String(item))}</li>`;
                    }
                });
                html += '</ul>';
                return html;
            }
            
            let html = '';
            
            // Check if it's a simple key-value object
            const keys = Object.keys(obj);
            if (keys.length === 0) {
                return '<div class="object-empty"><em>Kh√¥ng c√≥ d·ªØ li·ªáu</em></div>';
            }
            
            // Format as structured list
            html += `<div class="object-container ${isListItem ? 'nested' : ''}">`;
            
            try {
                for (const [k, v] of Object.entries(obj)) {
                    const displayKey = formatFieldName(k);
                    const icon = getFieldIcon(k);
                    
                    if (v === null || v === undefined) {
                        html += `<div class="object-field-item">
                            <div class="object-field-label">
                                <span class="mini-icon">${icon}</span>
                                <strong>${escapeHtml(displayKey)}</strong>
                            </div>
                            <div class="object-field-value"><em>Kh√¥ng c√≥ d·ªØ li·ªáu</em></div>
                        </div>`;
                    } else if (Array.isArray(v)) {
                        html += `<div class="object-field-item">
                            <div class="object-field-label">
                                <span class="mini-icon">${icon}</span>
                                <strong>${escapeHtml(displayKey)}</strong>
                                <span class="mini-badge">${v.length}</span>
                            </div>
                            <ul class="nested-list">`;
                        v.forEach((item, idx) => {
                            if (typeof item === 'object' && item !== null) {
                                html += `<li class="nested-item"><span class="item-bullet">${idx + 1}.</span>${formatObject(item, true, depth + 1)}</li>`;
                            } else {
                                html += `<li class="nested-item"><span class="item-bullet">${idx + 1}.</span>${escapeHtml(String(item))}</li>`;
                            }
                        });
                        html += '</ul></div>';
                    } else if (typeof v === 'object') {
                        html += `<div class="object-field-item nested-object">
                            <div class="object-field-label">
                                <span class="mini-icon">${icon}</span>
                                <strong>${escapeHtml(displayKey)}</strong>
                            </div>`;
                        html += formatObject(v, true, depth + 1);
                        html += '</div>';
                    } else {
                        html += `<div class="object-field-item">
                            <div class="object-field-label">
                                <span class="mini-icon">${icon}</span>
                                <strong>${escapeHtml(displayKey)}</strong>
                            </div>
                            <div class="object-field-value">${escapeHtml(String(v))}</div>
                        </div>`;
                    }
                }
            } catch (e) {
                console.error('Error formatting object:', e);
                html += '<div class="object-error"><em>L·ªói khi format d·ªØ li·ªáu</em></div>';
            }
            
            html += '</div>';
            return html;
        }
        
        function formatFieldName(key) {
            // Convert snake_case or camelCase to readable format
            const nameMap = {
                'main_risk_drivers': 'C√°c Y·∫øu T·ªë R·ªßi Ro Ch√≠nh',
                'risk_impact_quantification': 'ƒê·ªãnh L∆∞·ª£ng T√°c ƒê·ªông R·ªßi Ro',
                'route_recommendations': 'Khuy·∫øn Ngh·ªã Tuy·∫øn ƒê∆∞·ªùng',
                'insurance_guidance': 'H∆∞·ªõng D·∫´n B·∫£o Hi·ªÉm',
                'esg_advisory': 'T∆∞ V·∫•n ESG',
                'delay_probability_prediction': 'D·ª± ƒêo√°n X√°c Su·∫•t Tr·ªÖ',
                'risk_drivers': 'Y·∫øu T·ªë R·ªßi Ro',
                'impact': 'T√°c ƒê·ªông',
                'recommendations': 'Khuy·∫øn Ngh·ªã',
                'coverage': 'Ph·∫°m Vi B·∫£o Hi·ªÉm',
                'limits': 'Gi·ªõi H·∫°n',
                'opportunities': 'C∆° H·ªôi',
                'probability': 'X√°c Su·∫•t',
                'mitigation': 'Gi·∫£m Thi·ªÉu'
            };
            
            if (nameMap[key]) {
                return nameMap[key];
            }
            
            // Convert snake_case to Title Case
            return key
                .replace(/_/g, ' ')
                .replace(/\b\w/g, l => l.toUpperCase());
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ========================================
        // SEND MESSAGE FUNCTION (Real API)
        // ========================================
        // Get context from current page data
        function getCurrentContext() {
            const context = {};
            
            // Try to get risk data from window object
            if (window.riskData && typeof window.riskData === 'object') {
                context.shipment_data = window.riskData;
            }
            
            // Try to get current risk metrics from page
            const overallRisk = document.getElementById('overall-risk-index')?.textContent;
            const expectedLoss = document.getElementById('expected-loss')?.textContent;
            const reliability = document.getElementById('reliability-score')?.textContent;
            
            if (overallRisk && overallRisk !== '--') {
                context.current_metrics = {
                    overall_risk: overallRisk,
                    expected_loss: expectedLoss || 'N/A',
                    reliability: reliability || 'N/A'
                };
            }
            
            // Try to get route information
            const routeChip = document.getElementById('routeChip')?.textContent;
            if (routeChip && routeChip !== 'ƒêang t·∫£i d·ªØ li·ªáu‚Ä¶') {
                context.route = routeChip;
            }
            
            return context;
        }
        
        async function sendMessage() {
            const messageText = chatInput.value.trim();
            
            if (!messageText) return;

            addMessage(messageText, 'user');
            chatInput.value = '';
            sendButton.disabled = true;
            showTypingIndicator();
            
            // Get context from current page
            const context = getCurrentContext();
            
            try {
                const response = await fetch('/api/ai/stream', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        prompt: messageText, 
                        context: context 
                    })
                });

                if (!response.ok) {
                    // Try to get error details from response
                    let errorDetail = `HTTP error! status: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        if (errorData.detail) {
                            errorDetail = errorData.detail;
                        }
                    } catch (e) {
                        // If response is not JSON, use status text
                        errorDetail = response.statusText || errorDetail;
                    }
                    throw new Error(errorDetail);
                }

                hideTypingIndicator();

                const aiMessageDiv = document.createElement('div');
                aiMessageDiv.className = 'message ai';
                const aiAvatar = document.createElement('div');
                aiAvatar.className = 'message-avatar';
                aiAvatar.textContent = 'ü§ñ';
                const aiBubble = document.createElement('div');
                aiBubble.className = 'message-bubble';
                aiBubble.innerHTML = '';
                aiMessageDiv.appendChild(aiAvatar);
                aiMessageDiv.appendChild(aiBubble);
                chatMessages.appendChild(aiMessageDiv);

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let fullText = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value, { stream: true });
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (!line.trim()) continue;

                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            
                            if (data === '[DONE]') break;

                            try {
                                const parsed = JSON.parse(data);
                                if (parsed.text) {
                                    fullText += parsed.text;
                                    // Format and display the text
                                    aiBubble.innerHTML = formatAIResponse(fullText);
                                    scrollToBottom();
                                } else if (parsed.error) {
                                    // Show user-friendly error message
                                    const errorMsg = parsed.error;
                                    if (errorMsg.includes('Invalid API key') || errorMsg.includes('authentication_error') || errorMsg.includes('401')) {
                                        aiBubble.innerHTML = '<div class="ai-error">‚ùå L·ªói x√°c th·ª±c: API key kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra file .env v√† c·∫≠p nh·∫≠t ANTHROPIC_API_KEY. L·∫•y key m·ªõi t·∫°i: <a href="https://console.anthropic.com/" target="_blank">https://console.anthropic.com/</a></div>';
                                    } else {
                                        aiBubble.innerHTML = `<div class="ai-error">‚ùå L·ªói: ${escapeHtml(errorMsg)}</div>`;
                                    }
                                    scrollToBottom();
                                    break; // Stop processing on error
                                }
                            } catch (e) {
                                if (data !== '[DONE]') {
                                    fullText += data;
                                    aiBubble.innerHTML = formatAIResponse(fullText);
                                    scrollToBottom();
                                }
                            }
                        } else {
                            fullText += line;
                            aiBubble.innerHTML = formatAIResponse(fullText);
                            scrollToBottom();
                        }
                    }
                }

            } catch (error) {
                console.error('Error sending message:', error);
                hideTypingIndicator();
                
                // Try to get error details from response
                let errorMessage = 'Xin l·ªói, ƒë√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi v·ªõi AI. Vui l√≤ng th·ª≠ l·∫°i sau.';
                
                if (error.message) {
                    if (error.message.includes('500')) {
                        errorMessage = 'L·ªói server: Vui l√≤ng ki·ªÉm tra c·∫•u h√¨nh ANTHROPIC_API_KEY trong file .env';
                    } else if (error.message.includes('ANTHROPIC_API_KEY')) {
                        errorMessage = 'L·ªói: ANTHROPIC_API_KEY ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh. Vui l√≤ng ki·ªÉm tra file .env';
                    } else {
                        errorMessage = `L·ªói: ${error.message}`;
                    }
                }
                
                addMessage(errorMessage, 'ai');
            } finally {
                sendButton.disabled = false;
            }
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'ai' ? 'ü§ñ' : 'üë§';
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            
            // Format AI messages, keep user messages as plain text
            if (sender === 'ai') {
                bubble.innerHTML = formatAIResponse(text);
            } else {
                bubble.textContent = text;
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(bubble);
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'message ai';
            indicator.id = 'typingIndicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'ü§ñ';
            
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message-bubble typing-indicator active';
            typingDiv.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            
            indicator.appendChild(avatar);
            indicator.appendChild(typingDiv);
            chatMessages.appendChild(indicator);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        if (sendButton) sendButton.addEventListener('click', sendMessage);
        if (chatInput) {
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        }

        if (chatPopup) {
            chatPopup.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }
    </script>

    <script src="/static/js/results.js"></script>
</body>
</html>