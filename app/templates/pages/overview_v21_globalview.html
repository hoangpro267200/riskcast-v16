{% extends "layouts/dashboard_layout.html" %}

{% block page_styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/overview_v21_globalview.css') }}">
{% endblock %}

{% block content %}
<div class="rc-global-overview">
    <!-- Header -->
    <header class="rc-global-header">
        <div class="rc-global-header-left">
            <h1 class="rc-global-title">Global Route Overview</h1>
            <div class="rc-live-indicator">
                <span class="rc-live-dot"></span>
                <span class="rc-live-text">LIVE TRACKING</span>
            </div>
        </div>
        <div class="rc-global-header-right">
            <button class="rc-btn-edit" id="rc-btn-toggle-edit">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M11.334 2C11.5091 1.82494 11.7169 1.68605 11.9457 1.59129C12.1745 1.49653 12.4197 1.44775 12.6673 1.44775C12.9149 1.44775 13.1601 1.49653 13.3889 1.59129C13.6177 1.68605 13.8256 1.82494 14.0007 2C14.1758 2.17513 14.3147 2.383 14.4094 2.61178C14.5042 2.84055 14.553 3.08575 14.553 3.33337C14.553 3.58099 14.5042 3.82619 14.4094 4.05497C14.3147 4.28374 14.1758 4.49161 14.0007 4.66671L5.00065 13.6667L1.33398 14.6667L2.33398 11L11.334 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Edit Shipment</span>
            </button>
        </div>
    </header>

    <!-- Main Content Grid -->
    <div class="rc-global-main">
        <!-- Left: Globe Section -->
        <section class="rc-globe-section">
            <div class="rc-globe-container" id="rc-globe-container">
                <!-- Globe renders here -->
                <div class="rc-globe-loading" id="rc-globe-loading">
                    <div class="rc-spinner"></div>
                    <p>Initializing 3D Globe...</p>
                </div>
            </div>

            <!-- Globe Controls -->
            <div class="rc-globe-controls">
                <div class="rc-view-toggle">
                    <button class="rc-view-btn active" data-mode="3d">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>3D</span>
                    </button>
                    <button class="rc-view-btn" data-mode="2d">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                            <path d="M2 10h20M8 4v16" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>2D</span>
                    </button>
                </div>
                <div class="rc-zoom-controls">
                    <button class="rc-zoom-btn" id="rc-zoom-in">+</button>
                    <button class="rc-zoom-btn" id="rc-zoom-out">−</button>
                    <button class="rc-zoom-btn" id="rc-zoom-reset" title="Reset Camera">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M1 4v6h6M23 20v-6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Route Summary Band -->
            <div class="rc-route-summary" id="rc-route-summary">
                <span class="rc-route-text" id="rc-route-text">—</span>
            </div>
        </section>

        <!-- Right: Stats Panel -->
        <aside class="rc-stats-panel">
            <!-- Risk Score -->
            <div class="rc-stat-card rc-stat-risk">
                <div class="rc-stat-header">
                    <h3>Risk Score</h3>
                    <span class="rc-risk-badge" id="rc-risk-badge">LOW</span>
                </div>
                <div class="rc-stat-body">
                    <div class="rc-risk-value" id="rc-risk-value">0%</div>
                    <p class="rc-risk-desc" id="rc-risk-desc">Minimal risk detected</p>
                </div>
            </div>

            <!-- Transit Info -->
            <div class="rc-stat-card rc-stat-transit">
                <h3 class="rc-stat-header">Transit Information</h3>
                <div class="rc-stat-body">
                    <div class="rc-transit-row">
                        <span class="rc-transit-label">ETD</span>
                        <span class="rc-transit-value" id="rc-etd">—</span>
                    </div>
                    <div class="rc-transit-row">
                        <span class="rc-transit-label">ETA</span>
                        <span class="rc-transit-value" id="rc-eta">—</span>
                    </div>
                    <div class="rc-transit-row rc-transit-highlight">
                        <span class="rc-transit-label">Transit Days</span>
                        <span class="rc-transit-value-large" id="rc-days">—</span>
                    </div>
                </div>
            </div>

            <!-- Reliability -->
            <div class="rc-stat-card rc-stat-reliability">
                <h3 class="rc-stat-header">Reliability</h3>
                <div class="rc-stat-body">
                    <div class="rc-reliability-value" id="rc-reliability-value">0%</div>
                    <div class="rc-reliability-bar">
                        <div class="rc-reliability-fill" id="rc-reliability-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Weather -->
            <div class="rc-stat-card rc-stat-weather">
                <h3 class="rc-stat-header">Port Weather</h3>
                <div class="rc-stat-body">
                    <div class="rc-weather-display">
                        <span class="rc-weather-icon" id="rc-weather-icon">☀️</span>
                        <div class="rc-weather-info">
                            <div class="rc-weather-temp" id="rc-weather-temp">—°C</div>
                            <div class="rc-weather-cond" id="rc-weather-cond">—</div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Bottom Section -->
    <div class="rc-global-bottom">
        <!-- Route Timeline -->
        <section class="rc-timeline-section">
            <h2 class="rc-section-title">Route Timeline</h2>
            <div class="rc-timeline-wrapper" id="timeline-wrapper">
                <p class="rc-timeline-empty">Loading route data...</p>
            </div>
        </section>

        <!-- Activities Table -->
        <section class="rc-activities-section">
            <div class="rc-activities-header">
                <h2 class="rc-section-title">Shipment Activities</h2>
                <div class="rc-activities-search">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <circle cx="7" cy="7" r="5" stroke="currentColor" stroke-width="1.5"/>
                        <path d="M11 11l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <input type="text" placeholder="Search..." class="rc-search-input">
                </div>
            </div>
            <div class="rc-activities-wrapper" id="activities-wrapper">
                <table class="rc-activities-table">
                    <thead>
                        <tr>
                            <th>Cargo ID</th>
                            <th>Destination</th>
                            <th>Arrival Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="activities-tbody">
                        <tr>
                            <td colspan="4" class="rc-table-empty">Loading activities...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Inline Edit Drawer -->
    <div class="rc-edit-drawer" id="rc-edit-drawer">
        <div class="rc-edit-drawer-header">
            <h3>Edit Shipment</h3>
            <button class="rc-drawer-close" id="rc-drawer-close">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
        <div class="rc-edit-drawer-body">
            <div class="rc-form-group">
                <label>Shipment ID</label>
                <input type="text" id="edit-shipment-id" class="rc-form-input" readonly>
            </div>
            <div class="rc-form-group">
                <label>Origin Port</label>
                <input type="text" id="edit-pol" class="rc-form-input" placeholder="e.g., SGN">
            </div>
            <div class="rc-form-group">
                <label>Destination Port</label>
                <input type="text" id="edit-pod" class="rc-form-input" placeholder="e.g., SFO">
            </div>
            <div class="rc-form-group">
                <label>Transport Mode</label>
                <select id="edit-mode" class="rc-form-input">
                    <option value="ocean">Ocean Freight</option>
                    <option value="air">Air Freight</option>
                    <option value="road">Road Transport</option>
                    <option value="rail">Rail Transport</option>
                </select>
            </div>
            <div class="rc-form-group">
                <label>ETD</label>
                <input type="date" id="edit-etd" class="rc-form-input">
            </div>
            <button class="rc-btn-save" id="rc-btn-save">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M17 21v-8H7v8M7 3v5h8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Save Changes</span>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Globe.gl Library -->
<script src="https://unpkg.com/globe.gl@^2.31.0/dist/globe.gl.min.js"></script>
<!-- Logistics Data -->
<script src="{{ url_for('static', filename='js/data/logistics_data.js') }}"></script>
<!-- Overview Controller v21 Global View -->
<script src="{{ url_for('static', filename='js/pages/overview_v21_globalview.js') }}"></script>
{% endblock %}




