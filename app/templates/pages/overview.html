{% extends "layouts/dashboard_layout.html" %}

{% block page_styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/overview.css') }}">
{% endblock %}

{% block content %}
<div class="rc-overview">
    <!-- Top Bar -->
    <div class="rc-overview-header">
        <div class="rc-overview-header-left">
            <h1 class="rc-overview-title">Global Route Overview</h1>
            <p class="rc-overview-subtitle">Single Shipment • Live Intelligence</p>
        </div>
        <div class="rc-overview-header-right">
            <span class="rc-overview-status-pill" id="rc-overview-status-pill">LIVE</span>
            <a href="{{ url_for('input_v20') }}" class="rc-overview-edit-btn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M11.334 2.00004C11.5091 1.82494 11.7169 1.68605 11.9457 1.59129C12.1745 1.49653 12.4197 1.44775 12.6673 1.44775C12.9149 1.44775 13.1601 1.49653 13.3889 1.59129C13.6177 1.68605 13.8256 1.82494 14.0007 2.00004C14.1758 2.17513 14.3147 2.383 14.4094 2.61178C14.5042 2.84055 14.553 3.08575 14.553 3.33337C14.553 3.58099 14.5042 3.82619 14.4094 4.05497C14.3147 4.28374 14.1758 4.49161 14.0007 4.66671L5.00065 13.6667L1.33398 14.6667L2.33398 11L11.334 2.00004Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Edit shipment
            </a>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="rc-overview-main">
        <!-- Left: Globe Section -->
        <div class="rc-overview-globe-section">
            <div id="rc-globe-wrapper">
                <div id="rc-globe-container"></div>
                
                <!-- Globe Controls -->
                <div class="rc-globe-controls">
                    <div class="rc-globe-view-toggle">
                        <button class="rc-globe-toggle-btn active" data-mode="3d">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                <path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            3D
                        </button>
                        <button class="rc-globe-toggle-btn" data-mode="2d">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                <path d="M2 10h20M8 4v16" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            2D
                        </button>
                    </div>
                    
                    <div class="rc-globe-zoom-controls">
                        <span class="rc-zoom-label">Zoom</span>
                        <button class="rc-zoom-btn" id="rc-zoom-in">+</button>
                        <button class="rc-zoom-btn" id="rc-zoom-out">−</button>
                    </div>
                </div>

                <!-- Loading Indicator -->
                <div class="rc-globe-loading" id="rc-globe-loading">
                    <div class="rc-spinner"></div>
                    <p>Loading globe...</p>
                </div>

                <!-- Globe Chip -->
                <div class="rc-globe-chip" id="rc-globe-chip">
                    <span id="rc-globe-chip-route">—</span>
                    <span class="rc-globe-chip-divider">•</span>
                    <span id="rc-globe-chip-mode">—</span>
                </div>
            </div>
        </div>

        <!-- Right: Stats Panel -->
        <div class="rc-overview-stats-section">
            <div class="rc-stats-grid">
                <!-- Risk Score Card -->
                <div class="rc-card rc-card-risk">
                    <div class="rc-card-header">
                        <h3 class="rc-card-title">Risk Score</h3>
                        <span class="rc-risk-badge" id="rc-risk-badge">Low risk</span>
                    </div>
                    <div class="rc-card-body">
                        <div class="rc-card-main-value" id="rc-risk-value">0%</div>
                        <div class="rc-card-subtitle" id="rc-risk-description">Minimal risk detected</div>
                    </div>
                </div>

                <!-- Transit Card -->
                <div class="rc-card rc-card-transit">
                    <div class="rc-card-header">
                        <h3 class="rc-card-title">Transit Information</h3>
                    </div>
                    <div class="rc-card-body">
                        <div class="rc-transit-row">
                            <span class="rc-transit-label">ETD</span>
                            <span class="rc-transit-value" id="rc-etd-value">—</span>
                        </div>
                        <div class="rc-transit-row">
                            <span class="rc-transit-label">ETA</span>
                            <span class="rc-transit-value" id="rc-eta-value">—</span>
                        </div>
                        <div class="rc-transit-row rc-transit-row-highlight">
                            <span class="rc-transit-label">Transit Days</span>
                            <span class="rc-transit-value-large" id="rc-transit-days">—</span>
                        </div>
                    </div>
                </div>

                <!-- Reliability Card -->
                <div class="rc-card rc-card-reliability">
                    <div class="rc-card-header">
                        <h3 class="rc-card-title">Reliability</h3>
                    </div>
                    <div class="rc-card-body">
                        <div class="rc-reliability-gauge">
                            <div class="rc-reliability-value" id="rc-reliability-value">0%</div>
                            <div class="rc-reliability-bar">
                                <div class="rc-reliability-fill" id="rc-reliability-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weather Card -->
                <div class="rc-card rc-card-weather">
                    <div class="rc-card-header">
                        <h3 class="rc-card-title">Port Weather</h3>
                    </div>
                    <div class="rc-card-body">
                        <div class="rc-weather-display">
                            <span class="rc-weather-icon" id="rc-weather-icon">☀️</span>
                            <div class="rc-weather-info">
                                <div class="rc-weather-temp" id="rc-weather-temp">—°C</div>
                                <div class="rc-weather-condition" id="rc-weather-condition">—</div>
                                <div class="rc-weather-route" id="rc-weather-route">POL & POD conditions</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom: Route Timeline + Activities -->
    <section class="rc-overview-bottom">
        <div class="rc-bottom-left">
            <!-- Route Timeline -->
            <div class="rc-timeline-card">
                <div class="rc-timeline-header">
                    <h2 class="rc-timeline-title">Route Timeline</h2>
                    <p class="rc-timeline-subtitle" id="rc-timeline-subtitle">From POL to POD with intermediate hubs.</p>
                </div>
                <ol class="rc-timeline-list" id="rc-timeline-list">
                    <!-- JS will inject timeline items -->
                    <li class="rc-timeline-empty">Waiting for shipment data…</li>
                </ol>
            </div>
        </div>

        <div class="rc-bottom-right">
            <!-- Activities Table -->
            <div class="rc-overview-activities">
                <div class="rc-activities-header">
                    <h2 class="rc-activities-title">Shipment Activities</h2>
                    <div class="rc-activities-search">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <circle cx="7" cy="7" r="5" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M11 11l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <input type="text" placeholder="Search shipments..." class="rc-activities-search-input" id="rc-activities-search">
                    </div>
                </div>
                
                <div class="rc-activities-table-wrapper">
                    <table class="rc-activities-table">
                        <thead>
                            <tr>
                                <th>Cargo ID</th>
                                <th>Origin</th>
                                <th>Destination</th>
                                <th>ETA</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="rc-activities-tbody">
                            <!-- Rows will be inserted by JS -->
                            <tr>
                                <td colspan="5" class="rc-table-empty">Loading shipment data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<!-- Globe.gl Library -->
<script src="https://unpkg.com/globe.gl@^2.31.0/dist/globe.gl.min.js"></script>
<!-- Logistics Data -->
<script src="{{ url_for('static', filename='js/data/logistics_data.js') }}"></script>
<!-- Overview Controller v21 (replaces dashboard.js for this page) -->
<script src="{{ url_for('static', filename='js/pages/overview_v21.js') }}"></script>
<!-- Translations -->
<script src="/static/js/core/translations.js"></script>
{% endblock %}