{% extends "layouts/base.html" %}

{% block title %}Global Route Overview - RISKCAST v21{% endblock %}

{% block head %}
{{ super() }}
<!-- Globe.gl Library -->
<script src="https://unpkg.com/globe.gl@^2.31.0/dist/globe.gl.min.js"></script>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/overview.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/globe.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/timeline.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/drawer.css') }}">
{% endblock %}

{% block content %}
<div class="rc-overview-v21">
    <!-- Main Container -->
    <div class="rc-container">
        
        <!-- Header Section -->
        <header class="rc-overview-header">
            <div class="rc-header-left">
                <h1 class="rc-page-title">Global Route Overview</h1>
                <div class="rc-live-indicator">
                    <span class="rc-live-dot"></span>
                    <span class="rc-live-text">LIVE</span>
                </div>
            </div>
            
            <div class="rc-header-right">
                <button class="rc-btn rc-btn-secondary" id="rc-btn-edit-shipment">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M11.334 2C11.5091 1.82494 11.7169 1.68605 11.9457 1.59129C12.1745 1.49653 12.4197 1.44775 12.6673 1.44775C12.9149 1.44775 13.1601 1.49653 13.3889 1.59129C13.6177 1.68605 13.8256 1.82494 14.0007 2C14.1758 2.17513 14.3147 2.383 14.4094 2.61178C14.5042 2.84055 14.553 3.08575 14.553 3.33337C14.553 3.58099 14.5042 3.82619 14.4094 4.05497C14.3147 4.28374 14.1758 4.49161 14.0007 4.66671L5.00065 13.6667L1.33398 14.6667L2.33398 11L11.334 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Edit Shipment</span>
                </button>
                
                <button class="rc-btn rc-btn-primary" id="rc-btn-go-analysis">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M14 8.5L8.5 14L3 8.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8.5 14V2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Go to Analysis</span>
                </button>
            </div>
        </header>

        <!-- Route Badge -->
        <div class="rc-route-badge" id="rc-route-badge">
            <span class="rc-route-text">â€”</span>
        </div>

        <!-- Globe Section -->
        <section class="rc-globe-section">
            <div class="rc-globe-wrapper">
                <div class="rc-globe-container" id="rc-globe-container">
                    <!-- Globe renders here -->
                </div>
                
                <!-- Globe Loading State -->
                <div class="rc-globe-loading" id="rc-globe-loading">
                    <div class="rc-spinner"></div>
                    <p class="rc-loading-text">Initializing 3D Globe...</p>
                </div>
                
                <!-- Globe Controls -->
                <div class="rc-globe-controls">
                    <div class="rc-view-mode-toggle">
                        <button class="rc-view-btn active" data-mode="3d" title="3D View">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                <path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>3D</span>
                        </button>
                        <button class="rc-view-btn" data-mode="2d" title="2D View">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                <path d="M2 10h20M8 4v16" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span>2D</span>
                        </button>
                    </div>
                    
                    <div class="rc-zoom-controls">
                        <button class="rc-zoom-btn" id="rc-zoom-in" title="Zoom In">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M8 3.33334V12.6667M3.33333 8H12.6667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </button>
                        <button class="rc-zoom-btn" id="rc-zoom-out" title="Zoom Out">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M3.33333 8H12.6667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </button>
                        <button class="rc-zoom-btn" id="rc-zoom-reset" title="Reset View">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M14 6.66667V2.66667H10M2 9.33333V13.3333H6M14 2.66667L9.33333 7.33333M2 13.3333L6.66667 8.66667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bottom Panels Grid -->
        <div class="rc-bottom-grid">
            
            <!-- Route Timeline Panel -->
            <section class="rc-timeline-panel">
                <div class="rc-panel-header">
                    <h2 class="rc-panel-title">Route Timeline</h2>
                    <p class="rc-panel-subtitle" id="rc-timeline-subtitle">From POL to POD with intermediate hubs</p>
                </div>
                
                <div class="rc-timeline-container" id="rc-timeline-container">
                    <!-- Timeline items render here -->
                    <div class="rc-timeline-empty">
                        <p>Waiting for shipment data...</p>
                    </div>
                </div>
            </section>

            <!-- Shipment Activities Panel -->
            <section class="rc-activities-panel">
                <div class="rc-panel-header">
                    <h2 class="rc-panel-title">Shipment Activities</h2>
                    <div class="rc-search-box">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <circle cx="7" cy="7" r="5" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M11 11l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <input type="text" class="rc-search-input" id="rc-activities-search" placeholder="Search shipments...">
                    </div>
                </div>
                
                <div class="rc-activities-table-wrapper">
                    <table class="rc-activities-table">
                        <thead>
                            <tr>
                                <th>Cargo ID</th>
                                <th>Origin</th>
                                <th>Destination</th>
                                <th>ETA</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="rc-activities-tbody">
                            <tr>
                                <td colspan="5" class="rc-table-loading">Loading activities...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
        </div>

    </div>
</div>

<!-- Edit Drawer v21 -->
<div class="rc-edit-drawer" id="rc-edit-drawer">
    <div class="rc-drawer-overlay" id="rc-drawer-overlay"></div>
    
    <div class="rc-drawer-content">
        <!-- Drawer Header -->
        <div class="rc-drawer-header">
            <h3 class="rc-drawer-title">Edit Shipment</h3>
            <button class="rc-drawer-close" id="rc-drawer-close" aria-label="Close drawer">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </button>
        </div>

        <!-- Drawer Body -->
        <div class="rc-drawer-body">
            
            <!-- Transport Section -->
            <div class="rc-drawer-section">
                <h4 class="rc-section-title">Transport Details</h4>
                
                <div class="rc-form-row">
                    <div class="rc-form-group">
                        <label class="rc-label">Origin Port (POL)</label>
                        <input type="text" class="rc-input" id="edit-origin-port" placeholder="e.g., SGN">
                    </div>
                    <div class="rc-form-group">
                        <label class="rc-label">Destination Port (POD)</label>
                        <input type="text" class="rc-input" id="edit-destination-port" placeholder="e.g., SFO">
                    </div>
                </div>

                <div class="rc-form-row">
                    <div class="rc-form-group">
                        <label class="rc-label">Transport Mode</label>
                        <select class="rc-input" id="edit-transport-mode">
                            <option value="">Select mode...</option>
                            <option value="ocean">Ocean Freight</option>
                            <option value="air">Air Freight</option>
                            <option value="road">Road Transport</option>
                            <option value="rail">Rail Transport</option>
                        </select>
                    </div>
                    <div class="rc-form-group">
                        <label class="rc-label">Shipment Type</label>
                        <select class="rc-input" id="edit-shipment-type">
                            <option value="">Select type...</option>
                            <option value="FCL">FCL (Full Container)</option>
                            <option value="LCL">LCL (Less than Container)</option>
                            <option value="Air">Air Cargo</option>
                            <option value="Break Bulk">Break Bulk</option>
                        </select>
                    </div>
                </div>

                <div class="rc-form-row">
                    <div class="rc-form-group">
                        <label class="rc-label">Carrier</label>
                        <input type="text" class="rc-input" id="edit-carrier" placeholder="e.g., Maersk">
                    </div>
                    <div class="rc-form-group">
                        <label class="rc-label">Service Route</label>
                        <input type="text" class="rc-input" id="edit-service-route" placeholder="e.g., Asia-US West">
                    </div>
                </div>

                <div class="rc-form-row">
                    <div class="rc-form-group">
                        <label class="rc-label">ETD</label>
                        <input type="date" class="rc-input" id="edit-etd">
                    </div>
                    <div class="rc-form-group">
                        <label class="rc-label">ETA</label>
                        <input type="date" class="rc-input" id="edit-eta">
                    </div>
                </div>
            </div>

            <!-- Cargo Section -->
            <div class="rc-drawer-section">
                <h4 class="rc-section-title">Cargo Details</h4>
                
                <div class="rc-form-row">
                    <div class="rc-form-group">
                        <label class="rc-label">Cargo Type</label>
                        <input type="text" class="rc-input" id="edit-cargo-type" placeholder="e.g., Electronics">
                    </div>
                    <div class="rc-form-group">
                        <label class="rc-label">Packing Type</label>
                        <input type="text" class="rc-input" id="edit-packing-type" placeholder="e.g., Palletized">
                    </div>
                </div>

                <div class="rc-form-row">
                    <div class="rc-form-group">
                        <label class="rc-label">Gross Weight (kg)</label>
                        <input type="number" class="rc-input" id="edit-gross-weight" placeholder="0">
                    </div>
                    <div class="rc-form-group">
                        <label class="rc-label">Volume (CBM)</label>
                        <input type="number" class="rc-input" id="edit-cbm" placeholder="0" step="0.01">
                    </div>
                </div>

                <div class="rc-form-group">
                    <label class="rc-label">Insurance Value (USD)</label>
                    <input type="number" class="rc-input" id="edit-insurance-value" placeholder="0">
                </div>

                <div class="rc-form-group">
                    <label class="rc-label">Cargo Description</label>
                    <textarea class="rc-input rc-textarea" id="edit-cargo-description" rows="3" placeholder="Brief description..."></textarea>
                </div>
            </div>

            <!-- Seller Section -->
            <div class="rc-drawer-section">
                <h4 class="rc-section-title">Seller Information</h4>
                
                <div class="rc-form-group">
                    <label class="rc-label">Seller Company</label>
                    <input type="text" class="rc-input" id="edit-seller-company" placeholder="Company name">
                </div>

                <div class="rc-form-row">
                    <div class="rc-form-group">
                        <label class="rc-label">Seller Country</label>
                        <input type="text" class="rc-input" id="edit-seller-country" placeholder="e.g., Vietnam">
                    </div>
                    <div class="rc-form-group">
                        <label class="rc-label">Incoterm (Seller)</label>
                        <select class="rc-input" id="edit-incoterm-seller">
                            <option value="">Select...</option>
                            <option value="FOB">FOB</option>
                            <option value="CFR">CFR</option>
                            <option value="CIF">CIF</option>
                            <option value="EXW">EXW</option>
                            <option value="FCA">FCA</option>
                            <option value="CPT">CPT</option>
                            <option value="CIP">CIP</option>
                            <option value="DAP">DAP</option>
                            <option value="DPU">DPU</option>
                            <option value="DDP">DDP</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Buyer Section -->
            <div class="rc-drawer-section">
                <h4 class="rc-section-title">Buyer Information</h4>
                
                <div class="rc-form-group">
                    <label class="rc-label">Buyer Company</label>
                    <input type="text" class="rc-input" id="edit-buyer-company" placeholder="Company name">
                </div>

                <div class="rc-form-row">
                    <div class="rc-form-group">
                        <label class="rc-label">Buyer Country</label>
                        <input type="text" class="rc-input" id="edit-buyer-country" placeholder="e.g., USA">
                    </div>
                    <div class="rc-form-group">
                        <label class="rc-label">Incoterm (Buyer)</label>
                        <select class="rc-input" id="edit-incoterm-buyer">
                            <option value="">Select...</option>
                            <option value="FOB">FOB</option>
                            <option value="CFR">CFR</option>
                            <option value="CIF">CIF</option>
                            <option value="EXW">EXW</option>
                            <option value="FCA">FCA</option>
                            <option value="CPT">CPT</option>
                            <option value="CIP">CIP</option>
                            <option value="DAP">DAP</option>
                            <option value="DPU">DPU</option>
                            <option value="DDP">DDP</option>
                        </select>
                    </div>
                </div>
            </div>

        </div>

        <!-- Drawer Footer -->
        <div class="rc-drawer-footer">
            <button class="rc-btn rc-btn-cancel" id="rc-drawer-cancel">
                <span>Cancel</span>
            </button>
            <button class="rc-btn rc-btn-save" id="rc-drawer-save">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M13.3333 4L6 11.3333L2.66667 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Save Changes</span>
            </button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<!-- Port Data -->
<script src="{{ url_for('static', filename='js/data/logistics_data.js') }}"></script>

<!-- Modular Controllers (load in order) -->
<script src="{{ url_for('static', filename='js/globe_engine_v21.js') }}"></script>
<script src="{{ url_for('static', filename='js/map_data_to_overview.js') }}"></script>
<script src="{{ url_for('static', filename='js/edit_drawer_v21.js') }}"></script>
<script src="{{ url_for('static', filename='js/overview_controller.js') }}"></script>
{% endblock %}




